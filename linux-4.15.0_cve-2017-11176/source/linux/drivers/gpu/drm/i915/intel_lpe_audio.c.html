<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"><title>intel_lpe_audio.c source code [linux/drivers/gpu/drm/i915/intel_lpe_audio.c] - Woboq Code Browser</title>
<link rel="stylesheet" href="../../../../../../data/qtcreator.css" title="QtCreator"/>
<link rel="alternate stylesheet" href="../../../../../../data/kdevelop.css" title="KDevelop"/>
<script type="text/javascript" src="../../../../../../data/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../../../../../../data/jquery/jquery-ui.min.js"></script>
<script>var file = 'linux/drivers/gpu/drm/i915/intel_lpe_audio.c'; var root_path = '../../../../..'; var data_path = '../../../../../../data'; var ecma_script_api_version = 2;</script>
<script src='../../../../../../data/codebrowser.js'></script>
</head>
<body><div id='header'><h1 id='breadcrumb'><span>Browse the source code of </span><a href='../../../..'>linux</a>/<a href='../../..'>drivers</a>/<a href='../..'>gpu</a>/<a href='..'>drm</a>/<a href='./'>i915</a>/<a href='intel_lpe_audio.c.html'>intel_lpe_audio.c</a></h1></div>
<hr/><div id='content'><table class="code">
<tr><th id="1">1</th><td><i>/*</i></td></tr>
<tr><th id="2">2</th><td><i> * Copyright Â© 2016 Intel Corporation</i></td></tr>
<tr><th id="3">3</th><td><i> *</i></td></tr>
<tr><th id="4">4</th><td><i> * Permission is hereby granted, free of charge, to any person obtaining a</i></td></tr>
<tr><th id="5">5</th><td><i> * copy of this software and associated documentation files (the "Software"),</i></td></tr>
<tr><th id="6">6</th><td><i> * to deal in the Software without restriction, including without limitation</i></td></tr>
<tr><th id="7">7</th><td><i> * the rights to use, copy, modify, merge, publish, distribute, sublicense,</i></td></tr>
<tr><th id="8">8</th><td><i> * and/or sell copies of the Software, and to permit persons to whom the</i></td></tr>
<tr><th id="9">9</th><td><i> * Software is furnished to do so, subject to the following conditions:</i></td></tr>
<tr><th id="10">10</th><td><i> *</i></td></tr>
<tr><th id="11">11</th><td><i> * The above copyright notice and this permission notice (including the next</i></td></tr>
<tr><th id="12">12</th><td><i> * paragraph) shall be included in all copies or substantial portions of the</i></td></tr>
<tr><th id="13">13</th><td><i> * Software.</i></td></tr>
<tr><th id="14">14</th><td><i> *</i></td></tr>
<tr><th id="15">15</th><td><i> * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</i></td></tr>
<tr><th id="16">16</th><td><i> * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</i></td></tr>
<tr><th id="17">17</th><td><i> * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL</i></td></tr>
<tr><th id="18">18</th><td><i> * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</i></td></tr>
<tr><th id="19">19</th><td><i> * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING</i></td></tr>
<tr><th id="20">20</th><td><i> * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS</i></td></tr>
<tr><th id="21">21</th><td><i> * IN THE SOFTWARE.</i></td></tr>
<tr><th id="22">22</th><td><i> *</i></td></tr>
<tr><th id="23">23</th><td><i> * Authors:</i></td></tr>
<tr><th id="24">24</th><td><i> *    Pierre-Louis Bossart &lt;pierre-louis.bossart@linux.intel.com&gt;</i></td></tr>
<tr><th id="25">25</th><td><i> *    Jerome Anand &lt;jerome.anand@intel.com&gt;</i></td></tr>
<tr><th id="26">26</th><td><i> *    based on VED patches</i></td></tr>
<tr><th id="27">27</th><td><i> *</i></td></tr>
<tr><th id="28">28</th><td><i> */</i></td></tr>
<tr><th id="29">29</th><td></td></tr>
<tr><th id="30">30</th><td><i class="doc">/**</i></td></tr>
<tr><th id="31">31</th><td><i class="doc"> * DOC: LPE Audio integration for HDMI or DP playback</i></td></tr>
<tr><th id="32">32</th><td><i class="doc"> *</i></td></tr>
<tr><th id="33">33</th><td><i class="doc"> * Motivation:</i></td></tr>
<tr><th id="34">34</th><td><i class="doc"> * Atom platforms (e.g. valleyview and cherryTrail) integrates a DMA-based</i></td></tr>
<tr><th id="35">35</th><td><i class="doc"> * interface as an alternative to the traditional HDaudio path. While this</i></td></tr>
<tr><th id="36">36</th><td><i class="doc"> * mode is unrelated to the LPE aka SST audio engine, the documentation refers</i></td></tr>
<tr><th id="37">37</th><td><i class="doc"> * to this mode as LPE so we keep this notation for the sake of consistency.</i></td></tr>
<tr><th id="38">38</th><td><i class="doc"> *</i></td></tr>
<tr><th id="39">39</th><td><i class="doc"> * The interface is handled by a separate standalone driver maintained in the</i></td></tr>
<tr><th id="40">40</th><td><i class="doc"> * ALSA subsystem for simplicity. To minimize the interaction between the two</i></td></tr>
<tr><th id="41">41</th><td><i class="doc"> * subsystems, a bridge is setup between the hdmi-lpe-audio and i915:</i></td></tr>
<tr><th id="42">42</th><td><i class="doc"> * 1. Create a platform device to share MMIO/IRQ resources</i></td></tr>
<tr><th id="43">43</th><td><i class="doc"> * 2. Make the platform device child of i915 device for runtime PM.</i></td></tr>
<tr><th id="44">44</th><td><i class="doc"> * 3. Create IRQ chip to forward the LPE audio irqs.</i></td></tr>
<tr><th id="45">45</th><td><i class="doc"> * the hdmi-lpe-audio driver probes the lpe audio device and creates a new</i></td></tr>
<tr><th id="46">46</th><td><i class="doc"> * sound card</i></td></tr>
<tr><th id="47">47</th><td><i class="doc"> *</i></td></tr>
<tr><th id="48">48</th><td><i class="doc"> * Threats:</i></td></tr>
<tr><th id="49">49</th><td><i class="doc"> * Due to the restriction in Linux platform device model, user need manually</i></td></tr>
<tr><th id="50">50</th><td><i class="doc"> * uninstall the hdmi-lpe-audio driver before uninstalling i915 module,</i></td></tr>
<tr><th id="51">51</th><td><i class="doc"> * otherwise we might run into use-after-free issues after i915 removes the</i></td></tr>
<tr><th id="52">52</th><td><i class="doc"> * platform device: even though hdmi-lpe-audio driver is released, the modules</i></td></tr>
<tr><th id="53">53</th><td><i class="doc"> * is still in "installed" status.</i></td></tr>
<tr><th id="54">54</th><td><i class="doc"> *</i></td></tr>
<tr><th id="55">55</th><td><i class="doc"> * Implementation:</i></td></tr>
<tr><th id="56">56</th><td><i class="doc"> * The MMIO/REG platform resources are created according to the registers</i></td></tr>
<tr><th id="57">57</th><td><i class="doc"> * specification.</i></td></tr>
<tr><th id="58">58</th><td><i class="doc"> * When forwarding LPE audio irqs, the flow control handler selection depends</i></td></tr>
<tr><th id="59">59</th><td><i class="doc"> * on the platform, for example on valleyview handle_simple_irq is enough.</i></td></tr>
<tr><th id="60">60</th><td><i class="doc"> *</i></td></tr>
<tr><th id="61">61</th><td><i class="doc"> */</i></td></tr>
<tr><th id="62">62</th><td></td></tr>
<tr><th id="63">63</th><td><u>#include <a href="../../../../include/linux/acpi.h.html">&lt;linux/acpi.h&gt;</a></u></td></tr>
<tr><th id="64">64</th><td><u>#include <a href="../../../../include/linux/device.h.html">&lt;linux/device.h&gt;</a></u></td></tr>
<tr><th id="65">65</th><td><u>#include <a href="../../../../include/linux/pci.h.html">&lt;linux/pci.h&gt;</a></u></td></tr>
<tr><th id="66">66</th><td><u>#include <a href="../../../../include/linux/pm_runtime.h.html">&lt;linux/pm_runtime.h&gt;</a></u></td></tr>
<tr><th id="67">67</th><td></td></tr>
<tr><th id="68">68</th><td><u>#include <a href="i915_drv.h.html">"i915_drv.h"</a></u></td></tr>
<tr><th id="69">69</th><td><u>#include <a href="../../../../include/linux/delay.h.html">&lt;linux/delay.h&gt;</a></u></td></tr>
<tr><th id="70">70</th><td><u>#include <a href="../../../../include/drm/intel_lpe_audio.h.html">&lt;drm/intel_lpe_audio.h&gt;</a></u></td></tr>
<tr><th id="71">71</th><td></td></tr>
<tr><th id="72">72</th><td><u>#define <dfn class="macro" id="_M/HAS_LPE_AUDIO" data-ref="_M/HAS_LPE_AUDIO">HAS_LPE_AUDIO</dfn>(dev_priv) ((dev_priv)-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_private::lpe_audio" title='drm_i915_private::lpe_audio' data-ref="drm_i915_private::lpe_audio" data-ref-filename="drm_i915_private..lpe_audio">lpe_audio</a>.<a class="ref field" href="i915_drv.h.html#drm_i915_private::(anonymous)::platdev" title='drm_i915_private::(anonymous struct)::platdev' data-ref="drm_i915_private::(anonymous)::platdev" data-ref-filename="drm_i915_private..(anonymous)..platdev">platdev</a> != NULL)</u></td></tr>
<tr><th id="73">73</th><td></td></tr>
<tr><th id="74">74</th><td><em>static</em> <b>struct</b> <a class="type" href="../../../../include/linux/platform_device.h.html#platform_device" title='platform_device' data-ref="platform_device" data-ref-filename="platform_device">platform_device</a> *</td></tr>
<tr><th id="75">75</th><td><dfn class="tu decl def fn" id="lpe_audio_platdev_create" title='lpe_audio_platdev_create' data-type='struct platform_device * lpe_audio_platdev_create(struct drm_i915_private * dev_priv)' data-ref="lpe_audio_platdev_create" data-ref-filename="lpe_audio_platdev_create">lpe_audio_platdev_create</dfn>(<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col1 decl" id="1dev_priv" title='dev_priv' data-type='struct drm_i915_private *' data-ref="1dev_priv" data-ref-filename="1dev_priv">dev_priv</dfn>)</td></tr>
<tr><th id="76">76</th><td>{</td></tr>
<tr><th id="77">77</th><td>	<em>int</em> <dfn class="local col2 decl" id="2ret" title='ret' data-type='int' data-ref="2ret" data-ref-filename="2ret">ret</dfn>;</td></tr>
<tr><th id="78">78</th><td>	<b>struct</b> <a class="type" href="../../../../include/drm/drm_device.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *<dfn class="local col3 decl" id="3dev" title='dev' data-type='struct drm_device *' data-ref="3dev" data-ref-filename="3dev">dev</dfn> = &amp;<a class="local col1 ref" href="#1dev_priv" title='dev_priv' data-ref="1dev_priv" data-ref-filename="1dev_priv">dev_priv</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_private::drm" title='drm_i915_private::drm' data-ref="drm_i915_private::drm" data-ref-filename="drm_i915_private..drm">drm</a>;</td></tr>
<tr><th id="79">79</th><td>	<b>struct</b> <a class="type" href="../../../../include/linux/platform_device.h.html#platform_device_info" title='platform_device_info' data-ref="platform_device_info" data-ref-filename="platform_device_info">platform_device_info</a> <dfn class="local col4 decl" id="4pinfo" title='pinfo' data-type='struct platform_device_info' data-ref="4pinfo" data-ref-filename="4pinfo">pinfo</dfn> = {};</td></tr>
<tr><th id="80">80</th><td>	<b>struct</b> <a class="type" href="../../../../include/linux/ioport.h.html#resource" title='resource' data-ref="resource" data-ref-filename="resource">resource</a> *<dfn class="local col5 decl" id="5rsc" title='rsc' data-type='struct resource *' data-ref="5rsc" data-ref-filename="5rsc">rsc</dfn>;</td></tr>
<tr><th id="81">81</th><td>	<b>struct</b> <a class="type" href="../../../../include/linux/platform_device.h.html#platform_device" title='platform_device' data-ref="platform_device" data-ref-filename="platform_device">platform_device</a> *<dfn class="local col6 decl" id="6platdev" title='platdev' data-type='struct platform_device *' data-ref="6platdev" data-ref-filename="6platdev">platdev</dfn>;</td></tr>
<tr><th id="82">82</th><td>	<b>struct</b> <a class="type" href="../../../../include/drm/intel_lpe_audio.h.html#intel_hdmi_lpe_audio_pdata" title='intel_hdmi_lpe_audio_pdata' data-ref="intel_hdmi_lpe_audio_pdata" data-ref-filename="intel_hdmi_lpe_audio_pdata">intel_hdmi_lpe_audio_pdata</a> *<dfn class="local col7 decl" id="7pdata" title='pdata' data-type='struct intel_hdmi_lpe_audio_pdata *' data-ref="7pdata" data-ref-filename="7pdata">pdata</dfn>;</td></tr>
<tr><th id="83">83</th><td></td></tr>
<tr><th id="84">84</th><td>	<a class="local col7 ref" href="#7pdata" title='pdata' data-ref="7pdata" data-ref-filename="7pdata">pdata</a> = <a class="ref fn" href="../../../../include/linux/slab.h.html#kzalloc" title='kzalloc' data-ref="kzalloc" data-ref-filename="kzalloc">kzalloc</a>(<b>sizeof</b>(*<a class="local col7 ref" href="#7pdata" title='pdata' data-ref="7pdata" data-ref-filename="7pdata">pdata</a>), <a class="macro" href="../../../../include/linux/gfp.h.html#273" title="((( gfp_t)(0x400000u|0x1000000u)) | (( gfp_t)0x40u) | (( gfp_t)0x80u))" data-ref="_M/GFP_KERNEL">GFP_KERNEL</a>);</td></tr>
<tr><th id="85">85</th><td>	<b>if</b> (!<a class="local col7 ref" href="#7pdata" title='pdata' data-ref="7pdata" data-ref-filename="7pdata">pdata</a>)</td></tr>
<tr><th id="86">86</th><td>		<b>return</b> <a class="ref fn" href="../../../../include/linux/err.h.html#ERR_PTR" title='ERR_PTR' data-ref="ERR_PTR" data-ref-filename="ERR_PTR">ERR_PTR</a>(-<a class="macro" href="../../../../include/uapi/asm-generic/errno-base.h.html#16" title="12" data-ref="_M/ENOMEM">ENOMEM</a>);</td></tr>
<tr><th id="87">87</th><td></td></tr>
<tr><th id="88">88</th><td>	<a class="local col5 ref" href="#5rsc" title='rsc' data-ref="5rsc" data-ref-filename="5rsc">rsc</a> = <a class="ref fn" href="../../../../include/linux/slab.h.html#kcalloc" title='kcalloc' data-ref="kcalloc" data-ref-filename="kcalloc">kcalloc</a>(<var>2</var>, <b>sizeof</b>(*<a class="local col5 ref" href="#5rsc" title='rsc' data-ref="5rsc" data-ref-filename="5rsc">rsc</a>), <a class="macro" href="../../../../include/linux/gfp.h.html#273" title="((( gfp_t)(0x400000u|0x1000000u)) | (( gfp_t)0x40u) | (( gfp_t)0x80u))" data-ref="_M/GFP_KERNEL">GFP_KERNEL</a>);</td></tr>
<tr><th id="89">89</th><td>	<b>if</b> (!<a class="local col5 ref" href="#5rsc" title='rsc' data-ref="5rsc" data-ref-filename="5rsc">rsc</a>) {</td></tr>
<tr><th id="90">90</th><td>		<a class="ref fn" href="../../../../include/linux/slab.h.html#kfree" title='kfree' data-ref="kfree" data-ref-filename="kfree">kfree</a>(<a class="local col7 ref" href="#7pdata" title='pdata' data-ref="7pdata" data-ref-filename="7pdata">pdata</a>);</td></tr>
<tr><th id="91">91</th><td>		<b>return</b> <a class="ref fn" href="../../../../include/linux/err.h.html#ERR_PTR" title='ERR_PTR' data-ref="ERR_PTR" data-ref-filename="ERR_PTR">ERR_PTR</a>(-<a class="macro" href="../../../../include/uapi/asm-generic/errno-base.h.html#16" title="12" data-ref="_M/ENOMEM">ENOMEM</a>);</td></tr>
<tr><th id="92">92</th><td>	}</td></tr>
<tr><th id="93">93</th><td></td></tr>
<tr><th id="94">94</th><td>	<a class="local col5 ref" href="#5rsc" title='rsc' data-ref="5rsc" data-ref-filename="5rsc">rsc</a>[<var>0</var>].<a class="ref field" href="../../../../include/linux/ioport.h.html#resource::start" title='resource::start' data-ref="resource::start" data-ref-filename="resource..start">start</a>    = <a class="local col5 ref" href="#5rsc" title='rsc' data-ref="5rsc" data-ref-filename="5rsc">rsc</a>[<var>0</var>].<a class="ref field" href="../../../../include/linux/ioport.h.html#resource::end" title='resource::end' data-ref="resource::end" data-ref-filename="resource..end">end</a> = <a class="local col1 ref" href="#1dev_priv" title='dev_priv' data-ref="1dev_priv" data-ref-filename="1dev_priv">dev_priv</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_private::lpe_audio" title='drm_i915_private::lpe_audio' data-ref="drm_i915_private::lpe_audio" data-ref-filename="drm_i915_private..lpe_audio">lpe_audio</a>.<a class="ref field" href="i915_drv.h.html#drm_i915_private::(anonymous)::irq" title='drm_i915_private::(anonymous struct)::irq' data-ref="drm_i915_private::(anonymous)::irq" data-ref-filename="drm_i915_private..(anonymous)..irq">irq</a>;</td></tr>
<tr><th id="95">95</th><td>	<a class="local col5 ref" href="#5rsc" title='rsc' data-ref="5rsc" data-ref-filename="5rsc">rsc</a>[<var>0</var>].<a class="ref field" href="../../../../include/linux/ioport.h.html#resource::flags" title='resource::flags' data-ref="resource::flags" data-ref-filename="resource..flags">flags</a>    = <a class="macro" href="../../../../include/linux/ioport.h.html#40" title="0x00000400" data-ref="_M/IORESOURCE_IRQ">IORESOURCE_IRQ</a>;</td></tr>
<tr><th id="96">96</th><td>	<a class="local col5 ref" href="#5rsc" title='rsc' data-ref="5rsc" data-ref-filename="5rsc">rsc</a>[<var>0</var>].<a class="ref field" href="../../../../include/linux/ioport.h.html#resource::name" title='resource::name' data-ref="resource::name" data-ref-filename="resource..name">name</a>     = <q>"hdmi-lpe-audio-irq"</q>;</td></tr>
<tr><th id="97">97</th><td></td></tr>
<tr><th id="98">98</th><td>	<a class="local col5 ref" href="#5rsc" title='rsc' data-ref="5rsc" data-ref-filename="5rsc">rsc</a>[<var>1</var>].<a class="ref field" href="../../../../include/linux/ioport.h.html#resource::start" title='resource::start' data-ref="resource::start" data-ref-filename="resource..start">start</a>    = <a class="macro" href="../../../../include/linux/pci.h.html#1731" title="((dev-&gt;pdev)-&gt;resource[(0)].start)" data-ref="_M/pci_resource_start">pci_resource_start</a>(<a class="local col3 ref" href="#3dev" title='dev' data-ref="3dev" data-ref-filename="3dev">dev</a>-&gt;<a class="ref field" href="../../../../include/drm/drm_device.h.html#drm_device::pdev" title='drm_device::pdev' data-ref="drm_device::pdev" data-ref-filename="drm_device..pdev">pdev</a>, <var>0</var>) +</td></tr>
<tr><th id="99">99</th><td>		<a class="macro" href="i915_reg.h.html#2837" title="(0x180000 + 0x65000)" data-ref="_M/I915_HDMI_LPE_AUDIO_BASE">I915_HDMI_LPE_AUDIO_BASE</a>;</td></tr>
<tr><th id="100">100</th><td>	<a class="local col5 ref" href="#5rsc" title='rsc' data-ref="5rsc" data-ref-filename="5rsc">rsc</a>[<var>1</var>].<a class="ref field" href="../../../../include/linux/ioport.h.html#resource::end" title='resource::end' data-ref="resource::end" data-ref-filename="resource..end">end</a>      = <a class="macro" href="../../../../include/linux/pci.h.html#1731" title="((dev-&gt;pdev)-&gt;resource[(0)].start)" data-ref="_M/pci_resource_start">pci_resource_start</a>(<a class="local col3 ref" href="#3dev" title='dev' data-ref="3dev" data-ref-filename="3dev">dev</a>-&gt;<a class="ref field" href="../../../../include/drm/drm_device.h.html#drm_device::pdev" title='drm_device::pdev' data-ref="drm_device::pdev" data-ref-filename="drm_device..pdev">pdev</a>, <var>0</var>) +</td></tr>
<tr><th id="101">101</th><td>		<a class="macro" href="i915_reg.h.html#2837" title="(0x180000 + 0x65000)" data-ref="_M/I915_HDMI_LPE_AUDIO_BASE">I915_HDMI_LPE_AUDIO_BASE</a> + <a class="macro" href="i915_reg.h.html#2838" title="0x1000" data-ref="_M/I915_HDMI_LPE_AUDIO_SIZE">I915_HDMI_LPE_AUDIO_SIZE</a> - <var>1</var>;</td></tr>
<tr><th id="102">102</th><td>	<a class="local col5 ref" href="#5rsc" title='rsc' data-ref="5rsc" data-ref-filename="5rsc">rsc</a>[<var>1</var>].<a class="ref field" href="../../../../include/linux/ioport.h.html#resource::flags" title='resource::flags' data-ref="resource::flags" data-ref-filename="resource..flags">flags</a>    = <a class="macro" href="../../../../include/linux/ioport.h.html#38" title="0x00000200" data-ref="_M/IORESOURCE_MEM">IORESOURCE_MEM</a>;</td></tr>
<tr><th id="103">103</th><td>	<a class="local col5 ref" href="#5rsc" title='rsc' data-ref="5rsc" data-ref-filename="5rsc">rsc</a>[<var>1</var>].<a class="ref field" href="../../../../include/linux/ioport.h.html#resource::name" title='resource::name' data-ref="resource::name" data-ref-filename="resource..name">name</a>     = <q>"hdmi-lpe-audio-mmio"</q>;</td></tr>
<tr><th id="104">104</th><td></td></tr>
<tr><th id="105">105</th><td>	<a class="local col4 ref" href="#4pinfo" title='pinfo' data-ref="4pinfo" data-ref-filename="4pinfo">pinfo</a>.<a class="ref field" href="../../../../include/linux/platform_device.h.html#platform_device_info::parent" title='platform_device_info::parent' data-ref="platform_device_info::parent" data-ref-filename="platform_device_info..parent">parent</a> = <a class="local col3 ref" href="#3dev" title='dev' data-ref="3dev" data-ref-filename="3dev">dev</a>-&gt;<a class="ref field" href="../../../../include/drm/drm_device.h.html#drm_device::dev" title='drm_device::dev' data-ref="drm_device::dev" data-ref-filename="drm_device..dev">dev</a>;</td></tr>
<tr><th id="106">106</th><td>	<a class="local col4 ref" href="#4pinfo" title='pinfo' data-ref="4pinfo" data-ref-filename="4pinfo">pinfo</a>.<a class="ref field" href="../../../../include/linux/platform_device.h.html#platform_device_info::name" title='platform_device_info::name' data-ref="platform_device_info::name" data-ref-filename="platform_device_info..name">name</a> = <q>"hdmi-lpe-audio"</q>;</td></tr>
<tr><th id="107">107</th><td>	<a class="local col4 ref" href="#4pinfo" title='pinfo' data-ref="4pinfo" data-ref-filename="4pinfo">pinfo</a>.<a class="ref field" href="../../../../include/linux/platform_device.h.html#platform_device_info::id" title='platform_device_info::id' data-ref="platform_device_info::id" data-ref-filename="platform_device_info..id">id</a> = -<var>1</var>;</td></tr>
<tr><th id="108">108</th><td>	<a class="local col4 ref" href="#4pinfo" title='pinfo' data-ref="4pinfo" data-ref-filename="4pinfo">pinfo</a>.<a class="ref field" href="../../../../include/linux/platform_device.h.html#platform_device_info::res" title='platform_device_info::res' data-ref="platform_device_info::res" data-ref-filename="platform_device_info..res">res</a> = <a class="local col5 ref" href="#5rsc" title='rsc' data-ref="5rsc" data-ref-filename="5rsc">rsc</a>;</td></tr>
<tr><th id="109">109</th><td>	<a class="local col4 ref" href="#4pinfo" title='pinfo' data-ref="4pinfo" data-ref-filename="4pinfo">pinfo</a>.<a class="ref field" href="../../../../include/linux/platform_device.h.html#platform_device_info::num_res" title='platform_device_info::num_res' data-ref="platform_device_info::num_res" data-ref-filename="platform_device_info..num_res">num_res</a> = <var>2</var>;</td></tr>
<tr><th id="110">110</th><td>	<a class="local col4 ref" href="#4pinfo" title='pinfo' data-ref="4pinfo" data-ref-filename="4pinfo">pinfo</a>.<a class="ref field" href="../../../../include/linux/platform_device.h.html#platform_device_info::data" title='platform_device_info::data' data-ref="platform_device_info::data" data-ref-filename="platform_device_info..data">data</a> = <a class="local col7 ref" href="#7pdata" title='pdata' data-ref="7pdata" data-ref-filename="7pdata">pdata</a>;</td></tr>
<tr><th id="111">111</th><td>	<a class="local col4 ref" href="#4pinfo" title='pinfo' data-ref="4pinfo" data-ref-filename="4pinfo">pinfo</a>.<a class="ref field" href="../../../../include/linux/platform_device.h.html#platform_device_info::size_data" title='platform_device_info::size_data' data-ref="platform_device_info::size_data" data-ref-filename="platform_device_info..size_data">size_data</a> = <b>sizeof</b>(*<a class="local col7 ref" href="#7pdata" title='pdata' data-ref="7pdata" data-ref-filename="7pdata">pdata</a>);</td></tr>
<tr><th id="112">112</th><td>	<a class="local col4 ref" href="#4pinfo" title='pinfo' data-ref="4pinfo" data-ref-filename="4pinfo">pinfo</a>.<a class="ref field" href="../../../../include/linux/platform_device.h.html#platform_device_info::dma_mask" title='platform_device_info::dma_mask' data-ref="platform_device_info::dma_mask" data-ref-filename="platform_device_info..dma_mask">dma_mask</a> = <a class="macro" href="../../../../include/linux/dma-mapping.h.html#142" title="(((32) == 64) ? ~0ULL : ((1ULL&lt;&lt;(32))-1))" data-ref="_M/DMA_BIT_MASK">DMA_BIT_MASK</a>(<var>32</var>);</td></tr>
<tr><th id="113">113</th><td></td></tr>
<tr><th id="114">114</th><td>	<a class="local col7 ref" href="#7pdata" title='pdata' data-ref="7pdata" data-ref-filename="7pdata">pdata</a>-&gt;<a class="ref field" href="../../../../include/drm/intel_lpe_audio.h.html#intel_hdmi_lpe_audio_pdata::num_pipes" title='intel_hdmi_lpe_audio_pdata::num_pipes' data-ref="intel_hdmi_lpe_audio_pdata::num_pipes" data-ref-filename="intel_hdmi_lpe_audio_pdata..num_pipes">num_pipes</a> = <a class="macro" href="i915_drv.h.html#2937" title="intel_info((dev_priv))" data-ref="_M/INTEL_INFO">INTEL_INFO</a>(<a class="local col1 ref" href="#1dev_priv" title='dev_priv' data-ref="1dev_priv" data-ref-filename="1dev_priv">dev_priv</a>)-&gt;<a class="ref field" href="i915_drv.h.html#intel_device_info::num_pipes" title='intel_device_info::num_pipes' data-ref="intel_device_info::num_pipes" data-ref-filename="intel_device_info..num_pipes">num_pipes</a>;</td></tr>
<tr><th id="115">115</th><td>	<a class="local col7 ref" href="#7pdata" title='pdata' data-ref="7pdata" data-ref-filename="7pdata">pdata</a>-&gt;<a class="ref field" href="../../../../include/drm/intel_lpe_audio.h.html#intel_hdmi_lpe_audio_pdata::num_ports" title='intel_hdmi_lpe_audio_pdata::num_ports' data-ref="intel_hdmi_lpe_audio_pdata::num_ports" data-ref-filename="intel_hdmi_lpe_audio_pdata..num_ports">num_ports</a> = <a class="macro" href="i915_drv.h.html#2994" title="((dev_priv)-&gt;info.platform_mask &amp; (1UL &lt;&lt; (INTEL_CHERRYVIEW)))" data-ref="_M/IS_CHERRYVIEW">IS_CHERRYVIEW</a>(<a class="local col1 ref" href="#1dev_priv" title='dev_priv' data-ref="1dev_priv" data-ref-filename="1dev_priv">dev_priv</a>) ? <var>3</var> : <var>2</var>; <i>/* B,C,D or B,C */</i></td></tr>
<tr><th id="116">116</th><td>	<a class="local col7 ref" href="#7pdata" title='pdata' data-ref="7pdata" data-ref-filename="7pdata">pdata</a>-&gt;<a class="ref field" href="../../../../include/drm/intel_lpe_audio.h.html#intel_hdmi_lpe_audio_pdata::port" title='intel_hdmi_lpe_audio_pdata::port' data-ref="intel_hdmi_lpe_audio_pdata::port" data-ref-filename="intel_hdmi_lpe_audio_pdata..port">port</a>[<var>0</var>].<a class="ref field" href="../../../../include/drm/intel_lpe_audio.h.html#intel_hdmi_lpe_audio_port_pdata::pipe" title='intel_hdmi_lpe_audio_port_pdata::pipe' data-ref="intel_hdmi_lpe_audio_port_pdata::pipe" data-ref-filename="intel_hdmi_lpe_audio_port_pdata..pipe">pipe</a> = -<var>1</var>;</td></tr>
<tr><th id="117">117</th><td>	<a class="local col7 ref" href="#7pdata" title='pdata' data-ref="7pdata" data-ref-filename="7pdata">pdata</a>-&gt;<a class="ref field" href="../../../../include/drm/intel_lpe_audio.h.html#intel_hdmi_lpe_audio_pdata::port" title='intel_hdmi_lpe_audio_pdata::port' data-ref="intel_hdmi_lpe_audio_pdata::port" data-ref-filename="intel_hdmi_lpe_audio_pdata..port">port</a>[<var>1</var>].<a class="ref field" href="../../../../include/drm/intel_lpe_audio.h.html#intel_hdmi_lpe_audio_port_pdata::pipe" title='intel_hdmi_lpe_audio_port_pdata::pipe' data-ref="intel_hdmi_lpe_audio_port_pdata::pipe" data-ref-filename="intel_hdmi_lpe_audio_port_pdata..pipe">pipe</a> = -<var>1</var>;</td></tr>
<tr><th id="118">118</th><td>	<a class="local col7 ref" href="#7pdata" title='pdata' data-ref="7pdata" data-ref-filename="7pdata">pdata</a>-&gt;<a class="ref field" href="../../../../include/drm/intel_lpe_audio.h.html#intel_hdmi_lpe_audio_pdata::port" title='intel_hdmi_lpe_audio_pdata::port' data-ref="intel_hdmi_lpe_audio_pdata::port" data-ref-filename="intel_hdmi_lpe_audio_pdata..port">port</a>[<var>2</var>].<a class="ref field" href="../../../../include/drm/intel_lpe_audio.h.html#intel_hdmi_lpe_audio_port_pdata::pipe" title='intel_hdmi_lpe_audio_port_pdata::pipe' data-ref="intel_hdmi_lpe_audio_port_pdata::pipe" data-ref-filename="intel_hdmi_lpe_audio_port_pdata..pipe">pipe</a> = -<var>1</var>;</td></tr>
<tr><th id="119">119</th><td>	<a class="macro" href="../../../../include/linux/spinlock.h.html#302" title="do { spinlock_check(&amp;pdata-&gt;lpe_audio_slock); do { *(&amp;(&amp;pdata-&gt;lpe_audio_slock)-&gt;rlock) = (raw_spinlock_t) { .raw_lock = { { (0) } }, }; } while (0); } while (0)" data-ref="_M/spin_lock_init">spin_lock_init</a>(&amp;<a class="local col7 ref" href="#7pdata" title='pdata' data-ref="7pdata" data-ref-filename="7pdata">pdata</a>-&gt;<a class="ref field" href="../../../../include/drm/intel_lpe_audio.h.html#intel_hdmi_lpe_audio_pdata::lpe_audio_slock" title='intel_hdmi_lpe_audio_pdata::lpe_audio_slock' data-ref="intel_hdmi_lpe_audio_pdata::lpe_audio_slock" data-ref-filename="intel_hdmi_lpe_audio_pdata..lpe_audio_slock">lpe_audio_slock</a>);</td></tr>
<tr><th id="120">120</th><td></td></tr>
<tr><th id="121">121</th><td>	<a class="local col6 ref" href="#6platdev" title='platdev' data-ref="6platdev" data-ref-filename="6platdev">platdev</a> = <a class="ref fn" href="../../../../include/linux/platform_device.h.html#platform_device_register_full" title='platform_device_register_full' data-ref="platform_device_register_full" data-ref-filename="platform_device_register_full">platform_device_register_full</a>(&amp;<a class="local col4 ref" href="#4pinfo" title='pinfo' data-ref="4pinfo" data-ref-filename="4pinfo">pinfo</a>);</td></tr>
<tr><th id="122">122</th><td>	<b>if</b> (<a class="ref fn" href="../../../../include/linux/err.h.html#IS_ERR" title='IS_ERR' data-ref="IS_ERR" data-ref-filename="IS_ERR">IS_ERR</a>(<a class="local col6 ref" href="#6platdev" title='platdev' data-ref="6platdev" data-ref-filename="6platdev">platdev</a>)) {</td></tr>
<tr><th id="123">123</th><td>		<a class="local col2 ref" href="#2ret" title='ret' data-ref="2ret" data-ref-filename="2ret">ret</a> = <a class="ref fn" href="../../../../include/linux/err.h.html#PTR_ERR" title='PTR_ERR' data-ref="PTR_ERR" data-ref-filename="PTR_ERR">PTR_ERR</a>(<a class="local col6 ref" href="#6platdev" title='platdev' data-ref="6platdev" data-ref-filename="6platdev">platdev</a>);</td></tr>
<tr><th id="124">124</th><td>		<a class="macro" href="../../../../include/drm/drmP.h.html#178" title="drm_printk(&quot;\001&quot; &quot;3&quot;, 0x00, &quot;Failed to allocate LPE audio platform device\n&quot;)" data-ref="_M/DRM_ERROR">DRM_ERROR</a>(<q>"Failed to allocate LPE audio platform device\n"</q>);</td></tr>
<tr><th id="125">125</th><td>		<b>goto</b> <a class="lbl" href="#8err" data-ref="8err" data-ref-filename="8err">err</a>;</td></tr>
<tr><th id="126">126</th><td>	}</td></tr>
<tr><th id="127">127</th><td></td></tr>
<tr><th id="128">128</th><td>	<a class="ref fn" href="../../../../include/linux/slab.h.html#kfree" title='kfree' data-ref="kfree" data-ref-filename="kfree">kfree</a>(<a class="local col5 ref" href="#5rsc" title='rsc' data-ref="5rsc" data-ref-filename="5rsc">rsc</a>);</td></tr>
<tr><th id="129">129</th><td></td></tr>
<tr><th id="130">130</th><td>	<a class="ref fn" href="../../../../include/linux/pm_runtime.h.html#pm_runtime_forbid" title='pm_runtime_forbid' data-ref="pm_runtime_forbid" data-ref-filename="pm_runtime_forbid">pm_runtime_forbid</a>(&amp;<a class="local col6 ref" href="#6platdev" title='platdev' data-ref="6platdev" data-ref-filename="6platdev">platdev</a>-&gt;<a class="ref field" href="../../../../include/linux/platform_device.h.html#platform_device::dev" title='platform_device::dev' data-ref="platform_device::dev" data-ref-filename="platform_device..dev">dev</a>);</td></tr>
<tr><th id="131">131</th><td>	<a class="ref fn" href="../../../../include/linux/pm_runtime.h.html#pm_runtime_set_active" title='pm_runtime_set_active' data-ref="pm_runtime_set_active" data-ref-filename="pm_runtime_set_active">pm_runtime_set_active</a>(&amp;<a class="local col6 ref" href="#6platdev" title='platdev' data-ref="6platdev" data-ref-filename="6platdev">platdev</a>-&gt;<a class="ref field" href="../../../../include/linux/platform_device.h.html#platform_device::dev" title='platform_device::dev' data-ref="platform_device::dev" data-ref-filename="platform_device..dev">dev</a>);</td></tr>
<tr><th id="132">132</th><td>	<a class="ref fn" href="../../../../include/linux/pm_runtime.h.html#pm_runtime_enable" title='pm_runtime_enable' data-ref="pm_runtime_enable" data-ref-filename="pm_runtime_enable">pm_runtime_enable</a>(&amp;<a class="local col6 ref" href="#6platdev" title='platdev' data-ref="6platdev" data-ref-filename="6platdev">platdev</a>-&gt;<a class="ref field" href="../../../../include/linux/platform_device.h.html#platform_device::dev" title='platform_device::dev' data-ref="platform_device::dev" data-ref-filename="platform_device..dev">dev</a>);</td></tr>
<tr><th id="133">133</th><td></td></tr>
<tr><th id="134">134</th><td>	<b>return</b> <a class="local col6 ref" href="#6platdev" title='platdev' data-ref="6platdev" data-ref-filename="6platdev">platdev</a>;</td></tr>
<tr><th id="135">135</th><td></td></tr>
<tr><th id="136">136</th><td><dfn class="lbl" id="8err" data-ref="8err" data-ref-filename="8err">err</dfn>:</td></tr>
<tr><th id="137">137</th><td>	<a class="ref fn" href="../../../../include/linux/slab.h.html#kfree" title='kfree' data-ref="kfree" data-ref-filename="kfree">kfree</a>(<a class="local col5 ref" href="#5rsc" title='rsc' data-ref="5rsc" data-ref-filename="5rsc">rsc</a>);</td></tr>
<tr><th id="138">138</th><td>	<a class="ref fn" href="../../../../include/linux/slab.h.html#kfree" title='kfree' data-ref="kfree" data-ref-filename="kfree">kfree</a>(<a class="local col7 ref" href="#7pdata" title='pdata' data-ref="7pdata" data-ref-filename="7pdata">pdata</a>);</td></tr>
<tr><th id="139">139</th><td>	<b>return</b> <a class="ref fn" href="../../../../include/linux/err.h.html#ERR_PTR" title='ERR_PTR' data-ref="ERR_PTR" data-ref-filename="ERR_PTR">ERR_PTR</a>(<a class="local col2 ref" href="#2ret" title='ret' data-ref="2ret" data-ref-filename="2ret">ret</a>);</td></tr>
<tr><th id="140">140</th><td>}</td></tr>
<tr><th id="141">141</th><td></td></tr>
<tr><th id="142">142</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="lpe_audio_platdev_destroy" title='lpe_audio_platdev_destroy' data-type='void lpe_audio_platdev_destroy(struct drm_i915_private * dev_priv)' data-ref="lpe_audio_platdev_destroy" data-ref-filename="lpe_audio_platdev_destroy">lpe_audio_platdev_destroy</dfn>(<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col9 decl" id="9dev_priv" title='dev_priv' data-type='struct drm_i915_private *' data-ref="9dev_priv" data-ref-filename="9dev_priv">dev_priv</dfn>)</td></tr>
<tr><th id="143">143</th><td>{</td></tr>
<tr><th id="144">144</th><td>	<i>/* XXX Note that platform_device_register_full() allocates a dma_mask</i></td></tr>
<tr><th id="145">145</th><td><i>	 * and never frees it. We can't free it here as we cannot guarantee</i></td></tr>
<tr><th id="146">146</th><td><i>	 * this is the last reference (i.e. that the dma_mask will not be</i></td></tr>
<tr><th id="147">147</th><td><i>	 * used after our unregister). So ee choose to leak the sizeof(u64)</i></td></tr>
<tr><th id="148">148</th><td><i>	 * allocation here - it should be fixed in the platform_device rather</i></td></tr>
<tr><th id="149">149</th><td><i>	 * than us fiddle with its internals.</i></td></tr>
<tr><th id="150">150</th><td><i>	 */</i></td></tr>
<tr><th id="151">151</th><td></td></tr>
<tr><th id="152">152</th><td>	<a class="ref fn" href="../../../../include/linux/platform_device.h.html#platform_device_unregister" title='platform_device_unregister' data-ref="platform_device_unregister" data-ref-filename="platform_device_unregister">platform_device_unregister</a>(<a class="local col9 ref" href="#9dev_priv" title='dev_priv' data-ref="9dev_priv" data-ref-filename="9dev_priv">dev_priv</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_private::lpe_audio" title='drm_i915_private::lpe_audio' data-ref="drm_i915_private::lpe_audio" data-ref-filename="drm_i915_private..lpe_audio">lpe_audio</a>.<a class="ref field" href="i915_drv.h.html#drm_i915_private::(anonymous)::platdev" title='drm_i915_private::(anonymous struct)::platdev' data-ref="drm_i915_private::(anonymous)::platdev" data-ref-filename="drm_i915_private..(anonymous)..platdev">platdev</a>);</td></tr>
<tr><th id="153">153</th><td>}</td></tr>
<tr><th id="154">154</th><td></td></tr>
<tr><th id="155">155</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="lpe_audio_irq_unmask" title='lpe_audio_irq_unmask' data-type='void lpe_audio_irq_unmask(struct irq_data * d)' data-ref="lpe_audio_irq_unmask" data-ref-filename="lpe_audio_irq_unmask">lpe_audio_irq_unmask</dfn>(<b>struct</b> <a class="type" href="../../../../include/linux/irq.h.html#irq_data" title='irq_data' data-ref="irq_data" data-ref-filename="irq_data">irq_data</a> *<dfn class="local col0 decl" id="10d" title='d' data-type='struct irq_data *' data-ref="10d" data-ref-filename="10d">d</dfn>)</td></tr>
<tr><th id="156">156</th><td>{</td></tr>
<tr><th id="157">157</th><td>}</td></tr>
<tr><th id="158">158</th><td></td></tr>
<tr><th id="159">159</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="lpe_audio_irq_mask" title='lpe_audio_irq_mask' data-type='void lpe_audio_irq_mask(struct irq_data * d)' data-ref="lpe_audio_irq_mask" data-ref-filename="lpe_audio_irq_mask">lpe_audio_irq_mask</dfn>(<b>struct</b> <a class="type" href="../../../../include/linux/irq.h.html#irq_data" title='irq_data' data-ref="irq_data" data-ref-filename="irq_data">irq_data</a> *<dfn class="local col1 decl" id="11d" title='d' data-type='struct irq_data *' data-ref="11d" data-ref-filename="11d">d</dfn>)</td></tr>
<tr><th id="160">160</th><td>{</td></tr>
<tr><th id="161">161</th><td>}</td></tr>
<tr><th id="162">162</th><td></td></tr>
<tr><th id="163">163</th><td><em>static</em> <b>struct</b> <a class="type" href="../../../../include/linux/irq.h.html#irq_chip" title='irq_chip' data-ref="irq_chip" data-ref-filename="irq_chip">irq_chip</a> <dfn class="tu decl def" id="lpe_audio_irqchip" title='lpe_audio_irqchip' data-type='struct irq_chip' data-ref="lpe_audio_irqchip" data-ref-filename="lpe_audio_irqchip">lpe_audio_irqchip</dfn> = {</td></tr>
<tr><th id="164">164</th><td>	.<a class="ref field" href="../../../../include/linux/irq.h.html#irq_chip::name" title='irq_chip::name' data-ref="irq_chip::name" data-ref-filename="irq_chip..name">name</a> = <q>"hdmi_lpe_audio_irqchip"</q>,</td></tr>
<tr><th id="165">165</th><td>	.<a class="ref field" href="../../../../include/linux/irq.h.html#irq_chip::irq_mask" title='irq_chip::irq_mask' data-ref="irq_chip::irq_mask" data-ref-filename="irq_chip..irq_mask">irq_mask</a> = <a class="tu ref fn" href="#lpe_audio_irq_mask" title='lpe_audio_irq_mask' data-ref="lpe_audio_irq_mask" data-ref-filename="lpe_audio_irq_mask">lpe_audio_irq_mask</a>,</td></tr>
<tr><th id="166">166</th><td>	.<a class="ref field" href="../../../../include/linux/irq.h.html#irq_chip::irq_unmask" title='irq_chip::irq_unmask' data-ref="irq_chip::irq_unmask" data-ref-filename="irq_chip..irq_unmask">irq_unmask</a> = <a class="tu ref fn" href="#lpe_audio_irq_unmask" title='lpe_audio_irq_unmask' data-ref="lpe_audio_irq_unmask" data-ref-filename="lpe_audio_irq_unmask">lpe_audio_irq_unmask</a>,</td></tr>
<tr><th id="167">167</th><td>};</td></tr>
<tr><th id="168">168</th><td></td></tr>
<tr><th id="169">169</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="lpe_audio_irq_init" title='lpe_audio_irq_init' data-type='int lpe_audio_irq_init(struct drm_i915_private * dev_priv)' data-ref="lpe_audio_irq_init" data-ref-filename="lpe_audio_irq_init">lpe_audio_irq_init</dfn>(<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col2 decl" id="12dev_priv" title='dev_priv' data-type='struct drm_i915_private *' data-ref="12dev_priv" data-ref-filename="12dev_priv">dev_priv</dfn>)</td></tr>
<tr><th id="170">170</th><td>{</td></tr>
<tr><th id="171">171</th><td>	<em>int</em> <dfn class="local col3 decl" id="13irq" title='irq' data-type='int' data-ref="13irq" data-ref-filename="13irq">irq</dfn> = <a class="local col2 ref" href="#12dev_priv" title='dev_priv' data-ref="12dev_priv" data-ref-filename="12dev_priv">dev_priv</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_private::lpe_audio" title='drm_i915_private::lpe_audio' data-ref="drm_i915_private::lpe_audio" data-ref-filename="drm_i915_private..lpe_audio">lpe_audio</a>.<a class="ref field" href="i915_drv.h.html#drm_i915_private::(anonymous)::irq" title='drm_i915_private::(anonymous struct)::irq' data-ref="drm_i915_private::(anonymous)::irq" data-ref-filename="drm_i915_private..(anonymous)..irq">irq</a>;</td></tr>
<tr><th id="172">172</th><td></td></tr>
<tr><th id="173">173</th><td>	<a class="macro" href="i915_utils.h.html#37" title="({ int __ret_warn_on = !!((!intel_irqs_enabled(dev_priv))); if (__builtin_expect(!!(__ret_warn_on), 0)) do { __warn_printk(&quot;%s&quot;, &quot;WARN_ON(&quot; &quot;!intel_irqs_enabled(dev_priv)&quot; &quot;)&quot;); do { do { asm volatile(&quot;1:\t&quot; &quot;.byte 0x0f, 0x0b&quot; &quot;\n&quot; &quot;.pushsection __bug_table,\&quot;aw\&quot;\n&quot; &quot;2:\t&quot; &quot;.long &quot; &quot;1b&quot; &quot; - 2b&quot; &quot;\t# bug_entry::bug_addr\n&quot; &quot;\t&quot; &quot;.long &quot; &quot;%c0&quot; &quot; - 2b&quot; &quot;\t# bug_entry::file\n&quot; &quot;\t.word %c1&quot; &quot;\t# bug_entry::line\n&quot; &quot;\t.word %c2&quot; &quot;\t# bug_entry::flags\n&quot; &quot;\t.org 2b+%c3\n&quot; &quot;.popsection&quot; : : &quot;i&quot; (&quot;/root/linux-4.15.10/drivers/gpu/drm/i915/intel_lpe_audio.c&quot;), &quot;i&quot; (173), &quot;i&quot; ((1 &lt;&lt; 0)|(((9) &lt;&lt; 8))), &quot;i&quot; (sizeof(struct bug_entry))); } while (0); ({ asm volatile(&quot;%c0:\n\t&quot; &quot;.pushsection .discard.reachable\n\t&quot; &quot;.long %c0b - .\n\t&quot; &quot;.popsection\n\t&quot; : : &quot;i&quot; (174)); }); } while (0); } while (0); __builtin_expect(!!(__ret_warn_on), 0); })" data-ref="_M/WARN_ON">WARN_ON</a>(!<a class="ref fn" href="intel_drv.h.html#intel_irqs_enabled" title='intel_irqs_enabled' data-ref="intel_irqs_enabled" data-ref-filename="intel_irqs_enabled">intel_irqs_enabled</a>(<a class="local col2 ref" href="#12dev_priv" title='dev_priv' data-ref="12dev_priv" data-ref-filename="12dev_priv">dev_priv</a>));</td></tr>
<tr><th id="174">174</th><td>	<a class="ref fn" href="../../../../include/linux/irq.h.html#irq_set_chip_and_handler_name" title='irq_set_chip_and_handler_name' data-ref="irq_set_chip_and_handler_name" data-ref-filename="irq_set_chip_and_handler_name">irq_set_chip_and_handler_name</a>(<a class="local col3 ref" href="#13irq" title='irq' data-ref="13irq" data-ref-filename="13irq">irq</a>,</td></tr>
<tr><th id="175">175</th><td>				&amp;<a class="tu ref" href="#lpe_audio_irqchip" title='lpe_audio_irqchip' data-use='a' data-ref="lpe_audio_irqchip" data-ref-filename="lpe_audio_irqchip">lpe_audio_irqchip</a>,</td></tr>
<tr><th id="176">176</th><td>				<a class="ref fn" href="../../../../include/linux/irq.h.html#handle_simple_irq" title='handle_simple_irq' data-ref="handle_simple_irq" data-ref-filename="handle_simple_irq">handle_simple_irq</a>,</td></tr>
<tr><th id="177">177</th><td>				<q>"hdmi_lpe_audio_irq_handler"</q>);</td></tr>
<tr><th id="178">178</th><td></td></tr>
<tr><th id="179">179</th><td>	<b>return</b> <a class="ref fn" href="../../../../include/linux/irq.h.html#irq_set_chip_data" title='irq_set_chip_data' data-ref="irq_set_chip_data" data-ref-filename="irq_set_chip_data">irq_set_chip_data</a>(<a class="local col3 ref" href="#13irq" title='irq' data-ref="13irq" data-ref-filename="13irq">irq</a>, <a class="local col2 ref" href="#12dev_priv" title='dev_priv' data-ref="12dev_priv" data-ref-filename="12dev_priv">dev_priv</a>);</td></tr>
<tr><th id="180">180</th><td>}</td></tr>
<tr><th id="181">181</th><td></td></tr>
<tr><th id="182">182</th><td><em>static</em> <a class="typedef" href="../../../../include/linux/types.h.html#bool" title='bool' data-type='_Bool' data-ref="bool" data-ref-filename="bool">bool</a> <dfn class="tu decl def fn" id="lpe_audio_detect" title='lpe_audio_detect' data-type='bool lpe_audio_detect(struct drm_i915_private * dev_priv)' data-ref="lpe_audio_detect" data-ref-filename="lpe_audio_detect">lpe_audio_detect</dfn>(<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col4 decl" id="14dev_priv" title='dev_priv' data-type='struct drm_i915_private *' data-ref="14dev_priv" data-ref-filename="14dev_priv">dev_priv</dfn>)</td></tr>
<tr><th id="183">183</th><td>{</td></tr>
<tr><th id="184">184</th><td>	<em>int</em> <dfn class="local col5 decl" id="15lpe_present" title='lpe_present' data-type='int' data-ref="15lpe_present" data-ref-filename="15lpe_present">lpe_present</dfn> = <a class="enum" href="../../../../include/linux/stddef.h.html#false" title='false' data-ref="false" data-ref-filename="false">false</a>;</td></tr>
<tr><th id="185">185</th><td></td></tr>
<tr><th id="186">186</th><td>	<b>if</b> (<a class="macro" href="i915_drv.h.html#2993" title="((dev_priv)-&gt;info.platform_mask &amp; (1UL &lt;&lt; (INTEL_VALLEYVIEW)))" data-ref="_M/IS_VALLEYVIEW">IS_VALLEYVIEW</a>(<a class="local col4 ref" href="#14dev_priv" title='dev_priv' data-ref="14dev_priv" data-ref-filename="14dev_priv">dev_priv</a>) || <a class="macro" href="i915_drv.h.html#2994" title="((dev_priv)-&gt;info.platform_mask &amp; (1UL &lt;&lt; (INTEL_CHERRYVIEW)))" data-ref="_M/IS_CHERRYVIEW">IS_CHERRYVIEW</a>(<a class="local col4 ref" href="#14dev_priv" title='dev_priv' data-ref="14dev_priv" data-ref-filename="14dev_priv">dev_priv</a>)) {</td></tr>
<tr><th id="187">187</th><td>		<em>static</em> <em>const</em> <b>struct</b> <a class="type" href="../../../../include/linux/mod_devicetable.h.html#pci_device_id" title='pci_device_id' data-ref="pci_device_id" data-ref-filename="pci_device_id">pci_device_id</a> <dfn class="local col6 decl" id="16atom_hdaudio_ids" title='atom_hdaudio_ids' data-type='const struct pci_device_id [3]' data-ref="16atom_hdaudio_ids" data-ref-filename="16atom_hdaudio_ids">atom_hdaudio_ids</dfn>[] = {</td></tr>
<tr><th id="188">188</th><td>			<i>/* Baytrail */</i></td></tr>
<tr><th id="189">189</th><td>			{<a class="macro" href="../../../../include/linux/pci.h.html#773" title=".vendor = (0x8086), .device = (0x0f04), .subvendor = (~0), .subdevice = (~0)" data-ref="_M/PCI_DEVICE">PCI_DEVICE</a>(<a class="macro" href="../../../../include/linux/pci_ids.h.html#2594" title="0x8086" data-ref="_M/PCI_VENDOR_ID_INTEL">PCI_VENDOR_ID_INTEL</a>, <var>0x0f04</var>)},</td></tr>
<tr><th id="190">190</th><td>			<i>/* Braswell */</i></td></tr>
<tr><th id="191">191</th><td>			{<a class="macro" href="../../../../include/linux/pci.h.html#773" title=".vendor = (0x8086), .device = (0x2284), .subvendor = (~0), .subdevice = (~0)" data-ref="_M/PCI_DEVICE">PCI_DEVICE</a>(<a class="macro" href="../../../../include/linux/pci_ids.h.html#2594" title="0x8086" data-ref="_M/PCI_VENDOR_ID_INTEL">PCI_VENDOR_ID_INTEL</a>, <var>0x2284</var>)},</td></tr>
<tr><th id="192">192</th><td>			{}</td></tr>
<tr><th id="193">193</th><td>		};</td></tr>
<tr><th id="194">194</th><td></td></tr>
<tr><th id="195">195</th><td>		<b>if</b> (!<a class="ref fn" href="../../../../include/linux/pci.h.html#pci_dev_present" title='pci_dev_present' data-ref="pci_dev_present" data-ref-filename="pci_dev_present">pci_dev_present</a>(<a class="local col6 ref" href="#16atom_hdaudio_ids" title='atom_hdaudio_ids' data-ref="16atom_hdaudio_ids" data-ref-filename="16atom_hdaudio_ids">atom_hdaudio_ids</a>)) {</td></tr>
<tr><th id="196">196</th><td>			<a class="macro" href="../../../../include/drm/drmP.h.html#155" title="do { printk(&quot;\001&quot; &quot;6&quot; &quot;[&quot; &quot;drm&quot; &quot;] &quot; &quot;HDaudio controller not detected, using LPE audio instead\n&quot;); } while (0)" data-ref="_M/DRM_INFO">DRM_INFO</a>(<q>"HDaudio controller not detected, using LPE audio instead\n"</q>);</td></tr>
<tr><th id="197">197</th><td>			<a class="local col5 ref" href="#15lpe_present" title='lpe_present' data-ref="15lpe_present" data-ref-filename="15lpe_present">lpe_present</a> = <a class="enum" href="../../../../include/linux/stddef.h.html#true" title='true' data-ref="true" data-ref-filename="true">true</a>;</td></tr>
<tr><th id="198">198</th><td>		}</td></tr>
<tr><th id="199">199</th><td>	}</td></tr>
<tr><th id="200">200</th><td>	<b>return</b> <a class="local col5 ref" href="#15lpe_present" title='lpe_present' data-ref="15lpe_present" data-ref-filename="15lpe_present">lpe_present</a>;</td></tr>
<tr><th id="201">201</th><td>}</td></tr>
<tr><th id="202">202</th><td></td></tr>
<tr><th id="203">203</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="lpe_audio_setup" title='lpe_audio_setup' data-type='int lpe_audio_setup(struct drm_i915_private * dev_priv)' data-ref="lpe_audio_setup" data-ref-filename="lpe_audio_setup">lpe_audio_setup</dfn>(<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col7 decl" id="17dev_priv" title='dev_priv' data-type='struct drm_i915_private *' data-ref="17dev_priv" data-ref-filename="17dev_priv">dev_priv</dfn>)</td></tr>
<tr><th id="204">204</th><td>{</td></tr>
<tr><th id="205">205</th><td>	<em>int</em> <dfn class="local col8 decl" id="18ret" title='ret' data-type='int' data-ref="18ret" data-ref-filename="18ret">ret</dfn>;</td></tr>
<tr><th id="206">206</th><td></td></tr>
<tr><th id="207">207</th><td>	<a class="local col7 ref" href="#17dev_priv" title='dev_priv' data-ref="17dev_priv" data-ref-filename="17dev_priv">dev_priv</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_private::lpe_audio" title='drm_i915_private::lpe_audio' data-ref="drm_i915_private::lpe_audio" data-ref-filename="drm_i915_private..lpe_audio">lpe_audio</a>.<a class="ref field" href="i915_drv.h.html#drm_i915_private::(anonymous)::irq" title='drm_i915_private::(anonymous struct)::irq' data-ref="drm_i915_private::(anonymous)::irq" data-ref-filename="drm_i915_private..(anonymous)..irq">irq</a> = <a class="macro" href="../../../../include/linux/irq.h.html#845" title="__irq_alloc_descs(-1, 0, 1, 0, ((struct module *)0), ((void *)0))" data-ref="_M/irq_alloc_desc">irq_alloc_desc</a>(<var>0</var>);</td></tr>
<tr><th id="208">208</th><td>	<b>if</b> (<a class="local col7 ref" href="#17dev_priv" title='dev_priv' data-ref="17dev_priv" data-ref-filename="17dev_priv">dev_priv</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_private::lpe_audio" title='drm_i915_private::lpe_audio' data-ref="drm_i915_private::lpe_audio" data-ref-filename="drm_i915_private..lpe_audio">lpe_audio</a>.<a class="ref field" href="i915_drv.h.html#drm_i915_private::(anonymous)::irq" title='drm_i915_private::(anonymous struct)::irq' data-ref="drm_i915_private::(anonymous)::irq" data-ref-filename="drm_i915_private..(anonymous)..irq">irq</a> &lt; <var>0</var>) {</td></tr>
<tr><th id="209">209</th><td>		<a class="macro" href="../../../../include/drm/drmP.h.html#178" title="drm_printk(&quot;\001&quot; &quot;3&quot;, 0x00, &quot;Failed to allocate IRQ desc: %d\n&quot;, dev_priv-&gt;lpe_audio.irq)" data-ref="_M/DRM_ERROR">DRM_ERROR</a>(<q>"Failed to allocate IRQ desc: %d\n"</q>,</td></tr>
<tr><th id="210">210</th><td>			<a class="local col7 ref" href="#17dev_priv" title='dev_priv' data-ref="17dev_priv" data-ref-filename="17dev_priv">dev_priv</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_private::lpe_audio" title='drm_i915_private::lpe_audio' data-ref="drm_i915_private::lpe_audio" data-ref-filename="drm_i915_private..lpe_audio">lpe_audio</a>.<a class="ref field" href="i915_drv.h.html#drm_i915_private::(anonymous)::irq" title='drm_i915_private::(anonymous struct)::irq' data-ref="drm_i915_private::(anonymous)::irq" data-ref-filename="drm_i915_private..(anonymous)..irq">irq</a>);</td></tr>
<tr><th id="211">211</th><td>		<a class="local col8 ref" href="#18ret" title='ret' data-ref="18ret" data-ref-filename="18ret">ret</a> = <a class="local col7 ref" href="#17dev_priv" title='dev_priv' data-ref="17dev_priv" data-ref-filename="17dev_priv">dev_priv</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_private::lpe_audio" title='drm_i915_private::lpe_audio' data-ref="drm_i915_private::lpe_audio" data-ref-filename="drm_i915_private..lpe_audio">lpe_audio</a>.<a class="ref field" href="i915_drv.h.html#drm_i915_private::(anonymous)::irq" title='drm_i915_private::(anonymous struct)::irq' data-ref="drm_i915_private::(anonymous)::irq" data-ref-filename="drm_i915_private..(anonymous)..irq">irq</a>;</td></tr>
<tr><th id="212">212</th><td>		<b>goto</b> <a class="lbl" href="#19err" data-ref="19err" data-ref-filename="19err">err</a>;</td></tr>
<tr><th id="213">213</th><td>	}</td></tr>
<tr><th id="214">214</th><td></td></tr>
<tr><th id="215">215</th><td>	<a class="macro" href="../../../../include/drm/drmP.h.html#221" title="drm_printk(&quot;\001&quot; &quot;7&quot;, 0x01, &quot;irq = %d\n&quot;, dev_priv-&gt;lpe_audio.irq)" data-ref="_M/DRM_DEBUG">DRM_DEBUG</a>(<q>"irq = %d\n"</q>, <a class="local col7 ref" href="#17dev_priv" title='dev_priv' data-ref="17dev_priv" data-ref-filename="17dev_priv">dev_priv</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_private::lpe_audio" title='drm_i915_private::lpe_audio' data-ref="drm_i915_private::lpe_audio" data-ref-filename="drm_i915_private..lpe_audio">lpe_audio</a>.<a class="ref field" href="i915_drv.h.html#drm_i915_private::(anonymous)::irq" title='drm_i915_private::(anonymous struct)::irq' data-ref="drm_i915_private::(anonymous)::irq" data-ref-filename="drm_i915_private..(anonymous)..irq">irq</a>);</td></tr>
<tr><th id="216">216</th><td></td></tr>
<tr><th id="217">217</th><td>	<a class="local col8 ref" href="#18ret" title='ret' data-ref="18ret" data-ref-filename="18ret">ret</a> = <a class="tu ref fn" href="#lpe_audio_irq_init" title='lpe_audio_irq_init' data-use='c' data-ref="lpe_audio_irq_init" data-ref-filename="lpe_audio_irq_init">lpe_audio_irq_init</a>(<a class="local col7 ref" href="#17dev_priv" title='dev_priv' data-ref="17dev_priv" data-ref-filename="17dev_priv">dev_priv</a>);</td></tr>
<tr><th id="218">218</th><td></td></tr>
<tr><th id="219">219</th><td>	<b>if</b> (<a class="local col8 ref" href="#18ret" title='ret' data-ref="18ret" data-ref-filename="18ret">ret</a>) {</td></tr>
<tr><th id="220">220</th><td>		<a class="macro" href="../../../../include/drm/drmP.h.html#178" title="drm_printk(&quot;\001&quot; &quot;3&quot;, 0x00, &quot;Failed to initialize irqchip for lpe audio: %d\n&quot;, ret)" data-ref="_M/DRM_ERROR">DRM_ERROR</a>(<q>"Failed to initialize irqchip for lpe audio: %d\n"</q>,</td></tr>
<tr><th id="221">221</th><td>			<a class="local col8 ref" href="#18ret" title='ret' data-ref="18ret" data-ref-filename="18ret">ret</a>);</td></tr>
<tr><th id="222">222</th><td>		<b>goto</b> <a class="lbl" href="#20err_free_irq" data-ref="20err_free_irq" data-ref-filename="20err_free_irq">err_free_irq</a>;</td></tr>
<tr><th id="223">223</th><td>	}</td></tr>
<tr><th id="224">224</th><td></td></tr>
<tr><th id="225">225</th><td>	<a class="local col7 ref" href="#17dev_priv" title='dev_priv' data-ref="17dev_priv" data-ref-filename="17dev_priv">dev_priv</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_private::lpe_audio" title='drm_i915_private::lpe_audio' data-ref="drm_i915_private::lpe_audio" data-ref-filename="drm_i915_private..lpe_audio">lpe_audio</a>.<a class="ref field" href="i915_drv.h.html#drm_i915_private::(anonymous)::platdev" title='drm_i915_private::(anonymous struct)::platdev' data-ref="drm_i915_private::(anonymous)::platdev" data-ref-filename="drm_i915_private..(anonymous)..platdev">platdev</a> = <a class="tu ref fn" href="#lpe_audio_platdev_create" title='lpe_audio_platdev_create' data-use='c' data-ref="lpe_audio_platdev_create" data-ref-filename="lpe_audio_platdev_create">lpe_audio_platdev_create</a>(<a class="local col7 ref" href="#17dev_priv" title='dev_priv' data-ref="17dev_priv" data-ref-filename="17dev_priv">dev_priv</a>);</td></tr>
<tr><th id="226">226</th><td></td></tr>
<tr><th id="227">227</th><td>	<b>if</b> (<a class="ref fn" href="../../../../include/linux/err.h.html#IS_ERR" title='IS_ERR' data-ref="IS_ERR" data-ref-filename="IS_ERR">IS_ERR</a>(<a class="local col7 ref" href="#17dev_priv" title='dev_priv' data-ref="17dev_priv" data-ref-filename="17dev_priv">dev_priv</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_private::lpe_audio" title='drm_i915_private::lpe_audio' data-ref="drm_i915_private::lpe_audio" data-ref-filename="drm_i915_private..lpe_audio">lpe_audio</a>.<a class="ref field" href="i915_drv.h.html#drm_i915_private::(anonymous)::platdev" title='drm_i915_private::(anonymous struct)::platdev' data-ref="drm_i915_private::(anonymous)::platdev" data-ref-filename="drm_i915_private..(anonymous)..platdev">platdev</a>)) {</td></tr>
<tr><th id="228">228</th><td>		<a class="local col8 ref" href="#18ret" title='ret' data-ref="18ret" data-ref-filename="18ret">ret</a> = <a class="ref fn" href="../../../../include/linux/err.h.html#PTR_ERR" title='PTR_ERR' data-ref="PTR_ERR" data-ref-filename="PTR_ERR">PTR_ERR</a>(<a class="local col7 ref" href="#17dev_priv" title='dev_priv' data-ref="17dev_priv" data-ref-filename="17dev_priv">dev_priv</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_private::lpe_audio" title='drm_i915_private::lpe_audio' data-ref="drm_i915_private::lpe_audio" data-ref-filename="drm_i915_private..lpe_audio">lpe_audio</a>.<a class="ref field" href="i915_drv.h.html#drm_i915_private::(anonymous)::platdev" title='drm_i915_private::(anonymous struct)::platdev' data-ref="drm_i915_private::(anonymous)::platdev" data-ref-filename="drm_i915_private..(anonymous)..platdev">platdev</a>);</td></tr>
<tr><th id="229">229</th><td>		<a class="macro" href="../../../../include/drm/drmP.h.html#178" title="drm_printk(&quot;\001&quot; &quot;3&quot;, 0x00, &quot;Failed to create lpe audio platform device: %d\n&quot;, ret)" data-ref="_M/DRM_ERROR">DRM_ERROR</a>(<q>"Failed to create lpe audio platform device: %d\n"</q>,</td></tr>
<tr><th id="230">230</th><td>			<a class="local col8 ref" href="#18ret" title='ret' data-ref="18ret" data-ref-filename="18ret">ret</a>);</td></tr>
<tr><th id="231">231</th><td>		<b>goto</b> <a class="lbl" href="#20err_free_irq" data-ref="20err_free_irq" data-ref-filename="20err_free_irq">err_free_irq</a>;</td></tr>
<tr><th id="232">232</th><td>	}</td></tr>
<tr><th id="233">233</th><td></td></tr>
<tr><th id="234">234</th><td>	<i>/* enable chicken bit; at least this is required for Dell Wyse 3040</i></td></tr>
<tr><th id="235">235</th><td><i>	 * with DP outputs (but only sometimes by some reason!)</i></td></tr>
<tr><th id="236">236</th><td><i>	 */</i></td></tr>
<tr><th id="237">237</th><td>	<a class="macro" href="i915_drv.h.html#4217" title="dev_priv-&gt;uncore.funcs.mmio_writel(dev_priv, (((const i915_reg_t){ .reg = (0x180000 + 0x62F38) })), ((1 &lt;&lt; 0)), true)" data-ref="_M/I915_WRITE">I915_WRITE</a>(<a class="macro" href="i915_reg.h.html#2841" title="((const i915_reg_t){ .reg = (0x180000 + 0x62F38) })" data-ref="_M/VLV_AUD_CHICKEN_BIT_REG">VLV_AUD_CHICKEN_BIT_REG</a>, <a class="macro" href="i915_reg.h.html#2842" title="(1 &lt;&lt; 0)" data-ref="_M/VLV_CHICKEN_BIT_DBG_ENABLE">VLV_CHICKEN_BIT_DBG_ENABLE</a>);</td></tr>
<tr><th id="238">238</th><td></td></tr>
<tr><th id="239">239</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="240">240</th><td><dfn class="lbl" id="20err_free_irq" data-ref="20err_free_irq" data-ref-filename="20err_free_irq">err_free_irq</dfn>:</td></tr>
<tr><th id="241">241</th><td>	<a class="ref fn" href="../../../../include/linux/irq.h.html#irq_free_desc" title='irq_free_desc' data-ref="irq_free_desc" data-ref-filename="irq_free_desc">irq_free_desc</a>(<a class="local col7 ref" href="#17dev_priv" title='dev_priv' data-ref="17dev_priv" data-ref-filename="17dev_priv">dev_priv</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_private::lpe_audio" title='drm_i915_private::lpe_audio' data-ref="drm_i915_private::lpe_audio" data-ref-filename="drm_i915_private..lpe_audio">lpe_audio</a>.<a class="ref field" href="i915_drv.h.html#drm_i915_private::(anonymous)::irq" title='drm_i915_private::(anonymous struct)::irq' data-ref="drm_i915_private::(anonymous)::irq" data-ref-filename="drm_i915_private..(anonymous)..irq">irq</a>);</td></tr>
<tr><th id="242">242</th><td><dfn class="lbl" id="19err" data-ref="19err" data-ref-filename="19err">err</dfn>:</td></tr>
<tr><th id="243">243</th><td>	<a class="local col7 ref" href="#17dev_priv" title='dev_priv' data-ref="17dev_priv" data-ref-filename="17dev_priv">dev_priv</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_private::lpe_audio" title='drm_i915_private::lpe_audio' data-ref="drm_i915_private::lpe_audio" data-ref-filename="drm_i915_private..lpe_audio">lpe_audio</a>.<a class="ref field" href="i915_drv.h.html#drm_i915_private::(anonymous)::irq" title='drm_i915_private::(anonymous struct)::irq' data-ref="drm_i915_private::(anonymous)::irq" data-ref-filename="drm_i915_private..(anonymous)..irq">irq</a> = -<var>1</var>;</td></tr>
<tr><th id="244">244</th><td>	<a class="local col7 ref" href="#17dev_priv" title='dev_priv' data-ref="17dev_priv" data-ref-filename="17dev_priv">dev_priv</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_private::lpe_audio" title='drm_i915_private::lpe_audio' data-ref="drm_i915_private::lpe_audio" data-ref-filename="drm_i915_private..lpe_audio">lpe_audio</a>.<a class="ref field" href="i915_drv.h.html#drm_i915_private::(anonymous)::platdev" title='drm_i915_private::(anonymous struct)::platdev' data-ref="drm_i915_private::(anonymous)::platdev" data-ref-filename="drm_i915_private..(anonymous)..platdev">platdev</a> = <a class="macro" href="../../../../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="245">245</th><td>	<b>return</b> <a class="local col8 ref" href="#18ret" title='ret' data-ref="18ret" data-ref-filename="18ret">ret</a>;</td></tr>
<tr><th id="246">246</th><td>}</td></tr>
<tr><th id="247">247</th><td></td></tr>
<tr><th id="248">248</th><td><i class="doc">/**</i></td></tr>
<tr><th id="249">249</th><td><i class="doc"> * intel_lpe_audio_irq_handler() - forwards the LPE audio irq</i></td></tr>
<tr><th id="250">250</th><td><i class="doc"> * <span class="command">@dev</span>_<span class="verb">priv: the i915 drm device private data</span></i></td></tr>
<tr><th id="251">251</th><td><i class="doc"> *</i></td></tr>
<tr><th id="252">252</th><td><i class="doc"> * the LPE Audio irq is forwarded to the irq handler registered by LPE audio</i></td></tr>
<tr><th id="253">253</th><td><i class="doc"> * driver.</i></td></tr>
<tr><th id="254">254</th><td><i class="doc"> */</i></td></tr>
<tr><th id="255">255</th><td><em>void</em> <dfn class="decl def fn" id="intel_lpe_audio_irq_handler" title='intel_lpe_audio_irq_handler' data-ref="intel_lpe_audio_irq_handler" data-ref-filename="intel_lpe_audio_irq_handler">intel_lpe_audio_irq_handler</dfn>(<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col1 decl" id="21dev_priv" title='dev_priv' data-type='struct drm_i915_private *' data-ref="21dev_priv" data-ref-filename="21dev_priv">dev_priv</dfn>)</td></tr>
<tr><th id="256">256</th><td>{</td></tr>
<tr><th id="257">257</th><td>	<em>int</em> <dfn class="local col2 decl" id="22ret" title='ret' data-type='int' data-ref="22ret" data-ref-filename="22ret">ret</dfn>;</td></tr>
<tr><th id="258">258</th><td></td></tr>
<tr><th id="259">259</th><td>	<b>if</b> (!<a class="macro" href="#72" title="((dev_priv)-&gt;lpe_audio.platdev != ((void *)0))" data-ref="_M/HAS_LPE_AUDIO">HAS_LPE_AUDIO</a>(<a class="local col1 ref" href="#21dev_priv" title='dev_priv' data-ref="21dev_priv" data-ref-filename="21dev_priv">dev_priv</a>))</td></tr>
<tr><th id="260">260</th><td>		<b>return</b>;</td></tr>
<tr><th id="261">261</th><td></td></tr>
<tr><th id="262">262</th><td>	<a class="local col2 ref" href="#22ret" title='ret' data-ref="22ret" data-ref-filename="22ret">ret</a> = <a class="ref fn" href="../../../../include/linux/irqdesc.h.html#generic_handle_irq" title='generic_handle_irq' data-ref="generic_handle_irq" data-ref-filename="generic_handle_irq">generic_handle_irq</a>(<a class="local col1 ref" href="#21dev_priv" title='dev_priv' data-ref="21dev_priv" data-ref-filename="21dev_priv">dev_priv</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_private::lpe_audio" title='drm_i915_private::lpe_audio' data-ref="drm_i915_private::lpe_audio" data-ref-filename="drm_i915_private..lpe_audio">lpe_audio</a>.<a class="ref field" href="i915_drv.h.html#drm_i915_private::(anonymous)::irq" title='drm_i915_private::(anonymous struct)::irq' data-ref="drm_i915_private::(anonymous)::irq" data-ref-filename="drm_i915_private..(anonymous)..irq">irq</a>);</td></tr>
<tr><th id="263">263</th><td>	<b>if</b> (<a class="local col2 ref" href="#22ret" title='ret' data-ref="22ret" data-ref-filename="22ret">ret</a>)</td></tr>
<tr><th id="264">264</th><td>		<a class="macro" href="../../../../include/drm/drmP.h.html#196" title="({ static struct ratelimit_state _rs = { .lock = (raw_spinlock_t) { .raw_lock = { { (0) } }, }, .interval = (5 * 1000), .burst = 10, }; if (___ratelimit(&amp;_rs, __func__)) drm_dev_printk(((void *)0), &quot;\001&quot; &quot;3&quot;, 0x00, __func__, &quot; *ERROR*&quot;, &quot;error handling LPE audio irq: %d\n&quot;, ret); })" data-ref="_M/DRM_ERROR_RATELIMITED">DRM_ERROR_RATELIMITED</a>(<q>"error handling LPE audio irq: %d\n"</q>,</td></tr>
<tr><th id="265">265</th><td>				<a class="local col2 ref" href="#22ret" title='ret' data-ref="22ret" data-ref-filename="22ret">ret</a>);</td></tr>
<tr><th id="266">266</th><td>}</td></tr>
<tr><th id="267">267</th><td></td></tr>
<tr><th id="268">268</th><td><i class="doc">/**</i></td></tr>
<tr><th id="269">269</th><td><i class="doc"> * intel_lpe_audio_init() - detect and setup the bridge between HDMI LPE Audio</i></td></tr>
<tr><th id="270">270</th><td><i class="doc"> * driver and i915</i></td></tr>
<tr><th id="271">271</th><td><i class="doc"> * <span class="command">@dev</span>_<span class="verb">priv: the i915 drm device private data</span></i></td></tr>
<tr><th id="272">272</th><td><i class="doc"> *</i></td></tr>
<tr><th id="273">273</th><td><i class="doc"> * Return: 0 if successful. non-zero if detection or</i></td></tr>
<tr><th id="274">274</th><td><i class="doc"> * llocation/initialization fails</i></td></tr>
<tr><th id="275">275</th><td><i class="doc"> */</i></td></tr>
<tr><th id="276">276</th><td><em>int</em> <dfn class="decl def fn" id="intel_lpe_audio_init" title='intel_lpe_audio_init' data-ref="intel_lpe_audio_init" data-ref-filename="intel_lpe_audio_init">intel_lpe_audio_init</dfn>(<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col3 decl" id="23dev_priv" title='dev_priv' data-type='struct drm_i915_private *' data-ref="23dev_priv" data-ref-filename="23dev_priv">dev_priv</dfn>)</td></tr>
<tr><th id="277">277</th><td>{</td></tr>
<tr><th id="278">278</th><td>	<em>int</em> <dfn class="local col4 decl" id="24ret" title='ret' data-type='int' data-ref="24ret" data-ref-filename="24ret">ret</dfn> = -<a class="macro" href="../../../../include/uapi/asm-generic/errno-base.h.html#23" title="19" data-ref="_M/ENODEV">ENODEV</a>;</td></tr>
<tr><th id="279">279</th><td></td></tr>
<tr><th id="280">280</th><td>	<b>if</b> (<a class="tu ref fn" href="#lpe_audio_detect" title='lpe_audio_detect' data-use='c' data-ref="lpe_audio_detect" data-ref-filename="lpe_audio_detect">lpe_audio_detect</a>(<a class="local col3 ref" href="#23dev_priv" title='dev_priv' data-ref="23dev_priv" data-ref-filename="23dev_priv">dev_priv</a>)) {</td></tr>
<tr><th id="281">281</th><td>		<a class="local col4 ref" href="#24ret" title='ret' data-ref="24ret" data-ref-filename="24ret">ret</a> = <a class="tu ref fn" href="#lpe_audio_setup" title='lpe_audio_setup' data-use='c' data-ref="lpe_audio_setup" data-ref-filename="lpe_audio_setup">lpe_audio_setup</a>(<a class="local col3 ref" href="#23dev_priv" title='dev_priv' data-ref="23dev_priv" data-ref-filename="23dev_priv">dev_priv</a>);</td></tr>
<tr><th id="282">282</th><td>		<b>if</b> (<a class="local col4 ref" href="#24ret" title='ret' data-ref="24ret" data-ref-filename="24ret">ret</a> &lt; <var>0</var>)</td></tr>
<tr><th id="283">283</th><td>			<a class="macro" href="../../../../include/drm/drmP.h.html#178" title="drm_printk(&quot;\001&quot; &quot;3&quot;, 0x00, &quot;failed to setup LPE Audio bridge\n&quot;)" data-ref="_M/DRM_ERROR">DRM_ERROR</a>(<q>"failed to setup LPE Audio bridge\n"</q>);</td></tr>
<tr><th id="284">284</th><td>	}</td></tr>
<tr><th id="285">285</th><td>	<b>return</b> <a class="local col4 ref" href="#24ret" title='ret' data-ref="24ret" data-ref-filename="24ret">ret</a>;</td></tr>
<tr><th id="286">286</th><td>}</td></tr>
<tr><th id="287">287</th><td></td></tr>
<tr><th id="288">288</th><td><i class="doc">/**</i></td></tr>
<tr><th id="289">289</th><td><i class="doc"> * intel_lpe_audio_teardown() - destroy the bridge between HDMI LPE</i></td></tr>
<tr><th id="290">290</th><td><i class="doc"> * audio driver and i915</i></td></tr>
<tr><th id="291">291</th><td><i class="doc"> * <span class="command">@dev</span>_<span class="verb">priv: the i915 drm device private data</span></i></td></tr>
<tr><th id="292">292</th><td><i class="doc"> *</i></td></tr>
<tr><th id="293">293</th><td><i class="doc"> * release all the resources for LPE audio &lt;-&gt; i915 bridge.</i></td></tr>
<tr><th id="294">294</th><td><i class="doc"> */</i></td></tr>
<tr><th id="295">295</th><td><em>void</em> <dfn class="decl def fn" id="intel_lpe_audio_teardown" title='intel_lpe_audio_teardown' data-ref="intel_lpe_audio_teardown" data-ref-filename="intel_lpe_audio_teardown">intel_lpe_audio_teardown</dfn>(<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col5 decl" id="25dev_priv" title='dev_priv' data-type='struct drm_i915_private *' data-ref="25dev_priv" data-ref-filename="25dev_priv">dev_priv</dfn>)</td></tr>
<tr><th id="296">296</th><td>{</td></tr>
<tr><th id="297">297</th><td>	<b>struct</b> <a class="type" href="../../../../include/linux/irqdesc.h.html#irq_desc" title='irq_desc' data-ref="irq_desc" data-ref-filename="irq_desc">irq_desc</a> *<dfn class="local col6 decl" id="26desc" title='desc' data-type='struct irq_desc *' data-ref="26desc" data-ref-filename="26desc">desc</dfn>;</td></tr>
<tr><th id="298">298</th><td></td></tr>
<tr><th id="299">299</th><td>	<b>if</b> (!<a class="macro" href="#72" title="((dev_priv)-&gt;lpe_audio.platdev != ((void *)0))" data-ref="_M/HAS_LPE_AUDIO">HAS_LPE_AUDIO</a>(<a class="local col5 ref" href="#25dev_priv" title='dev_priv' data-ref="25dev_priv" data-ref-filename="25dev_priv">dev_priv</a>))</td></tr>
<tr><th id="300">300</th><td>		<b>return</b>;</td></tr>
<tr><th id="301">301</th><td></td></tr>
<tr><th id="302">302</th><td>	<a class="local col6 ref" href="#26desc" title='desc' data-ref="26desc" data-ref-filename="26desc">desc</a> = <a class="ref fn" href="../../../../include/linux/irqnr.h.html#irq_to_desc" title='irq_to_desc' data-ref="irq_to_desc" data-ref-filename="irq_to_desc">irq_to_desc</a>(<a class="local col5 ref" href="#25dev_priv" title='dev_priv' data-ref="25dev_priv" data-ref-filename="25dev_priv">dev_priv</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_private::lpe_audio" title='drm_i915_private::lpe_audio' data-ref="drm_i915_private::lpe_audio" data-ref-filename="drm_i915_private..lpe_audio">lpe_audio</a>.<a class="ref field" href="i915_drv.h.html#drm_i915_private::(anonymous)::irq" title='drm_i915_private::(anonymous struct)::irq' data-ref="drm_i915_private::(anonymous)::irq" data-ref-filename="drm_i915_private..(anonymous)..irq">irq</a>);</td></tr>
<tr><th id="303">303</th><td></td></tr>
<tr><th id="304">304</th><td>	<a class="tu ref fn" href="#lpe_audio_platdev_destroy" title='lpe_audio_platdev_destroy' data-use='c' data-ref="lpe_audio_platdev_destroy" data-ref-filename="lpe_audio_platdev_destroy">lpe_audio_platdev_destroy</a>(<a class="local col5 ref" href="#25dev_priv" title='dev_priv' data-ref="25dev_priv" data-ref-filename="25dev_priv">dev_priv</a>);</td></tr>
<tr><th id="305">305</th><td></td></tr>
<tr><th id="306">306</th><td>	<a class="ref fn" href="../../../../include/linux/irq.h.html#irq_free_desc" title='irq_free_desc' data-ref="irq_free_desc" data-ref-filename="irq_free_desc">irq_free_desc</a>(<a class="local col5 ref" href="#25dev_priv" title='dev_priv' data-ref="25dev_priv" data-ref-filename="25dev_priv">dev_priv</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_private::lpe_audio" title='drm_i915_private::lpe_audio' data-ref="drm_i915_private::lpe_audio" data-ref-filename="drm_i915_private..lpe_audio">lpe_audio</a>.<a class="ref field" href="i915_drv.h.html#drm_i915_private::(anonymous)::irq" title='drm_i915_private::(anonymous struct)::irq' data-ref="drm_i915_private::(anonymous)::irq" data-ref-filename="drm_i915_private..(anonymous)..irq">irq</a>);</td></tr>
<tr><th id="307">307</th><td>}</td></tr>
<tr><th id="308">308</th><td></td></tr>
<tr><th id="309">309</th><td></td></tr>
<tr><th id="310">310</th><td><i class="doc">/**</i></td></tr>
<tr><th id="311">311</th><td><i class="doc"> * intel_lpe_audio_notify() - notify lpe audio event</i></td></tr>
<tr><th id="312">312</th><td><i class="doc"> * audio driver and i915</i></td></tr>
<tr><th id="313">313</th><td><i class="doc"> * <span class="command">@dev</span>_<span class="verb">priv: the i915 drm device private data</span></i></td></tr>
<tr><th id="314">314</th><td><i class="doc"> *<span class="command"> @pipe</span>: pipe</i></td></tr>
<tr><th id="315">315</th><td><i class="doc"> * <span class="command">@port</span>: port</i></td></tr>
<tr><th id="316">316</th><td><i class="doc"> *<span class="command"> @eld</span> : ELD data</i></td></tr>
<tr><th id="317">317</th><td><i class="doc"> * <span class="command">@ls</span>_clock: Link symbol clock in kHz</i></td></tr>
<tr><th id="318">318</th><td><i class="doc"> *<span class="command"> @dp</span><span class="arg">_output:</span> Driving a DP output?</i></td></tr>
<tr><th id="319">319</th><td><i class="doc"> *</i></td></tr>
<tr><th id="320">320</th><td><i class="doc"> * Notify lpe audio driver of eld change.</i></td></tr>
<tr><th id="321">321</th><td><i class="doc"> */</i></td></tr>
<tr><th id="322">322</th><td><em>void</em> <dfn class="decl def fn" id="intel_lpe_audio_notify" title='intel_lpe_audio_notify' data-ref="intel_lpe_audio_notify" data-ref-filename="intel_lpe_audio_notify">intel_lpe_audio_notify</dfn>(<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col7 decl" id="27dev_priv" title='dev_priv' data-type='struct drm_i915_private *' data-ref="27dev_priv" data-ref-filename="27dev_priv">dev_priv</dfn>,</td></tr>
<tr><th id="323">323</th><td>			    <b>enum</b> <a class="type" href="i915_drv.h.html#pipe" title='pipe' data-ref="pipe" data-ref-filename="pipe">pipe</a> <dfn class="local col8 decl" id="28pipe" title='pipe' data-type='enum pipe' data-ref="28pipe" data-ref-filename="28pipe">pipe</dfn>, <b>enum</b> <a class="type" href="i915_drv.h.html#port" title='port' data-ref="port" data-ref-filename="port">port</a> <dfn class="local col9 decl" id="29port" title='port' data-type='enum port' data-ref="29port" data-ref-filename="29port">port</dfn>,</td></tr>
<tr><th id="324">324</th><td>			    <em>const</em> <em>void</em> *<dfn class="local col0 decl" id="30eld" title='eld' data-type='const void *' data-ref="30eld" data-ref-filename="30eld">eld</dfn>, <em>int</em> <dfn class="local col1 decl" id="31ls_clock" title='ls_clock' data-type='int' data-ref="31ls_clock" data-ref-filename="31ls_clock">ls_clock</dfn>, <a class="typedef" href="../../../../include/linux/types.h.html#bool" title='bool' data-type='_Bool' data-ref="bool" data-ref-filename="bool">bool</a> <dfn class="local col2 decl" id="32dp_output" title='dp_output' data-type='bool' data-ref="32dp_output" data-ref-filename="32dp_output">dp_output</dfn>)</td></tr>
<tr><th id="325">325</th><td>{</td></tr>
<tr><th id="326">326</th><td>	<em>unsigned</em> <em>long</em> <dfn class="local col3 decl" id="33irqflags" title='irqflags' data-type='unsigned long' data-ref="33irqflags" data-ref-filename="33irqflags">irqflags</dfn>;</td></tr>
<tr><th id="327">327</th><td>	<b>struct</b> <a class="type" href="../../../../include/drm/intel_lpe_audio.h.html#intel_hdmi_lpe_audio_pdata" title='intel_hdmi_lpe_audio_pdata' data-ref="intel_hdmi_lpe_audio_pdata" data-ref-filename="intel_hdmi_lpe_audio_pdata">intel_hdmi_lpe_audio_pdata</a> *<dfn class="local col4 decl" id="34pdata" title='pdata' data-type='struct intel_hdmi_lpe_audio_pdata *' data-ref="34pdata" data-ref-filename="34pdata">pdata</dfn>;</td></tr>
<tr><th id="328">328</th><td>	<b>struct</b> <a class="type" href="../../../../include/drm/intel_lpe_audio.h.html#intel_hdmi_lpe_audio_port_pdata" title='intel_hdmi_lpe_audio_port_pdata' data-ref="intel_hdmi_lpe_audio_port_pdata" data-ref-filename="intel_hdmi_lpe_audio_port_pdata">intel_hdmi_lpe_audio_port_pdata</a> *<dfn class="local col5 decl" id="35ppdata" title='ppdata' data-type='struct intel_hdmi_lpe_audio_port_pdata *' data-ref="35ppdata" data-ref-filename="35ppdata">ppdata</dfn>;</td></tr>
<tr><th id="329">329</th><td>	<a class="typedef" href="../../../../include/asm-generic/int-ll64.h.html#u32" title='u32' data-type='unsigned int' data-ref="u32" data-ref-filename="u32">u32</a> <dfn class="local col6 decl" id="36audio_enable" title='audio_enable' data-type='u32' data-ref="36audio_enable" data-ref-filename="36audio_enable">audio_enable</dfn>;</td></tr>
<tr><th id="330">330</th><td></td></tr>
<tr><th id="331">331</th><td>	<b>if</b> (!<a class="macro" href="#72" title="((dev_priv)-&gt;lpe_audio.platdev != ((void *)0))" data-ref="_M/HAS_LPE_AUDIO">HAS_LPE_AUDIO</a>(<a class="local col7 ref" href="#27dev_priv" title='dev_priv' data-ref="27dev_priv" data-ref-filename="27dev_priv">dev_priv</a>))</td></tr>
<tr><th id="332">332</th><td>		<b>return</b>;</td></tr>
<tr><th id="333">333</th><td></td></tr>
<tr><th id="334">334</th><td>	<a class="local col4 ref" href="#34pdata" title='pdata' data-ref="34pdata" data-ref-filename="34pdata">pdata</a> = <a class="ref fn" href="../../../../include/linux/device.h.html#dev_get_platdata" title='dev_get_platdata' data-ref="dev_get_platdata" data-ref-filename="dev_get_platdata">dev_get_platdata</a>(&amp;<a class="local col7 ref" href="#27dev_priv" title='dev_priv' data-ref="27dev_priv" data-ref-filename="27dev_priv">dev_priv</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_private::lpe_audio" title='drm_i915_private::lpe_audio' data-ref="drm_i915_private::lpe_audio" data-ref-filename="drm_i915_private..lpe_audio">lpe_audio</a>.<a class="ref field" href="i915_drv.h.html#drm_i915_private::(anonymous)::platdev" title='drm_i915_private::(anonymous struct)::platdev' data-ref="drm_i915_private::(anonymous)::platdev" data-ref-filename="drm_i915_private..(anonymous)..platdev">platdev</a>-&gt;<a class="ref field" href="../../../../include/linux/platform_device.h.html#platform_device::dev" title='platform_device::dev' data-ref="platform_device::dev" data-ref-filename="platform_device..dev">dev</a>);</td></tr>
<tr><th id="335">335</th><td>	<a class="local col5 ref" href="#35ppdata" title='ppdata' data-ref="35ppdata" data-ref-filename="35ppdata">ppdata</a> = &amp;<a class="local col4 ref" href="#34pdata" title='pdata' data-ref="34pdata" data-ref-filename="34pdata">pdata</a>-&gt;<a class="ref field" href="../../../../include/drm/intel_lpe_audio.h.html#intel_hdmi_lpe_audio_pdata::port" title='intel_hdmi_lpe_audio_pdata::port' data-ref="intel_hdmi_lpe_audio_pdata::port" data-ref-filename="intel_hdmi_lpe_audio_pdata..port">port</a>[<a class="local col9 ref" href="#29port" title='port' data-ref="29port" data-ref-filename="29port">port</a> - <a class="enum" href="i915_drv.h.html#PORT_B" title='PORT_B' data-ref="PORT_B" data-ref-filename="PORT_B">PORT_B</a>];</td></tr>
<tr><th id="336">336</th><td></td></tr>
<tr><th id="337">337</th><td>	<a class="macro" href="../../../../include/linux/spinlock.h.html#338" title="do { do { ({ unsigned long __dummy; typeof(irqflags) __dummy2; (void)(&amp;__dummy == &amp;__dummy2); 1; }); irqflags = _raw_spin_lock_irqsave(spinlock_check(&amp;pdata-&gt;lpe_audio_slock)); } while (0); } while (0)" data-ref="_M/spin_lock_irqsave">spin_lock_irqsave</a>(&amp;<a class="local col4 ref" href="#34pdata" title='pdata' data-ref="34pdata" data-ref-filename="34pdata">pdata</a>-&gt;<a class="ref field" href="../../../../include/drm/intel_lpe_audio.h.html#intel_hdmi_lpe_audio_pdata::lpe_audio_slock" title='intel_hdmi_lpe_audio_pdata::lpe_audio_slock' data-ref="intel_hdmi_lpe_audio_pdata::lpe_audio_slock" data-ref-filename="intel_hdmi_lpe_audio_pdata..lpe_audio_slock">lpe_audio_slock</a>, <a class="local col3 ref" href="#33irqflags" title='irqflags' data-ref="33irqflags" data-ref-filename="33irqflags">irqflags</a>);</td></tr>
<tr><th id="338">338</th><td></td></tr>
<tr><th id="339">339</th><td>	<a class="local col6 ref" href="#36audio_enable" title='audio_enable' data-ref="36audio_enable" data-ref-filename="36audio_enable">audio_enable</a> = <a class="macro" href="i915_drv.h.html#4216" title="dev_priv-&gt;uncore.funcs.mmio_readl(dev_priv, (((const i915_reg_t){ .reg = ((((const u32 []){ (0x180000 + 0x62F20), (0x180000 + 0x62F30), (0x180000 + 0x62F34) })[(port) - PORT_B])) })), true)" data-ref="_M/I915_READ">I915_READ</a>(<a class="macro" href="i915_reg.h.html#2847" title="((const i915_reg_t){ .reg = ((((const u32 []){ (0x180000 + 0x62F20), (0x180000 + 0x62F30), (0x180000 + 0x62F34) })[(port) - PORT_B])) })" data-ref="_M/VLV_AUD_PORT_EN_DBG">VLV_AUD_PORT_EN_DBG</a>(<a class="local col9 ref" href="#29port" title='port' data-ref="29port" data-ref-filename="29port">port</a>));</td></tr>
<tr><th id="340">340</th><td></td></tr>
<tr><th id="341">341</th><td>	<b>if</b> (<a class="local col0 ref" href="#30eld" title='eld' data-ref="30eld" data-ref-filename="30eld">eld</a> != <a class="macro" href="../../../../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>) {</td></tr>
<tr><th id="342">342</th><td>		<a class="macro" href="../../../../arch/x86/include/asm/string_64.h.html#37" title="({ size_t __len = (128); void *__ret; if (__builtin_constant_p(128) &amp;&amp; __len &gt;= 64) __ret = __memcpy((ppdata-&gt;eld), (eld), __len); else __ret = __builtin_memcpy((ppdata-&gt;eld), (eld), __len); __ret; })" data-ref="_M/memcpy">memcpy</a>(<a class="local col5 ref" href="#35ppdata" title='ppdata' data-ref="35ppdata" data-ref-filename="35ppdata">ppdata</a>-&gt;<a class="ref field" href="../../../../include/drm/intel_lpe_audio.h.html#intel_hdmi_lpe_audio_port_pdata::eld" title='intel_hdmi_lpe_audio_port_pdata::eld' data-ref="intel_hdmi_lpe_audio_port_pdata::eld" data-ref-filename="intel_hdmi_lpe_audio_port_pdata..eld">eld</a>, <a class="local col0 ref" href="#30eld" title='eld' data-ref="30eld" data-ref-filename="30eld">eld</a>, <a class="macro" href="../../../../include/drm/intel_lpe_audio.h.html#32" title="128" data-ref="_M/HDMI_MAX_ELD_BYTES">HDMI_MAX_ELD_BYTES</a>);</td></tr>
<tr><th id="343">343</th><td>		<a class="local col5 ref" href="#35ppdata" title='ppdata' data-ref="35ppdata" data-ref-filename="35ppdata">ppdata</a>-&gt;<a class="ref field" href="../../../../include/drm/intel_lpe_audio.h.html#intel_hdmi_lpe_audio_port_pdata::pipe" title='intel_hdmi_lpe_audio_port_pdata::pipe' data-ref="intel_hdmi_lpe_audio_port_pdata::pipe" data-ref-filename="intel_hdmi_lpe_audio_port_pdata..pipe">pipe</a> = <a class="local col8 ref" href="#28pipe" title='pipe' data-ref="28pipe" data-ref-filename="28pipe">pipe</a>;</td></tr>
<tr><th id="344">344</th><td>		<a class="local col5 ref" href="#35ppdata" title='ppdata' data-ref="35ppdata" data-ref-filename="35ppdata">ppdata</a>-&gt;<a class="ref field" href="../../../../include/drm/intel_lpe_audio.h.html#intel_hdmi_lpe_audio_port_pdata::ls_clock" title='intel_hdmi_lpe_audio_port_pdata::ls_clock' data-ref="intel_hdmi_lpe_audio_port_pdata::ls_clock" data-ref-filename="intel_hdmi_lpe_audio_port_pdata..ls_clock">ls_clock</a> = <a class="local col1 ref" href="#31ls_clock" title='ls_clock' data-ref="31ls_clock" data-ref-filename="31ls_clock">ls_clock</a>;</td></tr>
<tr><th id="345">345</th><td>		<a class="local col5 ref" href="#35ppdata" title='ppdata' data-ref="35ppdata" data-ref-filename="35ppdata">ppdata</a>-&gt;<a class="ref field" href="../../../../include/drm/intel_lpe_audio.h.html#intel_hdmi_lpe_audio_port_pdata::dp_output" title='intel_hdmi_lpe_audio_port_pdata::dp_output' data-ref="intel_hdmi_lpe_audio_port_pdata::dp_output" data-ref-filename="intel_hdmi_lpe_audio_port_pdata..dp_output">dp_output</a> = <a class="local col2 ref" href="#32dp_output" title='dp_output' data-ref="32dp_output" data-ref-filename="32dp_output">dp_output</a>;</td></tr>
<tr><th id="346">346</th><td></td></tr>
<tr><th id="347">347</th><td>		<i>/* Unmute the amp for both DP and HDMI */</i></td></tr>
<tr><th id="348">348</th><td>		<a class="macro" href="i915_drv.h.html#4217" title="dev_priv-&gt;uncore.funcs.mmio_writel(dev_priv, (((const i915_reg_t){ .reg = ((((const u32 []){ (0x180000 + 0x62F20), (0x180000 + 0x62F30), (0x180000 + 0x62F34) })[(port) - PORT_B])) })), (audio_enable &amp; ~(1 &lt;&lt; 1)), true)" data-ref="_M/I915_WRITE">I915_WRITE</a>(<a class="macro" href="i915_reg.h.html#2847" title="((const i915_reg_t){ .reg = ((((const u32 []){ (0x180000 + 0x62F20), (0x180000 + 0x62F30), (0x180000 + 0x62F34) })[(port) - PORT_B])) })" data-ref="_M/VLV_AUD_PORT_EN_DBG">VLV_AUD_PORT_EN_DBG</a>(<a class="local col9 ref" href="#29port" title='port' data-ref="29port" data-ref-filename="29port">port</a>),</td></tr>
<tr><th id="349">349</th><td>			   <a class="local col6 ref" href="#36audio_enable" title='audio_enable' data-ref="36audio_enable" data-ref-filename="36audio_enable">audio_enable</a> &amp; ~<a class="macro" href="i915_reg.h.html#2851" title="(1 &lt;&lt; 1)" data-ref="_M/VLV_AMP_MUTE">VLV_AMP_MUTE</a>);</td></tr>
<tr><th id="350">350</th><td>	} <b>else</b> {</td></tr>
<tr><th id="351">351</th><td>		<a class="ref fn" href="../../../../arch/x86/include/asm/string_64.h.html#memset" title='memset' data-ref="memset" data-ref-filename="memset">memset</a>(<a class="local col5 ref" href="#35ppdata" title='ppdata' data-ref="35ppdata" data-ref-filename="35ppdata">ppdata</a>-&gt;<a class="ref field" href="../../../../include/drm/intel_lpe_audio.h.html#intel_hdmi_lpe_audio_port_pdata::eld" title='intel_hdmi_lpe_audio_port_pdata::eld' data-ref="intel_hdmi_lpe_audio_port_pdata::eld" data-ref-filename="intel_hdmi_lpe_audio_port_pdata..eld">eld</a>, <var>0</var>, <a class="macro" href="../../../../include/drm/intel_lpe_audio.h.html#32" title="128" data-ref="_M/HDMI_MAX_ELD_BYTES">HDMI_MAX_ELD_BYTES</a>);</td></tr>
<tr><th id="352">352</th><td>		<a class="local col5 ref" href="#35ppdata" title='ppdata' data-ref="35ppdata" data-ref-filename="35ppdata">ppdata</a>-&gt;<a class="ref field" href="../../../../include/drm/intel_lpe_audio.h.html#intel_hdmi_lpe_audio_port_pdata::pipe" title='intel_hdmi_lpe_audio_port_pdata::pipe' data-ref="intel_hdmi_lpe_audio_port_pdata::pipe" data-ref-filename="intel_hdmi_lpe_audio_port_pdata..pipe">pipe</a> = -<var>1</var>;</td></tr>
<tr><th id="353">353</th><td>		<a class="local col5 ref" href="#35ppdata" title='ppdata' data-ref="35ppdata" data-ref-filename="35ppdata">ppdata</a>-&gt;<a class="ref field" href="../../../../include/drm/intel_lpe_audio.h.html#intel_hdmi_lpe_audio_port_pdata::ls_clock" title='intel_hdmi_lpe_audio_port_pdata::ls_clock' data-ref="intel_hdmi_lpe_audio_port_pdata::ls_clock" data-ref-filename="intel_hdmi_lpe_audio_port_pdata..ls_clock">ls_clock</a> = <var>0</var>;</td></tr>
<tr><th id="354">354</th><td>		<a class="local col5 ref" href="#35ppdata" title='ppdata' data-ref="35ppdata" data-ref-filename="35ppdata">ppdata</a>-&gt;<a class="ref field" href="../../../../include/drm/intel_lpe_audio.h.html#intel_hdmi_lpe_audio_port_pdata::dp_output" title='intel_hdmi_lpe_audio_port_pdata::dp_output' data-ref="intel_hdmi_lpe_audio_port_pdata::dp_output" data-ref-filename="intel_hdmi_lpe_audio_port_pdata..dp_output">dp_output</a> = <a class="enum" href="../../../../include/linux/stddef.h.html#false" title='false' data-ref="false" data-ref-filename="false">false</a>;</td></tr>
<tr><th id="355">355</th><td></td></tr>
<tr><th id="356">356</th><td>		<i>/* Mute the amp for both DP and HDMI */</i></td></tr>
<tr><th id="357">357</th><td>		<a class="macro" href="i915_drv.h.html#4217" title="dev_priv-&gt;uncore.funcs.mmio_writel(dev_priv, (((const i915_reg_t){ .reg = ((((const u32 []){ (0x180000 + 0x62F20), (0x180000 + 0x62F30), (0x180000 + 0x62F34) })[(port) - PORT_B])) })), (audio_enable | (1 &lt;&lt; 1)), true)" data-ref="_M/I915_WRITE">I915_WRITE</a>(<a class="macro" href="i915_reg.h.html#2847" title="((const i915_reg_t){ .reg = ((((const u32 []){ (0x180000 + 0x62F20), (0x180000 + 0x62F30), (0x180000 + 0x62F34) })[(port) - PORT_B])) })" data-ref="_M/VLV_AUD_PORT_EN_DBG">VLV_AUD_PORT_EN_DBG</a>(<a class="local col9 ref" href="#29port" title='port' data-ref="29port" data-ref-filename="29port">port</a>),</td></tr>
<tr><th id="358">358</th><td>			   <a class="local col6 ref" href="#36audio_enable" title='audio_enable' data-ref="36audio_enable" data-ref-filename="36audio_enable">audio_enable</a> | <a class="macro" href="i915_reg.h.html#2851" title="(1 &lt;&lt; 1)" data-ref="_M/VLV_AMP_MUTE">VLV_AMP_MUTE</a>);</td></tr>
<tr><th id="359">359</th><td>	}</td></tr>
<tr><th id="360">360</th><td></td></tr>
<tr><th id="361">361</th><td>	<b>if</b> (<a class="local col4 ref" href="#34pdata" title='pdata' data-ref="34pdata" data-ref-filename="34pdata">pdata</a>-&gt;<a class="ref field" href="../../../../include/drm/intel_lpe_audio.h.html#intel_hdmi_lpe_audio_pdata::notify_audio_lpe" title='intel_hdmi_lpe_audio_pdata::notify_audio_lpe' data-ref="intel_hdmi_lpe_audio_pdata::notify_audio_lpe" data-ref-filename="intel_hdmi_lpe_audio_pdata..notify_audio_lpe">notify_audio_lpe</a>)</td></tr>
<tr><th id="362">362</th><td>		<a class="local col4 ref" href="#34pdata" title='pdata' data-ref="34pdata" data-ref-filename="34pdata">pdata</a>-&gt;<a class="ref field" href="../../../../include/drm/intel_lpe_audio.h.html#intel_hdmi_lpe_audio_pdata::notify_audio_lpe" title='intel_hdmi_lpe_audio_pdata::notify_audio_lpe' data-ref="intel_hdmi_lpe_audio_pdata::notify_audio_lpe" data-ref-filename="intel_hdmi_lpe_audio_pdata..notify_audio_lpe">notify_audio_lpe</a>(<a class="local col7 ref" href="#27dev_priv" title='dev_priv' data-ref="27dev_priv" data-ref-filename="27dev_priv">dev_priv</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_private::lpe_audio" title='drm_i915_private::lpe_audio' data-ref="drm_i915_private::lpe_audio" data-ref-filename="drm_i915_private..lpe_audio">lpe_audio</a>.<a class="ref field" href="i915_drv.h.html#drm_i915_private::(anonymous)::platdev" title='drm_i915_private::(anonymous struct)::platdev' data-ref="drm_i915_private::(anonymous)::platdev" data-ref-filename="drm_i915_private..(anonymous)..platdev">platdev</a>, <a class="local col9 ref" href="#29port" title='port' data-ref="29port" data-ref-filename="29port">port</a> - <a class="enum" href="i915_drv.h.html#PORT_B" title='PORT_B' data-ref="PORT_B" data-ref-filename="PORT_B">PORT_B</a>);</td></tr>
<tr><th id="363">363</th><td></td></tr>
<tr><th id="364">364</th><td>	<a class="ref fn" href="../../../../include/linux/spinlock.h.html#spin_unlock_irqrestore" title='spin_unlock_irqrestore' data-ref="spin_unlock_irqrestore" data-ref-filename="spin_unlock_irqrestore">spin_unlock_irqrestore</a>(&amp;<a class="local col4 ref" href="#34pdata" title='pdata' data-ref="34pdata" data-ref-filename="34pdata">pdata</a>-&gt;<a class="ref field" href="../../../../include/drm/intel_lpe_audio.h.html#intel_hdmi_lpe_audio_pdata::lpe_audio_slock" title='intel_hdmi_lpe_audio_pdata::lpe_audio_slock' data-ref="intel_hdmi_lpe_audio_pdata::lpe_audio_slock" data-ref-filename="intel_hdmi_lpe_audio_pdata..lpe_audio_slock">lpe_audio_slock</a>, <a class="local col3 ref" href="#33irqflags" title='irqflags' data-ref="33irqflags" data-ref-filename="33irqflags">irqflags</a>);</td></tr>
<tr><th id="365">365</th><td>}</td></tr>
<tr><th id="366">366</th><td></td></tr>
</table><hr/><p id='footer'>
Generated on <em>2019-Oct-10</em> from project linux revision <em>4.15.10</em><br />Powered by <a href='https://woboq.com'><img alt='Woboq' src='https://code.woboq.org/woboq-16.png' width='41' height='16' /></a> <a href='https://code.woboq.org'>Code Browser</a> 2.1
<br/>Generator usage only permitted with license.</p>
</div></body></html>
