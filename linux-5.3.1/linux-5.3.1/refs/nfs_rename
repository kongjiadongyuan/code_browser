<dec f='linux-5.3.1/fs/nfs/internal.h' l='369' type='int nfs_rename(struct inode * , struct dentry * , struct inode * , struct dentry * , unsigned int )'/>
<def f='linux-5.3.1/fs/nfs/dir.c' l='2029' ll='2130' type='int nfs_rename(struct inode * old_dir, struct dentry * old_dentry, struct inode * new_dir, struct dentry * new_dentry, unsigned int flags)'/>
<dec f='linux-5.3.1/fs/nfs/dir.c' l='2131' type='int nfs_rename(struct inode * , struct dentry * , struct inode * , struct dentry * , unsigned int )'/>
<use f='linux-5.3.1/fs/nfs/dir.c' l='2131' c='nfs_rename'/>
<use f='linux-5.3.1/fs/nfs/dir.c' l='2131' u='a'/>
<doc f='linux-5.3.1/fs/nfs/dir.c' l='2005'>/*
 * RENAME
 * FIXME: Some nfsds, like the Linux user space nfsd, may generate a
 * different file handle for the same inode after a rename (e.g. when
 * moving to a different directory). A fail-safe method to do so would
 * be to look up old_dir/old_name, create a link to new_dir/new_name and
 * rename the old file using the sillyrename stuff. This way, the original
 * file in old_dir will go away when the last process iput()s the inode.
 *
 * FIXED.
 * 
 * It actually works quite well. One needs to have the possibility for
 * at least one &quot;.nfs...&quot; file in each directory the file ever gets
 * moved or linked to which happens automagically with the new
 * implementation that only depends on the dcache stuff instead of
 * using the inode layer
 *
 * Unfortunately, things are a little more complicated than indicated
 * above. For a cross-directory move, we want to make sure we can get
 * rid of the old inode after the operation.  This means there must be
 * no pending writes (if it&apos;s a file), and the use count must be 1.
 * If these conditions are met, we can drop the dentries before doing
 * the rename.
 */</doc>
<use f='linux-5.3.1/fs/nfs/nfs3proc.c' l='935'/>
<use f='linux-5.3.1/fs/nfs/nfs3proc.c' l='935'/>
<use f='linux-5.3.1/fs/nfs/nfs4proc.c' l='9876'/>
<use f='linux-5.3.1/fs/nfs/nfs4proc.c' l='9876'/>
<use f='linux-5.3.1/fs/nfs/proc.c' l='693'/>
<use f='linux-5.3.1/fs/nfs/proc.c' l='693'/>
