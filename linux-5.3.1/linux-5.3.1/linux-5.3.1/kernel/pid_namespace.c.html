<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"><title>pid_namespace.c source code [linux-5.3.1/kernel/pid_namespace.c] - Woboq Code Browser</title>
<link rel="stylesheet" href="../../../data/qtcreator.css" title="QtCreator"/>
<link rel="alternate stylesheet" href="../../../data/kdevelop.css" title="KDevelop"/>
<script type="text/javascript" src="../../../data/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../../../data/jquery/jquery-ui.min.js"></script>
<script>var file = 'linux-5.3.1/kernel/pid_namespace.c'; var root_path = '../..'; var data_path = '../../../data'; var ecma_script_api_version = 2;</script>
<script src='../../../data/codebrowser.js'></script>
</head>
<body><div id='header'><h1 id='breadcrumb'><span>Browse the source code of </span><a href='..'>linux-5.3.1</a>/<a href='./'>kernel</a>/<a href='pid_namespace.c.html'>pid_namespace.c</a></h1></div>
<hr/><div id='content'><table class="code">
<tr><th id="1">1</th><td><i>// SPDX-License-Identifier: GPL-2.0-only</i></td></tr>
<tr><th id="2">2</th><td><i>/*</i></td></tr>
<tr><th id="3">3</th><td><i> * Pid namespaces</i></td></tr>
<tr><th id="4">4</th><td><i> *</i></td></tr>
<tr><th id="5">5</th><td><i> * Authors:</i></td></tr>
<tr><th id="6">6</th><td><i> *    (C) 2007 Pavel Emelyanov &lt;xemul@openvz.org&gt;, OpenVZ, SWsoft Inc.</i></td></tr>
<tr><th id="7">7</th><td><i> *    (C) 2007 Sukadev Bhattiprolu &lt;sukadev@us.ibm.com&gt;, IBM</i></td></tr>
<tr><th id="8">8</th><td><i> *     Many thanks to Oleg Nesterov for comments and help</i></td></tr>
<tr><th id="9">9</th><td><i> *</i></td></tr>
<tr><th id="10">10</th><td><i> */</i></td></tr>
<tr><th id="11">11</th><td></td></tr>
<tr><th id="12">12</th><td><u>#include <a href="../include/linux/pid.h.html">&lt;linux/pid.h&gt;</a></u></td></tr>
<tr><th id="13">13</th><td><u>#include <a href="../include/linux/pid_namespace.h.html">&lt;linux/pid_namespace.h&gt;</a></u></td></tr>
<tr><th id="14">14</th><td><u>#include <a href="../include/linux/user_namespace.h.html">&lt;linux/user_namespace.h&gt;</a></u></td></tr>
<tr><th id="15">15</th><td><u>#include <a href="../include/linux/syscalls.h.html">&lt;linux/syscalls.h&gt;</a></u></td></tr>
<tr><th id="16">16</th><td><u>#include <a href="../include/linux/cred.h.html">&lt;linux/cred.h&gt;</a></u></td></tr>
<tr><th id="17">17</th><td><u>#include <a href="../include/linux/err.h.html">&lt;linux/err.h&gt;</a></u></td></tr>
<tr><th id="18">18</th><td><u>#include <a href="../include/linux/acct.h.html">&lt;linux/acct.h&gt;</a></u></td></tr>
<tr><th id="19">19</th><td><u>#include <a href="../include/linux/slab.h.html">&lt;linux/slab.h&gt;</a></u></td></tr>
<tr><th id="20">20</th><td><u>#include <a href="../include/linux/proc_ns.h.html">&lt;linux/proc_ns.h&gt;</a></u></td></tr>
<tr><th id="21">21</th><td><u>#include <a href="../include/linux/reboot.h.html">&lt;linux/reboot.h&gt;</a></u></td></tr>
<tr><th id="22">22</th><td><u>#include <a href="../include/linux/export.h.html">&lt;linux/export.h&gt;</a></u></td></tr>
<tr><th id="23">23</th><td><u>#include <a href="../include/linux/sched/task.h.html">&lt;linux/sched/task.h&gt;</a></u></td></tr>
<tr><th id="24">24</th><td><u>#include <a href="../include/linux/sched/signal.h.html">&lt;linux/sched/signal.h&gt;</a></u></td></tr>
<tr><th id="25">25</th><td><u>#include <a href="../include/linux/idr.h.html">&lt;linux/idr.h&gt;</a></u></td></tr>
<tr><th id="26">26</th><td></td></tr>
<tr><th id="27">27</th><td><em>static</em> <a class="macro" href="../include/linux/mutex.h.html#135" title="struct mutex pid_caches_mutex = { .owner = { (0) } , .wait_lock = (spinlock_t ) { { .rlock = { .raw_lock = { { .val = { (0) } } }, } } } , .wait_list = { &amp;(pid_caches_mutex.wait_list), &amp;(pid_caches_mutex.wait_list) } }" data-ref="_M/DEFINE_MUTEX">DEFINE_MUTEX</a>(<dfn class="tu decl def" id="pid_caches_mutex" title='pid_caches_mutex' data-type='struct mutex' data-ref="pid_caches_mutex" data-ref-filename="pid_caches_mutex"><a class="tu ref" href="#27" title='pid_caches_mutex' data-use='m' data-ref="pid_caches_mutex" data-ref-filename="pid_caches_mutex"><a class="tu ref" href="#27" title='pid_caches_mutex' data-use='m' data-ref="pid_caches_mutex" data-ref-filename="pid_caches_mutex"><a class="tu ref" href="#27" title='pid_caches_mutex' data-use='m' data-ref="pid_caches_mutex" data-ref-filename="pid_caches_mutex"><a class="tu ref" href="#27" title='pid_caches_mutex' data-use='m' data-ref="pid_caches_mutex" data-ref-filename="pid_caches_mutex"><a class="tu ref" href="#27" title='pid_caches_mutex' data-use='m' data-ref="pid_caches_mutex" data-ref-filename="pid_caches_mutex"><a class="tu ref" href="#27" title='pid_caches_mutex' data-use='m' data-ref="pid_caches_mutex" data-ref-filename="pid_caches_mutex"><a class="tu ref" href="#27" title='pid_caches_mutex' data-use='m' data-ref="pid_caches_mutex" data-ref-filename="pid_caches_mutex"><a class="tu ref" href="#27" title='pid_caches_mutex' data-use='m' data-ref="pid_caches_mutex" data-ref-filename="pid_caches_mutex">pid_caches_mutex</a></a></a></a></a></a></a></a></dfn>);</td></tr>
<tr><th id="28">28</th><td><em>static</em> <b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#kmem_cache" title='kmem_cache' data-ref="kmem_cache" data-ref-filename="kmem_cache">kmem_cache</a> *<dfn class="tu decl def" id="pid_ns_cachep" title='pid_ns_cachep' data-type='struct kmem_cache *' data-ref="pid_ns_cachep" data-ref-filename="pid_ns_cachep">pid_ns_cachep</dfn>;</td></tr>
<tr><th id="29">29</th><td><i>/* MAX_PID_NS_LEVEL is needed for limiting size of 'struct pid' */</i></td></tr>
<tr><th id="30">30</th><td><u>#define <dfn class="macro" id="_M/MAX_PID_NS_LEVEL" data-ref="_M/MAX_PID_NS_LEVEL">MAX_PID_NS_LEVEL</dfn> 32</u></td></tr>
<tr><th id="31">31</th><td><i  data-doc="pid_cache">/* Write once array, filled from the beginning. */</i></td></tr>
<tr><th id="32">32</th><td><em>static</em> <b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#kmem_cache" title='kmem_cache' data-ref="kmem_cache" data-ref-filename="kmem_cache">kmem_cache</a> *<dfn class="tu decl def" id="pid_cache" title='pid_cache' data-type='struct kmem_cache *[32]' data-ref="pid_cache" data-ref-filename="pid_cache">pid_cache</dfn>[<a class="macro" href="#30" title="32" data-ref="_M/MAX_PID_NS_LEVEL">MAX_PID_NS_LEVEL</a>];</td></tr>
<tr><th id="33">33</th><td></td></tr>
<tr><th id="34">34</th><td><i  data-doc="create_pid_cachep">/*</i></td></tr>
<tr><th id="35">35</th><td><i  data-doc="create_pid_cachep"> * creates the kmem cache to allocate pids from.</i></td></tr>
<tr><th id="36">36</th><td><i  data-doc="create_pid_cachep"> * @level: pid namespace level</i></td></tr>
<tr><th id="37">37</th><td><i  data-doc="create_pid_cachep"> */</i></td></tr>
<tr><th id="38">38</th><td></td></tr>
<tr><th id="39">39</th><td><em>static</em> <b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#kmem_cache" title='kmem_cache' data-ref="kmem_cache" data-ref-filename="kmem_cache">kmem_cache</a> *<dfn class="tu decl def fn" id="create_pid_cachep" title='create_pid_cachep' data-type='struct kmem_cache * create_pid_cachep(unsigned int level)' data-ref="create_pid_cachep" data-ref-filename="create_pid_cachep">create_pid_cachep</dfn>(<em>unsigned</em> <em>int</em> <dfn class="local col1 decl" id="1level" title='level' data-type='unsigned int' data-ref="1level" data-ref-filename="1level">level</dfn>)</td></tr>
<tr><th id="40">40</th><td>{</td></tr>
<tr><th id="41">41</th><td>	<i>/* Level 0 is init_pid_ns.pid_cachep */</i></td></tr>
<tr><th id="42">42</th><td>	<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#kmem_cache" title='kmem_cache' data-ref="kmem_cache" data-ref-filename="kmem_cache">kmem_cache</a> **<dfn class="local col2 decl" id="2pkc" title='pkc' data-type='struct kmem_cache **' data-ref="2pkc" data-ref-filename="2pkc">pkc</dfn> = &amp;<a class="tu ref" href="#pid_cache" title='pid_cache' data-use='a' data-ref="pid_cache" data-ref-filename="pid_cache">pid_cache</a>[<a class="local col1 ref" href="#1level" title='level' data-ref="1level" data-ref-filename="1level">level</a> - <var>1</var>];</td></tr>
<tr><th id="43">43</th><td>	<b>struct</b> <a class="type" href="../include/linux/mm_types.h.html#kmem_cache" title='kmem_cache' data-ref="kmem_cache" data-ref-filename="kmem_cache">kmem_cache</a> *<dfn class="local col3 decl" id="3kc" title='kc' data-type='struct kmem_cache *' data-ref="3kc" data-ref-filename="3kc">kc</dfn>;</td></tr>
<tr><th id="44">44</th><td>	<em>char</em> <dfn class="local col4 decl" id="4name" title='name' data-type='char [15]' data-ref="4name" data-ref-filename="4name">name</dfn>[<var>4</var> + <var>10</var> + <var>1</var>];</td></tr>
<tr><th id="45">45</th><td>	<em>unsigned</em> <em>int</em> <dfn class="local col5 decl" id="5len" title='len' data-type='unsigned int' data-ref="5len" data-ref-filename="5len">len</dfn>;</td></tr>
<tr><th id="46">46</th><td></td></tr>
<tr><th id="47">47</th><td>	<a class="local col3 ref" href="#3kc" title='kc' data-ref="3kc" data-ref-filename="3kc">kc</a> = <a class="macro" href="../include/linux/compiler.h.html#269" title="({ union { typeof(*pkc) __val; char __c[1]; } __u; if (1) __read_once_size(&amp;(*pkc), __u.__c, sizeof(*pkc)); else __read_once_size_nocheck(&amp;(*pkc), __u.__c, sizeof(*pkc)); do { } while (0); __u.__val; })" data-ref="_M/READ_ONCE">READ_ONCE</a>(*<a class="local col2 ref" href="#2pkc" title='pkc' data-ref="2pkc" data-ref-filename="2pkc">pkc</a>);</td></tr>
<tr><th id="48">48</th><td>	<b>if</b> (<a class="local col3 ref" href="#3kc" title='kc' data-ref="3kc" data-ref-filename="3kc">kc</a>)</td></tr>
<tr><th id="49">49</th><td>		<b>return</b> <a class="local col3 ref" href="#3kc" title='kc' data-ref="3kc" data-ref-filename="3kc">kc</a>;</td></tr>
<tr><th id="50">50</th><td></td></tr>
<tr><th id="51">51</th><td>	<a class="ref fn" href="../include/linux/kernel.h.html#snprintf" title='snprintf' data-ref="snprintf" data-ref-filename="snprintf">snprintf</a>(<a class="local col4 ref" href="#4name" title='name' data-ref="4name" data-ref-filename="4name">name</a>, <b>sizeof</b>(<a class="local col4 ref" href="#4name" title='name' data-ref="4name" data-ref-filename="4name">name</a>), <q>"pid_%u"</q>, <a class="local col1 ref" href="#1level" title='level' data-ref="1level" data-ref-filename="1level">level</a> + <var>1</var>);</td></tr>
<tr><th id="52">52</th><td>	<a class="local col5 ref" href="#5len" title='len' data-ref="5len" data-ref-filename="5len">len</a> = <b>sizeof</b>(<b>struct</b> <a class="type" href="../include/linux/pid.h.html#pid" title='pid' data-ref="pid" data-ref-filename="pid">pid</a>) + <a class="local col1 ref" href="#1level" title='level' data-ref="1level" data-ref-filename="1level">level</a> * <b>sizeof</b>(<b>struct</b> <a class="type" href="../include/linux/pid.h.html#upid" title='upid' data-ref="upid" data-ref-filename="upid">upid</a>);</td></tr>
<tr><th id="53">53</th><td>	<a class="ref fn" href="../include/linux/mutex.h.html#mutex_lock" title='mutex_lock' data-ref="mutex_lock" data-ref-filename="mutex_lock">mutex_lock</a>(&amp;<a class="tu ref" href="#27" title='pid_caches_mutex' data-use='a' data-ref="pid_caches_mutex" data-ref-filename="pid_caches_mutex">pid_caches_mutex</a>);</td></tr>
<tr><th id="54">54</th><td>	<i>/* Name collision forces to do allocation under mutex. */</i></td></tr>
<tr><th id="55">55</th><td>	<b>if</b> (!*<a class="local col2 ref" href="#2pkc" title='pkc' data-ref="2pkc" data-ref-filename="2pkc">pkc</a>)</td></tr>
<tr><th id="56">56</th><td>		*<a class="local col2 ref" href="#2pkc" title='pkc' data-ref="2pkc" data-ref-filename="2pkc">pkc</a> = <a class="ref fn" href="../include/linux/slab.h.html#kmem_cache_create" title='kmem_cache_create' data-ref="kmem_cache_create" data-ref-filename="kmem_cache_create">kmem_cache_create</a>(<a class="local col4 ref" href="#4name" title='name' data-ref="4name" data-ref-filename="4name">name</a>, <a class="local col5 ref" href="#5len" title='len' data-ref="5len" data-ref-filename="5len">len</a>, <var>0</var>, <a class="macro" href="../include/linux/slab.h.html#33" title="((slab_flags_t )0x00002000U)" data-ref="_M/SLAB_HWCACHE_ALIGN">SLAB_HWCACHE_ALIGN</a>, <var>0</var>);</td></tr>
<tr><th id="57">57</th><td>	<a class="ref fn" href="../include/linux/mutex.h.html#mutex_unlock" title='mutex_unlock' data-ref="mutex_unlock" data-ref-filename="mutex_unlock">mutex_unlock</a>(&amp;<a class="tu ref" href="#27" title='pid_caches_mutex' data-use='a' data-ref="pid_caches_mutex" data-ref-filename="pid_caches_mutex">pid_caches_mutex</a>);</td></tr>
<tr><th id="58">58</th><td>	<i>/* current can fail, but someone else can succeed. */</i></td></tr>
<tr><th id="59">59</th><td>	<b>return</b> <a class="macro" href="../include/linux/compiler.h.html#269" title="({ union { typeof(*pkc) __val; char __c[1]; } __u; if (1) __read_once_size(&amp;(*pkc), __u.__c, sizeof(*pkc)); else __read_once_size_nocheck(&amp;(*pkc), __u.__c, sizeof(*pkc)); do { } while (0); __u.__val; })" data-ref="_M/READ_ONCE">READ_ONCE</a>(*<a class="local col2 ref" href="#2pkc" title='pkc' data-ref="2pkc" data-ref-filename="2pkc">pkc</a>);</td></tr>
<tr><th id="60">60</th><td>}</td></tr>
<tr><th id="61">61</th><td></td></tr>
<tr><th id="62">62</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="proc_cleanup_work" title='proc_cleanup_work' data-type='void proc_cleanup_work(struct work_struct * work)' data-ref="proc_cleanup_work" data-ref-filename="proc_cleanup_work">proc_cleanup_work</dfn>(<b>struct</b> <a class="type" href="../include/linux/workqueue.h.html#work_struct" title='work_struct' data-ref="work_struct" data-ref-filename="work_struct">work_struct</a> *<dfn class="local col6 decl" id="6work" title='work' data-type='struct work_struct *' data-ref="6work" data-ref-filename="6work">work</dfn>)</td></tr>
<tr><th id="63">63</th><td>{</td></tr>
<tr><th id="64">64</th><td>	<b>struct</b> <a class="type" href="../include/linux/pid_namespace.h.html#pid_namespace" title='pid_namespace' data-ref="pid_namespace" data-ref-filename="pid_namespace">pid_namespace</a> *<dfn class="local col7 decl" id="7ns" title='ns' data-type='struct pid_namespace *' data-ref="7ns" data-ref-filename="7ns">ns</dfn> = <a class="macro" href="../include/linux/kernel.h.html#971" title="({ void *__mptr = (void *)(work); do { extern void __compiletime_assert_64(void) ; if (!(!(!__builtin_types_compatible_p(typeof(*(work)), typeof(((struct pid_namespace *)0)-&gt;proc_work)) &amp;&amp; !__builtin_types_compatible_p(typeof(*(work)), typeof(void))))) __compiletime_assert_64(); } while (0); ((struct pid_namespace *)(__mptr - __builtin_offsetof(struct pid_namespace, proc_work))); })" data-ref="_M/container_of">container_of</a>(<a class="local col6 ref" href="#6work" title='work' data-ref="6work" data-ref-filename="6work">work</a>, <b>struct</b> <a class="type" href="../include/linux/pid_namespace.h.html#pid_namespace" title='pid_namespace' data-ref="pid_namespace" data-ref-filename="pid_namespace">pid_namespace</a>, <a class="ref field" href="../include/linux/pid_namespace.h.html#pid_namespace::proc_work" title='pid_namespace::proc_work' data-ref="pid_namespace::proc_work" data-ref-filename="pid_namespace..proc_work">proc_work</a>);</td></tr>
<tr><th id="65">65</th><td>	<a class="ref fn" href="../include/linux/proc_ns.h.html#pid_ns_release_proc" title='pid_ns_release_proc' data-ref="pid_ns_release_proc" data-ref-filename="pid_ns_release_proc">pid_ns_release_proc</a>(<a class="local col7 ref" href="#7ns" title='ns' data-ref="7ns" data-ref-filename="7ns">ns</a>);</td></tr>
<tr><th id="66">66</th><td>}</td></tr>
<tr><th id="67">67</th><td></td></tr>
<tr><th id="68">68</th><td><em>static</em> <b>struct</b> <a class="type" href="../include/linux/user_namespace.h.html#ucounts" title='ucounts' data-ref="ucounts" data-ref-filename="ucounts">ucounts</a> *<dfn class="tu decl def fn" id="inc_pid_namespaces" title='inc_pid_namespaces' data-type='struct ucounts * inc_pid_namespaces(struct user_namespace * ns)' data-ref="inc_pid_namespaces" data-ref-filename="inc_pid_namespaces">inc_pid_namespaces</dfn>(<b>struct</b> <a class="type" href="../include/linux/user_namespace.h.html#user_namespace" title='user_namespace' data-ref="user_namespace" data-ref-filename="user_namespace">user_namespace</a> *<dfn class="local col8 decl" id="8ns" title='ns' data-type='struct user_namespace *' data-ref="8ns" data-ref-filename="8ns">ns</dfn>)</td></tr>
<tr><th id="69">69</th><td>{</td></tr>
<tr><th id="70">70</th><td>	<b>return</b> <a class="ref fn" href="../include/linux/user_namespace.h.html#inc_ucount" title='inc_ucount' data-ref="inc_ucount" data-ref-filename="inc_ucount">inc_ucount</a>(<a class="local col8 ref" href="#8ns" title='ns' data-ref="8ns" data-ref-filename="8ns">ns</a>, <a class="macro" href="../include/linux/cred.h.html#381" title="(({ ({ do { } while (0); ; ((typeof(*(get_current()-&gt;cred)) *)((get_current()-&gt;cred))); })-&gt;euid; }))" data-ref="_M/current_euid">current_euid</a>(), <a class="enum" href="../include/linux/user_namespace.h.html#UCOUNT_PID_NAMESPACES" title='UCOUNT_PID_NAMESPACES' data-ref="UCOUNT_PID_NAMESPACES" data-ref-filename="UCOUNT_PID_NAMESPACES">UCOUNT_PID_NAMESPACES</a>);</td></tr>
<tr><th id="71">71</th><td>}</td></tr>
<tr><th id="72">72</th><td></td></tr>
<tr><th id="73">73</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="dec_pid_namespaces" title='dec_pid_namespaces' data-type='void dec_pid_namespaces(struct ucounts * ucounts)' data-ref="dec_pid_namespaces" data-ref-filename="dec_pid_namespaces">dec_pid_namespaces</dfn>(<b>struct</b> <a class="type" href="../include/linux/user_namespace.h.html#ucounts" title='ucounts' data-ref="ucounts" data-ref-filename="ucounts">ucounts</a> *<dfn class="local col9 decl" id="9ucounts" title='ucounts' data-type='struct ucounts *' data-ref="9ucounts" data-ref-filename="9ucounts">ucounts</dfn>)</td></tr>
<tr><th id="74">74</th><td>{</td></tr>
<tr><th id="75">75</th><td>	<a class="ref fn" href="../include/linux/user_namespace.h.html#dec_ucount" title='dec_ucount' data-ref="dec_ucount" data-ref-filename="dec_ucount">dec_ucount</a>(<a class="local col9 ref" href="#9ucounts" title='ucounts' data-ref="9ucounts" data-ref-filename="9ucounts">ucounts</a>, <a class="enum" href="../include/linux/user_namespace.h.html#UCOUNT_PID_NAMESPACES" title='UCOUNT_PID_NAMESPACES' data-ref="UCOUNT_PID_NAMESPACES" data-ref-filename="UCOUNT_PID_NAMESPACES">UCOUNT_PID_NAMESPACES</a>);</td></tr>
<tr><th id="76">76</th><td>}</td></tr>
<tr><th id="77">77</th><td></td></tr>
<tr><th id="78">78</th><td><em>static</em> <b>struct</b> <a class="type" href="../include/linux/pid_namespace.h.html#pid_namespace" title='pid_namespace' data-ref="pid_namespace" data-ref-filename="pid_namespace">pid_namespace</a> *<dfn class="tu decl def fn" id="create_pid_namespace" title='create_pid_namespace' data-type='struct pid_namespace * create_pid_namespace(struct user_namespace * user_ns, struct pid_namespace * parent_pid_ns)' data-ref="create_pid_namespace" data-ref-filename="create_pid_namespace">create_pid_namespace</dfn>(<b>struct</b> <a class="type" href="../include/linux/user_namespace.h.html#user_namespace" title='user_namespace' data-ref="user_namespace" data-ref-filename="user_namespace">user_namespace</a> *<dfn class="local col0 decl" id="10user_ns" title='user_ns' data-type='struct user_namespace *' data-ref="10user_ns" data-ref-filename="10user_ns">user_ns</dfn>,</td></tr>
<tr><th id="79">79</th><td>	<b>struct</b> <a class="type" href="../include/linux/pid_namespace.h.html#pid_namespace" title='pid_namespace' data-ref="pid_namespace" data-ref-filename="pid_namespace">pid_namespace</a> *<dfn class="local col1 decl" id="11parent_pid_ns" title='parent_pid_ns' data-type='struct pid_namespace *' data-ref="11parent_pid_ns" data-ref-filename="11parent_pid_ns">parent_pid_ns</dfn>)</td></tr>
<tr><th id="80">80</th><td>{</td></tr>
<tr><th id="81">81</th><td>	<b>struct</b> <a class="type" href="../include/linux/pid_namespace.h.html#pid_namespace" title='pid_namespace' data-ref="pid_namespace" data-ref-filename="pid_namespace">pid_namespace</a> *<dfn class="local col2 decl" id="12ns" title='ns' data-type='struct pid_namespace *' data-ref="12ns" data-ref-filename="12ns">ns</dfn>;</td></tr>
<tr><th id="82">82</th><td>	<em>unsigned</em> <em>int</em> <dfn class="local col3 decl" id="13level" title='level' data-type='unsigned int' data-ref="13level" data-ref-filename="13level">level</dfn> = <a class="local col1 ref" href="#11parent_pid_ns" title='parent_pid_ns' data-ref="11parent_pid_ns" data-ref-filename="11parent_pid_ns">parent_pid_ns</a>-&gt;<a class="ref field" href="../include/linux/pid_namespace.h.html#pid_namespace::level" title='pid_namespace::level' data-ref="pid_namespace::level" data-ref-filename="pid_namespace..level">level</a> + <var>1</var>;</td></tr>
<tr><th id="83">83</th><td>	<b>struct</b> <a class="type" href="../include/linux/user_namespace.h.html#ucounts" title='ucounts' data-ref="ucounts" data-ref-filename="ucounts">ucounts</a> *<dfn class="local col4 decl" id="14ucounts" title='ucounts' data-type='struct ucounts *' data-ref="14ucounts" data-ref-filename="14ucounts">ucounts</dfn>;</td></tr>
<tr><th id="84">84</th><td>	<em>int</em> <dfn class="local col5 decl" id="15err" title='err' data-type='int' data-ref="15err" data-ref-filename="15err">err</dfn>;</td></tr>
<tr><th id="85">85</th><td></td></tr>
<tr><th id="86">86</th><td>	<a class="local col5 ref" href="#15err" title='err' data-ref="15err" data-ref-filename="15err">err</a> = -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="87">87</th><td>	<b>if</b> (!<a class="ref fn" href="../include/linux/user_namespace.h.html#in_userns" title='in_userns' data-ref="in_userns" data-ref-filename="in_userns">in_userns</a>(<a class="local col1 ref" href="#11parent_pid_ns" title='parent_pid_ns' data-ref="11parent_pid_ns" data-ref-filename="11parent_pid_ns">parent_pid_ns</a>-&gt;<a class="ref field" href="../include/linux/pid_namespace.h.html#pid_namespace::user_ns" title='pid_namespace::user_ns' data-ref="pid_namespace::user_ns" data-ref-filename="pid_namespace..user_ns">user_ns</a>, <a class="local col0 ref" href="#10user_ns" title='user_ns' data-ref="10user_ns" data-ref-filename="10user_ns">user_ns</a>))</td></tr>
<tr><th id="88">88</th><td>		<b>goto</b> <a class="lbl" href="#16out" data-ref="16out" data-ref-filename="16out">out</a>;</td></tr>
<tr><th id="89">89</th><td></td></tr>
<tr><th id="90">90</th><td>	<a class="local col5 ref" href="#15err" title='err' data-ref="15err" data-ref-filename="15err">err</a> = -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#32" title="28" data-ref="_M/ENOSPC">ENOSPC</a>;</td></tr>
<tr><th id="91">91</th><td>	<b>if</b> (<a class="local col3 ref" href="#13level" title='level' data-ref="13level" data-ref-filename="13level">level</a> &gt; <a class="macro" href="#30" title="32" data-ref="_M/MAX_PID_NS_LEVEL">MAX_PID_NS_LEVEL</a>)</td></tr>
<tr><th id="92">92</th><td>		<b>goto</b> <a class="lbl" href="#16out" data-ref="16out" data-ref-filename="16out">out</a>;</td></tr>
<tr><th id="93">93</th><td>	<a class="local col4 ref" href="#14ucounts" title='ucounts' data-ref="14ucounts" data-ref-filename="14ucounts">ucounts</a> = <a class="tu ref fn" href="#inc_pid_namespaces" title='inc_pid_namespaces' data-use='c' data-ref="inc_pid_namespaces" data-ref-filename="inc_pid_namespaces">inc_pid_namespaces</a>(<a class="local col0 ref" href="#10user_ns" title='user_ns' data-ref="10user_ns" data-ref-filename="10user_ns">user_ns</a>);</td></tr>
<tr><th id="94">94</th><td>	<b>if</b> (!<a class="local col4 ref" href="#14ucounts" title='ucounts' data-ref="14ucounts" data-ref-filename="14ucounts">ucounts</a>)</td></tr>
<tr><th id="95">95</th><td>		<b>goto</b> <a class="lbl" href="#16out" data-ref="16out" data-ref-filename="16out">out</a>;</td></tr>
<tr><th id="96">96</th><td></td></tr>
<tr><th id="97">97</th><td>	<a class="local col5 ref" href="#15err" title='err' data-ref="15err" data-ref-filename="15err">err</a> = -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#16" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="98">98</th><td>	<a class="local col2 ref" href="#12ns" title='ns' data-ref="12ns" data-ref-filename="12ns">ns</a> = <a class="ref fn" href="../include/linux/slab.h.html#kmem_cache_zalloc" title='kmem_cache_zalloc' data-ref="kmem_cache_zalloc" data-ref-filename="kmem_cache_zalloc">kmem_cache_zalloc</a>(<a class="tu ref" href="#pid_ns_cachep" title='pid_ns_cachep' data-use='r' data-ref="pid_ns_cachep" data-ref-filename="pid_ns_cachep">pid_ns_cachep</a>, <a class="macro" href="../include/linux/gfp.h.html#290" title="((( gfp_t)(0x400u|0x800u)) | (( gfp_t)0x40u) | (( gfp_t)0x80u))" data-ref="_M/GFP_KERNEL">GFP_KERNEL</a>);</td></tr>
<tr><th id="99">99</th><td>	<b>if</b> (<a class="local col2 ref" href="#12ns" title='ns' data-ref="12ns" data-ref-filename="12ns">ns</a> == <a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>)</td></tr>
<tr><th id="100">100</th><td>		<b>goto</b> <a class="lbl" href="#17out_dec" data-ref="17out_dec" data-ref-filename="17out_dec">out_dec</a>;</td></tr>
<tr><th id="101">101</th><td></td></tr>
<tr><th id="102">102</th><td>	<a class="ref fn" href="../include/linux/idr.h.html#idr_init" title='idr_init' data-ref="idr_init" data-ref-filename="idr_init">idr_init</a>(&amp;<a class="local col2 ref" href="#12ns" title='ns' data-ref="12ns" data-ref-filename="12ns">ns</a>-&gt;<a class="ref field" href="../include/linux/pid_namespace.h.html#pid_namespace::idr" title='pid_namespace::idr' data-ref="pid_namespace::idr" data-ref-filename="pid_namespace..idr">idr</a>);</td></tr>
<tr><th id="103">103</th><td></td></tr>
<tr><th id="104">104</th><td>	<a class="local col2 ref" href="#12ns" title='ns' data-ref="12ns" data-ref-filename="12ns">ns</a>-&gt;<a class="ref field" href="../include/linux/pid_namespace.h.html#pid_namespace::pid_cachep" title='pid_namespace::pid_cachep' data-ref="pid_namespace::pid_cachep" data-ref-filename="pid_namespace..pid_cachep">pid_cachep</a> = <a class="tu ref fn" href="#create_pid_cachep" title='create_pid_cachep' data-use='c' data-ref="create_pid_cachep" data-ref-filename="create_pid_cachep">create_pid_cachep</a>(<a class="local col3 ref" href="#13level" title='level' data-ref="13level" data-ref-filename="13level">level</a>);</td></tr>
<tr><th id="105">105</th><td>	<b>if</b> (<a class="local col2 ref" href="#12ns" title='ns' data-ref="12ns" data-ref-filename="12ns">ns</a>-&gt;<a class="ref field" href="../include/linux/pid_namespace.h.html#pid_namespace::pid_cachep" title='pid_namespace::pid_cachep' data-ref="pid_namespace::pid_cachep" data-ref-filename="pid_namespace..pid_cachep">pid_cachep</a> == <a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>)</td></tr>
<tr><th id="106">106</th><td>		<b>goto</b> <a class="lbl" href="#18out_free_idr" data-ref="18out_free_idr" data-ref-filename="18out_free_idr">out_free_idr</a>;</td></tr>
<tr><th id="107">107</th><td></td></tr>
<tr><th id="108">108</th><td>	<a class="local col5 ref" href="#15err" title='err' data-ref="15err" data-ref-filename="15err">err</a> = <a class="ref fn" href="../include/linux/proc_ns.h.html#ns_alloc_inum" title='ns_alloc_inum' data-ref="ns_alloc_inum" data-ref-filename="ns_alloc_inum">ns_alloc_inum</a>(&amp;<a class="local col2 ref" href="#12ns" title='ns' data-ref="12ns" data-ref-filename="12ns">ns</a>-&gt;<a class="ref field" href="../include/linux/pid_namespace.h.html#pid_namespace::ns" title='pid_namespace::ns' data-ref="pid_namespace::ns" data-ref-filename="pid_namespace..ns">ns</a>);</td></tr>
<tr><th id="109">109</th><td>	<b>if</b> (<a class="local col5 ref" href="#15err" title='err' data-ref="15err" data-ref-filename="15err">err</a>)</td></tr>
<tr><th id="110">110</th><td>		<b>goto</b> <a class="lbl" href="#18out_free_idr" data-ref="18out_free_idr" data-ref-filename="18out_free_idr">out_free_idr</a>;</td></tr>
<tr><th id="111">111</th><td>	<a class="local col2 ref" href="#12ns" title='ns' data-ref="12ns" data-ref-filename="12ns">ns</a>-&gt;<a class="ref field" href="../include/linux/pid_namespace.h.html#pid_namespace::ns" title='pid_namespace::ns' data-ref="pid_namespace::ns" data-ref-filename="pid_namespace..ns">ns</a>.<a class="ref field" href="../include/linux/ns_common.h.html#ns_common::ops" title='ns_common::ops' data-ref="ns_common::ops" data-ref-filename="ns_common..ops">ops</a> = &amp;<a class="ref" href="../include/linux/proc_ns.h.html#pidns_operations" title='pidns_operations' data-ref="pidns_operations" data-ref-filename="pidns_operations">pidns_operations</a>;</td></tr>
<tr><th id="112">112</th><td></td></tr>
<tr><th id="113">113</th><td>	<a class="ref fn" href="../include/linux/kref.h.html#kref_init" title='kref_init' data-ref="kref_init" data-ref-filename="kref_init">kref_init</a>(&amp;<a class="local col2 ref" href="#12ns" title='ns' data-ref="12ns" data-ref-filename="12ns">ns</a>-&gt;<a class="ref field" href="../include/linux/pid_namespace.h.html#pid_namespace::kref" title='pid_namespace::kref' data-ref="pid_namespace::kref" data-ref-filename="pid_namespace..kref">kref</a>);</td></tr>
<tr><th id="114">114</th><td>	<a class="local col2 ref" href="#12ns" title='ns' data-ref="12ns" data-ref-filename="12ns">ns</a>-&gt;<a class="ref field" href="../include/linux/pid_namespace.h.html#pid_namespace::level" title='pid_namespace::level' data-ref="pid_namespace::level" data-ref-filename="pid_namespace..level">level</a> = <a class="local col3 ref" href="#13level" title='level' data-ref="13level" data-ref-filename="13level">level</a>;</td></tr>
<tr><th id="115">115</th><td>	<a class="local col2 ref" href="#12ns" title='ns' data-ref="12ns" data-ref-filename="12ns">ns</a>-&gt;<a class="ref field" href="../include/linux/pid_namespace.h.html#pid_namespace::parent" title='pid_namespace::parent' data-ref="pid_namespace::parent" data-ref-filename="pid_namespace..parent">parent</a> = <a class="ref fn" href="../include/linux/pid_namespace.h.html#get_pid_ns" title='get_pid_ns' data-ref="get_pid_ns" data-ref-filename="get_pid_ns">get_pid_ns</a>(<a class="local col1 ref" href="#11parent_pid_ns" title='parent_pid_ns' data-ref="11parent_pid_ns" data-ref-filename="11parent_pid_ns">parent_pid_ns</a>);</td></tr>
<tr><th id="116">116</th><td>	<a class="local col2 ref" href="#12ns" title='ns' data-ref="12ns" data-ref-filename="12ns">ns</a>-&gt;<a class="ref field" href="../include/linux/pid_namespace.h.html#pid_namespace::user_ns" title='pid_namespace::user_ns' data-ref="pid_namespace::user_ns" data-ref-filename="pid_namespace..user_ns">user_ns</a> = <a class="ref fn" href="../include/linux/user_namespace.h.html#get_user_ns" title='get_user_ns' data-ref="get_user_ns" data-ref-filename="get_user_ns">get_user_ns</a>(<a class="local col0 ref" href="#10user_ns" title='user_ns' data-ref="10user_ns" data-ref-filename="10user_ns">user_ns</a>);</td></tr>
<tr><th id="117">117</th><td>	<a class="local col2 ref" href="#12ns" title='ns' data-ref="12ns" data-ref-filename="12ns">ns</a>-&gt;<a class="ref field" href="../include/linux/pid_namespace.h.html#pid_namespace::ucounts" title='pid_namespace::ucounts' data-ref="pid_namespace::ucounts" data-ref-filename="pid_namespace..ucounts">ucounts</a> = <a class="local col4 ref" href="#14ucounts" title='ucounts' data-ref="14ucounts" data-ref-filename="14ucounts">ucounts</a>;</td></tr>
<tr><th id="118">118</th><td>	<a class="local col2 ref" href="#12ns" title='ns' data-ref="12ns" data-ref-filename="12ns">ns</a>-&gt;<a class="ref field" href="../include/linux/pid_namespace.h.html#pid_namespace::pid_allocated" title='pid_namespace::pid_allocated' data-ref="pid_namespace::pid_allocated" data-ref-filename="pid_namespace..pid_allocated">pid_allocated</a> = <a class="macro" href="../include/linux/pid_namespace.h.html#52" title="(1U &lt;&lt; 31)" data-ref="_M/PIDNS_ADDING">PIDNS_ADDING</a>;</td></tr>
<tr><th id="119">119</th><td>	<a class="macro" href="../include/linux/workqueue.h.html#249" title="do { __init_work(((&amp;ns-&gt;proc_work)), 0); ((&amp;ns-&gt;proc_work))-&gt;data = (atomic_long_t) { ((unsigned long)WORK_STRUCT_NO_POOL) }; INIT_LIST_HEAD(&amp;((&amp;ns-&gt;proc_work))-&gt;entry); ((&amp;ns-&gt;proc_work))-&gt;func = ((proc_cleanup_work)); } while (0)" data-ref="_M/INIT_WORK">INIT_WORK</a>(&amp;<a class="local col2 ref" href="#12ns" title='ns' data-ref="12ns" data-ref-filename="12ns">ns</a>-&gt;<a class="ref field" href="../include/linux/pid_namespace.h.html#pid_namespace::proc_work" title='pid_namespace::proc_work' data-ref="pid_namespace::proc_work" data-ref-filename="pid_namespace..proc_work">proc_work</a>, <a class="tu ref fn" href="#proc_cleanup_work" title='proc_cleanup_work' data-use='r' data-ref="proc_cleanup_work" data-ref-filename="proc_cleanup_work">proc_cleanup_work</a>);</td></tr>
<tr><th id="120">120</th><td></td></tr>
<tr><th id="121">121</th><td>	<b>return</b> <a class="local col2 ref" href="#12ns" title='ns' data-ref="12ns" data-ref-filename="12ns">ns</a>;</td></tr>
<tr><th id="122">122</th><td></td></tr>
<tr><th id="123">123</th><td><dfn class="lbl" id="18out_free_idr" data-ref="18out_free_idr" data-ref-filename="18out_free_idr">out_free_idr</dfn>:</td></tr>
<tr><th id="124">124</th><td>	<a class="ref fn" href="../include/linux/idr.h.html#idr_destroy" title='idr_destroy' data-ref="idr_destroy" data-ref-filename="idr_destroy">idr_destroy</a>(&amp;<a class="local col2 ref" href="#12ns" title='ns' data-ref="12ns" data-ref-filename="12ns">ns</a>-&gt;<a class="ref field" href="../include/linux/pid_namespace.h.html#pid_namespace::idr" title='pid_namespace::idr' data-ref="pid_namespace::idr" data-ref-filename="pid_namespace..idr">idr</a>);</td></tr>
<tr><th id="125">125</th><td>	<a class="ref fn" href="../include/linux/slab.h.html#kmem_cache_free" title='kmem_cache_free' data-ref="kmem_cache_free" data-ref-filename="kmem_cache_free">kmem_cache_free</a>(<a class="tu ref" href="#pid_ns_cachep" title='pid_ns_cachep' data-use='r' data-ref="pid_ns_cachep" data-ref-filename="pid_ns_cachep">pid_ns_cachep</a>, <a class="local col2 ref" href="#12ns" title='ns' data-ref="12ns" data-ref-filename="12ns">ns</a>);</td></tr>
<tr><th id="126">126</th><td><dfn class="lbl" id="17out_dec" data-ref="17out_dec" data-ref-filename="17out_dec">out_dec</dfn>:</td></tr>
<tr><th id="127">127</th><td>	<a class="tu ref fn" href="#dec_pid_namespaces" title='dec_pid_namespaces' data-use='c' data-ref="dec_pid_namespaces" data-ref-filename="dec_pid_namespaces">dec_pid_namespaces</a>(<a class="local col4 ref" href="#14ucounts" title='ucounts' data-ref="14ucounts" data-ref-filename="14ucounts">ucounts</a>);</td></tr>
<tr><th id="128">128</th><td><dfn class="lbl" id="16out" data-ref="16out" data-ref-filename="16out">out</dfn>:</td></tr>
<tr><th id="129">129</th><td>	<b>return</b> <a class="ref fn" href="../include/linux/err.h.html#ERR_PTR" title='ERR_PTR' data-ref="ERR_PTR" data-ref-filename="ERR_PTR">ERR_PTR</a>(<a class="local col5 ref" href="#15err" title='err' data-ref="15err" data-ref-filename="15err">err</a>);</td></tr>
<tr><th id="130">130</th><td>}</td></tr>
<tr><th id="131">131</th><td></td></tr>
<tr><th id="132">132</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="delayed_free_pidns" title='delayed_free_pidns' data-type='void delayed_free_pidns(struct callback_head * p)' data-ref="delayed_free_pidns" data-ref-filename="delayed_free_pidns">delayed_free_pidns</dfn>(<b>struct</b> <a class="macro" href="../include/linux/types.h.html#223" title="callback_head" data-ref="_M/rcu_head">rcu_head</a> *<dfn class="local col9 decl" id="19p" title='p' data-type='struct callback_head *' data-ref="19p" data-ref-filename="19p">p</dfn>)</td></tr>
<tr><th id="133">133</th><td>{</td></tr>
<tr><th id="134">134</th><td>	<b>struct</b> <a class="type" href="../include/linux/pid_namespace.h.html#pid_namespace" title='pid_namespace' data-ref="pid_namespace" data-ref-filename="pid_namespace">pid_namespace</a> *<dfn class="local col0 decl" id="20ns" title='ns' data-type='struct pid_namespace *' data-ref="20ns" data-ref-filename="20ns">ns</dfn> = <a class="macro" href="../include/linux/kernel.h.html#971" title="({ void *__mptr = (void *)(p); do { extern void __compiletime_assert_134(void) ; if (!(!(!__builtin_types_compatible_p(typeof(*(p)), typeof(((struct pid_namespace *)0)-&gt;rcu)) &amp;&amp; !__builtin_types_compatible_p(typeof(*(p)), typeof(void))))) __compiletime_assert_134(); } while (0); ((struct pid_namespace *)(__mptr - __builtin_offsetof(struct pid_namespace, rcu))); })" data-ref="_M/container_of">container_of</a>(<a class="local col9 ref" href="#19p" title='p' data-ref="19p" data-ref-filename="19p">p</a>, <b>struct</b> <a class="type" href="../include/linux/pid_namespace.h.html#pid_namespace" title='pid_namespace' data-ref="pid_namespace" data-ref-filename="pid_namespace">pid_namespace</a>, <a class="ref field" href="../include/linux/pid_namespace.h.html#pid_namespace::rcu" title='pid_namespace::rcu' data-ref="pid_namespace::rcu" data-ref-filename="pid_namespace..rcu">rcu</a>);</td></tr>
<tr><th id="135">135</th><td></td></tr>
<tr><th id="136">136</th><td>	<a class="tu ref fn" href="#dec_pid_namespaces" title='dec_pid_namespaces' data-use='c' data-ref="dec_pid_namespaces" data-ref-filename="dec_pid_namespaces">dec_pid_namespaces</a>(<a class="local col0 ref" href="#20ns" title='ns' data-ref="20ns" data-ref-filename="20ns">ns</a>-&gt;<a class="ref field" href="../include/linux/pid_namespace.h.html#pid_namespace::ucounts" title='pid_namespace::ucounts' data-ref="pid_namespace::ucounts" data-ref-filename="pid_namespace..ucounts">ucounts</a>);</td></tr>
<tr><th id="137">137</th><td>	<a class="ref fn" href="../include/linux/user_namespace.h.html#put_user_ns" title='put_user_ns' data-ref="put_user_ns" data-ref-filename="put_user_ns">put_user_ns</a>(<a class="local col0 ref" href="#20ns" title='ns' data-ref="20ns" data-ref-filename="20ns">ns</a>-&gt;<a class="ref field" href="../include/linux/pid_namespace.h.html#pid_namespace::user_ns" title='pid_namespace::user_ns' data-ref="pid_namespace::user_ns" data-ref-filename="pid_namespace..user_ns">user_ns</a>);</td></tr>
<tr><th id="138">138</th><td></td></tr>
<tr><th id="139">139</th><td>	<a class="ref fn" href="../include/linux/slab.h.html#kmem_cache_free" title='kmem_cache_free' data-ref="kmem_cache_free" data-ref-filename="kmem_cache_free">kmem_cache_free</a>(<a class="tu ref" href="#pid_ns_cachep" title='pid_ns_cachep' data-use='r' data-ref="pid_ns_cachep" data-ref-filename="pid_ns_cachep">pid_ns_cachep</a>, <a class="local col0 ref" href="#20ns" title='ns' data-ref="20ns" data-ref-filename="20ns">ns</a>);</td></tr>
<tr><th id="140">140</th><td>}</td></tr>
<tr><th id="141">141</th><td></td></tr>
<tr><th id="142">142</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="destroy_pid_namespace" title='destroy_pid_namespace' data-type='void destroy_pid_namespace(struct pid_namespace * ns)' data-ref="destroy_pid_namespace" data-ref-filename="destroy_pid_namespace">destroy_pid_namespace</dfn>(<b>struct</b> <a class="type" href="../include/linux/pid_namespace.h.html#pid_namespace" title='pid_namespace' data-ref="pid_namespace" data-ref-filename="pid_namespace">pid_namespace</a> *<dfn class="local col1 decl" id="21ns" title='ns' data-type='struct pid_namespace *' data-ref="21ns" data-ref-filename="21ns">ns</dfn>)</td></tr>
<tr><th id="143">143</th><td>{</td></tr>
<tr><th id="144">144</th><td>	<a class="macro" href="../include/linux/proc_ns.h.html#75" title="proc_free_inum((&amp;ns-&gt;ns)-&gt;inum)" data-ref="_M/ns_free_inum">ns_free_inum</a>(&amp;<a class="local col1 ref" href="#21ns" title='ns' data-ref="21ns" data-ref-filename="21ns">ns</a>-&gt;<a class="ref field" href="../include/linux/pid_namespace.h.html#pid_namespace::ns" title='pid_namespace::ns' data-ref="pid_namespace::ns" data-ref-filename="pid_namespace..ns">ns</a>);</td></tr>
<tr><th id="145">145</th><td></td></tr>
<tr><th id="146">146</th><td>	<a class="ref fn" href="../include/linux/idr.h.html#idr_destroy" title='idr_destroy' data-ref="idr_destroy" data-ref-filename="idr_destroy">idr_destroy</a>(&amp;<a class="local col1 ref" href="#21ns" title='ns' data-ref="21ns" data-ref-filename="21ns">ns</a>-&gt;<a class="ref field" href="../include/linux/pid_namespace.h.html#pid_namespace::idr" title='pid_namespace::idr' data-ref="pid_namespace::idr" data-ref-filename="pid_namespace..idr">idr</a>);</td></tr>
<tr><th id="147">147</th><td>	<a class="ref fn" href="../include/linux/rcupdate.h.html#call_rcu" title='call_rcu' data-ref="call_rcu" data-ref-filename="call_rcu">call_rcu</a>(&amp;<a class="local col1 ref" href="#21ns" title='ns' data-ref="21ns" data-ref-filename="21ns">ns</a>-&gt;<a class="ref field" href="../include/linux/pid_namespace.h.html#pid_namespace::rcu" title='pid_namespace::rcu' data-ref="pid_namespace::rcu" data-ref-filename="pid_namespace..rcu">rcu</a>, <a class="tu ref fn" href="#delayed_free_pidns" title='delayed_free_pidns' data-use='r' data-ref="delayed_free_pidns" data-ref-filename="delayed_free_pidns">delayed_free_pidns</a>);</td></tr>
<tr><th id="148">148</th><td>}</td></tr>
<tr><th id="149">149</th><td></td></tr>
<tr><th id="150">150</th><td><b>struct</b> <a class="type" href="../include/linux/pid_namespace.h.html#pid_namespace" title='pid_namespace' data-ref="pid_namespace" data-ref-filename="pid_namespace">pid_namespace</a> *<dfn class="decl def fn" id="copy_pid_ns" title='copy_pid_ns' data-ref="copy_pid_ns" data-ref-filename="copy_pid_ns">copy_pid_ns</dfn>(<em>unsigned</em> <em>long</em> <dfn class="local col2 decl" id="22flags" title='flags' data-type='unsigned long' data-ref="22flags" data-ref-filename="22flags">flags</dfn>,</td></tr>
<tr><th id="151">151</th><td>	<b>struct</b> <a class="type" href="../include/linux/user_namespace.h.html#user_namespace" title='user_namespace' data-ref="user_namespace" data-ref-filename="user_namespace">user_namespace</a> *<dfn class="local col3 decl" id="23user_ns" title='user_ns' data-type='struct user_namespace *' data-ref="23user_ns" data-ref-filename="23user_ns">user_ns</dfn>, <b>struct</b> <a class="type" href="../include/linux/pid_namespace.h.html#pid_namespace" title='pid_namespace' data-ref="pid_namespace" data-ref-filename="pid_namespace">pid_namespace</a> *<dfn class="local col4 decl" id="24old_ns" title='old_ns' data-type='struct pid_namespace *' data-ref="24old_ns" data-ref-filename="24old_ns">old_ns</dfn>)</td></tr>
<tr><th id="152">152</th><td>{</td></tr>
<tr><th id="153">153</th><td>	<b>if</b> (!(<a class="local col2 ref" href="#22flags" title='flags' data-ref="22flags" data-ref-filename="22flags">flags</a> &amp; <a class="macro" href="../include/uapi/linux/sched.h.html#32" title="0x20000000" data-ref="_M/CLONE_NEWPID">CLONE_NEWPID</a>))</td></tr>
<tr><th id="154">154</th><td>		<b>return</b> <a class="ref fn" href="../include/linux/pid_namespace.h.html#get_pid_ns" title='get_pid_ns' data-ref="get_pid_ns" data-ref-filename="get_pid_ns">get_pid_ns</a>(<a class="local col4 ref" href="#24old_ns" title='old_ns' data-ref="24old_ns" data-ref-filename="24old_ns">old_ns</a>);</td></tr>
<tr><th id="155">155</th><td>	<b>if</b> (<a class="ref fn" href="../include/linux/pid_namespace.h.html#task_active_pid_ns" title='task_active_pid_ns' data-ref="task_active_pid_ns" data-ref-filename="task_active_pid_ns">task_active_pid_ns</a>(<a class="macro" href="../arch/x86/include/asm/current.h.html#18" title="get_current()" data-ref="_M/current">current</a>) != <a class="local col4 ref" href="#24old_ns" title='old_ns' data-ref="24old_ns" data-ref-filename="24old_ns">old_ns</a>)</td></tr>
<tr><th id="156">156</th><td>		<b>return</b> <a class="ref fn" href="../include/linux/err.h.html#ERR_PTR" title='ERR_PTR' data-ref="ERR_PTR" data-ref-filename="ERR_PTR">ERR_PTR</a>(-<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>);</td></tr>
<tr><th id="157">157</th><td>	<b>return</b> <a class="tu ref fn" href="#create_pid_namespace" title='create_pid_namespace' data-use='c' data-ref="create_pid_namespace" data-ref-filename="create_pid_namespace">create_pid_namespace</a>(<a class="local col3 ref" href="#23user_ns" title='user_ns' data-ref="23user_ns" data-ref-filename="23user_ns">user_ns</a>, <a class="local col4 ref" href="#24old_ns" title='old_ns' data-ref="24old_ns" data-ref-filename="24old_ns">old_ns</a>);</td></tr>
<tr><th id="158">158</th><td>}</td></tr>
<tr><th id="159">159</th><td></td></tr>
<tr><th id="160">160</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="free_pid_ns" title='free_pid_ns' data-type='void free_pid_ns(struct kref * kref)' data-ref="free_pid_ns" data-ref-filename="free_pid_ns">free_pid_ns</dfn>(<b>struct</b> <a class="type" href="../include/linux/kref.h.html#kref" title='kref' data-ref="kref" data-ref-filename="kref">kref</a> *<dfn class="local col5 decl" id="25kref" title='kref' data-type='struct kref *' data-ref="25kref" data-ref-filename="25kref">kref</dfn>)</td></tr>
<tr><th id="161">161</th><td>{</td></tr>
<tr><th id="162">162</th><td>	<b>struct</b> <a class="type" href="../include/linux/pid_namespace.h.html#pid_namespace" title='pid_namespace' data-ref="pid_namespace" data-ref-filename="pid_namespace">pid_namespace</a> *<dfn class="local col6 decl" id="26ns" title='ns' data-type='struct pid_namespace *' data-ref="26ns" data-ref-filename="26ns">ns</dfn>;</td></tr>
<tr><th id="163">163</th><td></td></tr>
<tr><th id="164">164</th><td>	<a class="local col6 ref" href="#26ns" title='ns' data-ref="26ns" data-ref-filename="26ns">ns</a> = <a class="macro" href="../include/linux/kernel.h.html#971" title="({ void *__mptr = (void *)(kref); do { extern void __compiletime_assert_164(void) ; if (!(!(!__builtin_types_compatible_p(typeof(*(kref)), typeof(((struct pid_namespace *)0)-&gt;kref)) &amp;&amp; !__builtin_types_compatible_p(typeof(*(kref)), typeof(void))))) __compiletime_assert_164(); } while (0); ((struct pid_namespace *)(__mptr - __builtin_offsetof(struct pid_namespace, kref))); })" data-ref="_M/container_of">container_of</a>(<a class="local col5 ref" href="#25kref" title='kref' data-ref="25kref" data-ref-filename="25kref">kref</a>, <b>struct</b> <a class="type" href="../include/linux/pid_namespace.h.html#pid_namespace" title='pid_namespace' data-ref="pid_namespace" data-ref-filename="pid_namespace">pid_namespace</a>, <a class="ref field" href="../include/linux/pid_namespace.h.html#pid_namespace::kref" title='pid_namespace::kref' data-ref="pid_namespace::kref" data-ref-filename="pid_namespace..kref">kref</a>);</td></tr>
<tr><th id="165">165</th><td>	<a class="tu ref fn" href="#destroy_pid_namespace" title='destroy_pid_namespace' data-use='c' data-ref="destroy_pid_namespace" data-ref-filename="destroy_pid_namespace">destroy_pid_namespace</a>(<a class="local col6 ref" href="#26ns" title='ns' data-ref="26ns" data-ref-filename="26ns">ns</a>);</td></tr>
<tr><th id="166">166</th><td>}</td></tr>
<tr><th id="167">167</th><td></td></tr>
<tr><th id="168">168</th><td><em>void</em> <dfn class="decl def fn" id="put_pid_ns" title='put_pid_ns' data-ref="put_pid_ns" data-ref-filename="put_pid_ns">put_pid_ns</dfn>(<b>struct</b> <a class="type" href="../include/linux/pid_namespace.h.html#pid_namespace" title='pid_namespace' data-ref="pid_namespace" data-ref-filename="pid_namespace">pid_namespace</a> *<dfn class="local col7 decl" id="27ns" title='ns' data-type='struct pid_namespace *' data-ref="27ns" data-ref-filename="27ns">ns</dfn>)</td></tr>
<tr><th id="169">169</th><td>{</td></tr>
<tr><th id="170">170</th><td>	<b>struct</b> <a class="type" href="../include/linux/pid_namespace.h.html#pid_namespace" title='pid_namespace' data-ref="pid_namespace" data-ref-filename="pid_namespace">pid_namespace</a> *<dfn class="local col8 decl" id="28parent" title='parent' data-type='struct pid_namespace *' data-ref="28parent" data-ref-filename="28parent">parent</dfn>;</td></tr>
<tr><th id="171">171</th><td></td></tr>
<tr><th id="172">172</th><td>	<b>while</b> (<a class="local col7 ref" href="#27ns" title='ns' data-ref="27ns" data-ref-filename="27ns">ns</a> != &amp;<a class="ref" href="../include/linux/pid.h.html#init_pid_ns" title='init_pid_ns' data-ref="init_pid_ns" data-ref-filename="init_pid_ns">init_pid_ns</a>) {</td></tr>
<tr><th id="173">173</th><td>		<a class="local col8 ref" href="#28parent" title='parent' data-ref="28parent" data-ref-filename="28parent">parent</a> = <a class="local col7 ref" href="#27ns" title='ns' data-ref="27ns" data-ref-filename="27ns">ns</a>-&gt;<a class="ref field" href="../include/linux/pid_namespace.h.html#pid_namespace::parent" title='pid_namespace::parent' data-ref="pid_namespace::parent" data-ref-filename="pid_namespace..parent">parent</a>;</td></tr>
<tr><th id="174">174</th><td>		<b>if</b> (!<a class="ref fn" href="../include/linux/kref.h.html#kref_put" title='kref_put' data-ref="kref_put" data-ref-filename="kref_put">kref_put</a>(&amp;<a class="local col7 ref" href="#27ns" title='ns' data-ref="27ns" data-ref-filename="27ns">ns</a>-&gt;<a class="ref field" href="../include/linux/pid_namespace.h.html#pid_namespace::kref" title='pid_namespace::kref' data-ref="pid_namespace::kref" data-ref-filename="pid_namespace..kref">kref</a>, <a class="tu ref fn" href="#free_pid_ns" title='free_pid_ns' data-use='r' data-ref="free_pid_ns" data-ref-filename="free_pid_ns">free_pid_ns</a>))</td></tr>
<tr><th id="175">175</th><td>			<b>break</b>;</td></tr>
<tr><th id="176">176</th><td>		<a class="local col7 ref" href="#27ns" title='ns' data-ref="27ns" data-ref-filename="27ns">ns</a> = <a class="local col8 ref" href="#28parent" title='parent' data-ref="28parent" data-ref-filename="28parent">parent</a>;</td></tr>
<tr><th id="177">177</th><td>	}</td></tr>
<tr><th id="178">178</th><td>}</td></tr>
<tr><th id="179">179</th><td><a class="macro" href="../include/linux/export.h.html#126" title="extern typeof(put_pid_ns) put_pid_ns; static const char __kstrtab_put_pid_ns[] __attribute__((section(&quot;__ksymtab_strings&quot;), used, aligned(1))) = &quot;put_pid_ns&quot;; static void * __attribute__((__section__(&quot;.discard.addressable&quot;))) __attribute__((__used__)) __addressable_put_pid_ns179 = (void *)&amp;put_pid_ns; asm(&quot;	.section \&quot;___ksymtab&quot; &quot;_gpl&quot; &quot;+&quot; &quot;put_pid_ns&quot; &quot;\&quot;, \&quot;a\&quot;	\n&quot; &quot;	.balign	8					\n&quot; &quot;__ksymtab_&quot; &quot;put_pid_ns&quot; &quot;:				\n&quot; &quot;	.long	&quot; &quot;put_pid_ns&quot; &quot;- .				\n&quot; &quot;	.long	__kstrtab_&quot; &quot;put_pid_ns&quot; &quot;- .			\n&quot; &quot;	.previous					\n&quot;)" data-ref="_M/EXPORT_SYMBOL_GPL">EXPORT_SYMBOL_GPL</a>(<a class="decl fn" href="#put_pid_ns" title='put_pid_ns' data-ref="put_pid_ns" data-ref-filename="put_pid_ns"><a class="ref fn" href="#put_pid_ns" title='put_pid_ns' data-ref="put_pid_ns" data-ref-filename="put_pid_ns"><a class="ref fn" href="#put_pid_ns" title='put_pid_ns' data-ref="put_pid_ns" data-ref-filename="put_pid_ns">put_pid_ns</a></a></a>);</td></tr>
<tr><th id="180">180</th><td></td></tr>
<tr><th id="181">181</th><td><em>void</em> <dfn class="decl def fn" id="zap_pid_ns_processes" title='zap_pid_ns_processes' data-ref="zap_pid_ns_processes" data-ref-filename="zap_pid_ns_processes">zap_pid_ns_processes</dfn>(<b>struct</b> <a class="type" href="../include/linux/pid_namespace.h.html#pid_namespace" title='pid_namespace' data-ref="pid_namespace" data-ref-filename="pid_namespace">pid_namespace</a> *<dfn class="local col9 decl" id="29pid_ns" title='pid_ns' data-type='struct pid_namespace *' data-ref="29pid_ns" data-ref-filename="29pid_ns">pid_ns</dfn>)</td></tr>
<tr><th id="182">182</th><td>{</td></tr>
<tr><th id="183">183</th><td>	<em>int</em> <dfn class="local col0 decl" id="30nr" title='nr' data-type='int' data-ref="30nr" data-ref-filename="30nr">nr</dfn>;</td></tr>
<tr><th id="184">184</th><td>	<em>int</em> <dfn class="local col1 decl" id="31rc" title='rc' data-type='int' data-ref="31rc" data-ref-filename="31rc">rc</dfn>;</td></tr>
<tr><th id="185">185</th><td>	<b>struct</b> <a class="type" href="../include/linux/sched.h.html#task_struct" title='task_struct' data-ref="task_struct" data-ref-filename="task_struct">task_struct</a> *<dfn class="local col2 decl" id="32task" title='task' data-type='struct task_struct *' data-ref="32task" data-ref-filename="32task">task</dfn>, *<dfn class="local col3 decl" id="33me" title='me' data-type='struct task_struct *' data-ref="33me" data-ref-filename="33me">me</dfn> = <a class="macro" href="../arch/x86/include/asm/current.h.html#18" title="get_current()" data-ref="_M/current">current</a>;</td></tr>
<tr><th id="186">186</th><td>	<em>int</em> <dfn class="local col4 decl" id="34init_pids" title='init_pids' data-type='int' data-ref="34init_pids" data-ref-filename="34init_pids">init_pids</dfn> = <a class="ref fn" href="../include/linux/sched/signal.h.html#thread_group_leader" title='thread_group_leader' data-ref="thread_group_leader" data-ref-filename="thread_group_leader">thread_group_leader</a>(<a class="local col3 ref" href="#33me" title='me' data-ref="33me" data-ref-filename="33me">me</a>) ? <var>1</var> : <var>2</var>;</td></tr>
<tr><th id="187">187</th><td>	<b>struct</b> <a class="type" href="../include/linux/pid.h.html#pid" title='pid' data-ref="pid" data-ref-filename="pid">pid</a> *<dfn class="local col5 decl" id="35pid" title='pid' data-type='struct pid *' data-ref="35pid" data-ref-filename="35pid">pid</dfn>;</td></tr>
<tr><th id="188">188</th><td></td></tr>
<tr><th id="189">189</th><td>	<i>/* Don't allow any more processes into the pid namespace */</i></td></tr>
<tr><th id="190">190</th><td>	<a class="ref fn" href="../include/linux/pid.h.html#disable_pid_allocation" title='disable_pid_allocation' data-ref="disable_pid_allocation" data-ref-filename="disable_pid_allocation">disable_pid_allocation</a>(<a class="local col9 ref" href="#29pid_ns" title='pid_ns' data-ref="29pid_ns" data-ref-filename="29pid_ns">pid_ns</a>);</td></tr>
<tr><th id="191">191</th><td></td></tr>
<tr><th id="192">192</th><td>	<i>/*</i></td></tr>
<tr><th id="193">193</th><td><i>	 * Ignore SIGCHLD causing any terminated children to autoreap.</i></td></tr>
<tr><th id="194">194</th><td><i>	 * This speeds up the namespace shutdown, plus see the comment</i></td></tr>
<tr><th id="195">195</th><td><i>	 * below.</i></td></tr>
<tr><th id="196">196</th><td><i>	 */</i></td></tr>
<tr><th id="197">197</th><td>	<a class="ref fn" href="../include/linux/spinlock.h.html#spin_lock_irq" title='spin_lock_irq' data-ref="spin_lock_irq" data-ref-filename="spin_lock_irq">spin_lock_irq</a>(&amp;<a class="local col3 ref" href="#33me" title='me' data-ref="33me" data-ref-filename="33me">me</a>-&gt;<a class="ref field" href="../include/linux/sched.h.html#task_struct::sighand" title='task_struct::sighand' data-ref="task_struct::sighand" data-ref-filename="task_struct..sighand">sighand</a>-&gt;<a class="ref field" href="../include/linux/sched/signal.h.html#sighand_struct::siglock" title='sighand_struct::siglock' data-ref="sighand_struct::siglock" data-ref-filename="sighand_struct..siglock">siglock</a>);</td></tr>
<tr><th id="198">198</th><td>	<a class="local col3 ref" href="#33me" title='me' data-ref="33me" data-ref-filename="33me">me</a>-&gt;<a class="ref field" href="../include/linux/sched.h.html#task_struct::sighand" title='task_struct::sighand' data-ref="task_struct::sighand" data-ref-filename="task_struct..sighand">sighand</a>-&gt;<a class="ref field" href="../include/linux/sched/signal.h.html#sighand_struct::action" title='sighand_struct::action' data-ref="sighand_struct::action" data-ref-filename="sighand_struct..action">action</a>[<a class="macro" href="../arch/x86/include/uapi/asm/signal.h.html#40" title="17" data-ref="_M/SIGCHLD">SIGCHLD</a> - <var>1</var>].<a class="ref field" href="../include/linux/signal_types.h.html#k_sigaction::sa" title='k_sigaction::sa' data-ref="k_sigaction::sa" data-ref-filename="k_sigaction..sa">sa</a>.<a class="ref field" href="../include/linux/signal_types.h.html#sigaction::sa_handler" title='sigaction::sa_handler' data-ref="sigaction::sa_handler" data-ref-filename="sigaction..sa_handler">sa_handler</a> = <a class="macro" href="../include/uapi/asm-generic/signal-defs.h.html#25" title="(( __sighandler_t)1)" data-ref="_M/SIG_IGN">SIG_IGN</a>;</td></tr>
<tr><th id="199">199</th><td>	<a class="ref fn" href="../include/linux/spinlock.h.html#spin_unlock_irq" title='spin_unlock_irq' data-ref="spin_unlock_irq" data-ref-filename="spin_unlock_irq">spin_unlock_irq</a>(&amp;<a class="local col3 ref" href="#33me" title='me' data-ref="33me" data-ref-filename="33me">me</a>-&gt;<a class="ref field" href="../include/linux/sched.h.html#task_struct::sighand" title='task_struct::sighand' data-ref="task_struct::sighand" data-ref-filename="task_struct..sighand">sighand</a>-&gt;<a class="ref field" href="../include/linux/sched/signal.h.html#sighand_struct::siglock" title='sighand_struct::siglock' data-ref="sighand_struct::siglock" data-ref-filename="sighand_struct..siglock">siglock</a>);</td></tr>
<tr><th id="200">200</th><td></td></tr>
<tr><th id="201">201</th><td>	<i>/*</i></td></tr>
<tr><th id="202">202</th><td><i>	 * The last thread in the cgroup-init thread group is terminating.</i></td></tr>
<tr><th id="203">203</th><td><i>	 * Find remaining pid_ts in the namespace, signal and wait for them</i></td></tr>
<tr><th id="204">204</th><td><i>	 * to exit.</i></td></tr>
<tr><th id="205">205</th><td><i>	 *</i></td></tr>
<tr><th id="206">206</th><td><i>	 * Note:  This signals each threads in the namespace - even those that</i></td></tr>
<tr><th id="207">207</th><td><i>	 * 	  belong to the same thread group, To avoid this, we would have</i></td></tr>
<tr><th id="208">208</th><td><i>	 * 	  to walk the entire tasklist looking a processes in this</i></td></tr>
<tr><th id="209">209</th><td><i>	 * 	  namespace, but that could be unnecessarily expensive if the</i></td></tr>
<tr><th id="210">210</th><td><i>	 * 	  pid namespace has just a few processes. Or we need to</i></td></tr>
<tr><th id="211">211</th><td><i>	 * 	  maintain a tasklist for each pid namespace.</i></td></tr>
<tr><th id="212">212</th><td><i>	 *</i></td></tr>
<tr><th id="213">213</th><td><i>	 */</i></td></tr>
<tr><th id="214">214</th><td>	<a class="ref fn" href="../include/linux/rcupdate.h.html#rcu_read_lock" title='rcu_read_lock' data-ref="rcu_read_lock" data-ref-filename="rcu_read_lock">rcu_read_lock</a>();</td></tr>
<tr><th id="215">215</th><td>	<a class="macro" href="../include/linux/rwlock.h.html#71" title="_raw_read_lock(&amp;tasklist_lock)" data-ref="_M/read_lock">read_lock</a>(&amp;<a class="ref" href="../include/linux/sched/task.h.html#tasklist_lock" title='tasklist_lock' data-ref="tasklist_lock" data-ref-filename="tasklist_lock">tasklist_lock</a>);</td></tr>
<tr><th id="216">216</th><td>	<a class="local col0 ref" href="#30nr" title='nr' data-ref="30nr" data-ref-filename="30nr">nr</a> = <var>2</var>;</td></tr>
<tr><th id="217">217</th><td>	<a class="macro" href="../include/linux/idr.h.html#214" title="for ((pid) = idr_get_next((&amp;pid_ns-&gt;idr), &amp;(nr)); pid; ++nr, (pid) = idr_get_next((&amp;pid_ns-&gt;idr), &amp;(nr)))" data-ref="_M/idr_for_each_entry_continue">idr_for_each_entry_continue</a>(&amp;<a class="local col9 ref" href="#29pid_ns" title='pid_ns' data-ref="29pid_ns" data-ref-filename="29pid_ns">pid_ns</a>-&gt;<a class="ref field" href="../include/linux/pid_namespace.h.html#pid_namespace::idr" title='pid_namespace::idr' data-ref="pid_namespace::idr" data-ref-filename="pid_namespace..idr">idr</a>, <a class="local col5 ref" href="#35pid" title='pid' data-ref="35pid" data-ref-filename="35pid">pid</a>, <a class="local col0 ref" href="#30nr" title='nr' data-ref="30nr" data-ref-filename="30nr">nr</a>) {</td></tr>
<tr><th id="218">218</th><td>		<a class="local col2 ref" href="#32task" title='task' data-ref="32task" data-ref-filename="32task">task</a> = <a class="ref fn" href="../include/linux/pid.h.html#pid_task" title='pid_task' data-ref="pid_task" data-ref-filename="pid_task">pid_task</a>(<a class="local col5 ref" href="#35pid" title='pid' data-ref="35pid" data-ref-filename="35pid">pid</a>, <a class="enum" href="../include/linux/pid.h.html#PIDTYPE_PID" title='PIDTYPE_PID' data-ref="PIDTYPE_PID" data-ref-filename="PIDTYPE_PID">PIDTYPE_PID</a>);</td></tr>
<tr><th id="219">219</th><td>		<b>if</b> (<a class="local col2 ref" href="#32task" title='task' data-ref="32task" data-ref-filename="32task">task</a> &amp;&amp; !<a class="ref fn" href="../include/linux/sched/signal.h.html#__fatal_signal_pending" title='__fatal_signal_pending' data-ref="__fatal_signal_pending" data-ref-filename="__fatal_signal_pending">__fatal_signal_pending</a>(<a class="local col2 ref" href="#32task" title='task' data-ref="32task" data-ref-filename="32task">task</a>))</td></tr>
<tr><th id="220">220</th><td>			<a class="ref fn" href="../include/linux/signal.h.html#group_send_sig_info" title='group_send_sig_info' data-ref="group_send_sig_info" data-ref-filename="group_send_sig_info">group_send_sig_info</a>(<a class="macro" href="../arch/x86/include/uapi/asm/signal.h.html#32" title="9" data-ref="_M/SIGKILL">SIGKILL</a>, <a class="macro" href="../include/linux/sched/signal.h.html#510" title="((struct kernel_siginfo *) 1)" data-ref="_M/SEND_SIG_PRIV">SEND_SIG_PRIV</a>, <a class="local col2 ref" href="#32task" title='task' data-ref="32task" data-ref-filename="32task">task</a>, <a class="enum" href="../include/linux/pid.h.html#PIDTYPE_MAX" title='PIDTYPE_MAX' data-ref="PIDTYPE_MAX" data-ref-filename="PIDTYPE_MAX">PIDTYPE_MAX</a>);</td></tr>
<tr><th id="221">221</th><td>	}</td></tr>
<tr><th id="222">222</th><td>	<a class="macro" href="../include/linux/rwlock.h.html#105" title="__raw_read_unlock(&amp;tasklist_lock)" data-ref="_M/read_unlock">read_unlock</a>(&amp;<a class="ref" href="../include/linux/sched/task.h.html#tasklist_lock" title='tasklist_lock' data-ref="tasklist_lock" data-ref-filename="tasklist_lock">tasklist_lock</a>);</td></tr>
<tr><th id="223">223</th><td>	<a class="ref fn" href="../include/linux/rcupdate.h.html#rcu_read_unlock" title='rcu_read_unlock' data-ref="rcu_read_unlock" data-ref-filename="rcu_read_unlock">rcu_read_unlock</a>();</td></tr>
<tr><th id="224">224</th><td></td></tr>
<tr><th id="225">225</th><td>	<i>/*</i></td></tr>
<tr><th id="226">226</th><td><i>	 * Reap the EXIT_ZOMBIE children we had before we ignored SIGCHLD.</i></td></tr>
<tr><th id="227">227</th><td><i>	 * kernel_wait4() will also block until our children traced from the</i></td></tr>
<tr><th id="228">228</th><td><i>	 * parent namespace are detached and become EXIT_DEAD.</i></td></tr>
<tr><th id="229">229</th><td><i>	 */</i></td></tr>
<tr><th id="230">230</th><td>	<b>do</b> {</td></tr>
<tr><th id="231">231</th><td>		<a class="macro" href="../include/linux/thread_info.h.html#89" title="clear_ti_thread_flag(((struct thread_info *)get_current()), 2)" data-ref="_M/clear_thread_flag">clear_thread_flag</a>(<a class="macro" href="../arch/x86/include/asm/thread_info.h.html#79" title="2" data-ref="_M/TIF_SIGPENDING">TIF_SIGPENDING</a>);</td></tr>
<tr><th id="232">232</th><td>		<a class="local col1 ref" href="#31rc" title='rc' data-ref="31rc" data-ref-filename="31rc">rc</a> = <a class="ref fn" href="../include/linux/sched/task.h.html#kernel_wait4" title='kernel_wait4' data-ref="kernel_wait4" data-ref-filename="kernel_wait4">kernel_wait4</a>(-<var>1</var>, <a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>, <a class="macro" href="../include/uapi/linux/wait.h.html#13" title="0x40000000" data-ref="_M/__WALL">__WALL</a>, <a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>);</td></tr>
<tr><th id="233">233</th><td>	} <b>while</b> (<a class="local col1 ref" href="#31rc" title='rc' data-ref="31rc" data-ref-filename="31rc">rc</a> != -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#14" title="10" data-ref="_M/ECHILD">ECHILD</a>);</td></tr>
<tr><th id="234">234</th><td></td></tr>
<tr><th id="235">235</th><td>	<i>/*</i></td></tr>
<tr><th id="236">236</th><td><i>	 * kernel_wait4() above can't reap the EXIT_DEAD children but we do not</i></td></tr>
<tr><th id="237">237</th><td><i>	 * really care, we could reparent them to the global init. We could</i></td></tr>
<tr><th id="238">238</th><td><i>	 * exit and reap -&gt;child_reaper even if it is not the last thread in</i></td></tr>
<tr><th id="239">239</th><td><i>	 * this pid_ns, free_pid(pid_allocated == 0) calls proc_cleanup_work(),</i></td></tr>
<tr><th id="240">240</th><td><i>	 * pid_ns can not go away until proc_kill_sb() drops the reference.</i></td></tr>
<tr><th id="241">241</th><td><i>	 *</i></td></tr>
<tr><th id="242">242</th><td><i>	 * But this ns can also have other tasks injected by setns()+fork().</i></td></tr>
<tr><th id="243">243</th><td><i>	 * Again, ignoring the user visible semantics we do not really need</i></td></tr>
<tr><th id="244">244</th><td><i>	 * to wait until they are all reaped, but they can be reparented to</i></td></tr>
<tr><th id="245">245</th><td><i>	 * us and thus we need to ensure that pid-&gt;child_reaper stays valid</i></td></tr>
<tr><th id="246">246</th><td><i>	 * until they all go away. See free_pid()-&gt;wake_up_process().</i></td></tr>
<tr><th id="247">247</th><td><i>	 *</i></td></tr>
<tr><th id="248">248</th><td><i>	 * We rely on ignored SIGCHLD, an injected zombie must be autoreaped</i></td></tr>
<tr><th id="249">249</th><td><i>	 * if reparented.</i></td></tr>
<tr><th id="250">250</th><td><i>	 */</i></td></tr>
<tr><th id="251">251</th><td>	<b>for</b> (;;) {</td></tr>
<tr><th id="252">252</th><td>		<a class="macro" href="../include/linux/sched.h.html#191" title="do { (void)({ typeof(&amp;get_current()-&gt;state) __ai_ptr = (&amp;get_current()-&gt;state); kasan_check_write(__ai_ptr, sizeof(*__ai_ptr)); ({ __typeof__ (*((__ai_ptr))) __ret = (((0x0001))); switch (sizeof(*((__ai_ptr)))) { case 1: asm volatile (&quot;&quot; &quot;xchg&quot; &quot;b %b0, %1\n&quot; : &quot;+q&quot; (__ret), &quot;+m&quot; (*((__ai_ptr))) : : &quot;memory&quot;, &quot;cc&quot;); break; case 2: asm volatile (&quot;&quot; &quot;xchg&quot; &quot;w %w0, %1\n&quot; : &quot;+r&quot; (__ret), &quot;+m&quot; (*((__ai_ptr))) : : &quot;memory&quot;, &quot;cc&quot;); break; case 4: asm volatile (&quot;&quot; &quot;xchg&quot; &quot;l %0, %1\n&quot; : &quot;+r&quot; (__ret), &quot;+m&quot; (*((__ai_ptr))) : : &quot;memory&quot;, &quot;cc&quot;); break; case 8: asm volatile (&quot;&quot; &quot;xchg&quot; &quot;q %q0, %1\n&quot; : &quot;+r&quot; (__ret), &quot;+m&quot; (*((__ai_ptr))) : : &quot;memory&quot;, &quot;cc&quot;); break; default: __xchg_wrong_size(); } __ret; }); }); } while (0)" data-ref="_M/set_current_state">set_current_state</a>(<a class="macro" href="../include/linux/sched.h.html#75" title="0x0001" data-ref="_M/TASK_INTERRUPTIBLE">TASK_INTERRUPTIBLE</a>);</td></tr>
<tr><th id="253">253</th><td>		<b>if</b> (<a class="local col9 ref" href="#29pid_ns" title='pid_ns' data-ref="29pid_ns" data-ref-filename="29pid_ns">pid_ns</a>-&gt;<a class="ref field" href="../include/linux/pid_namespace.h.html#pid_namespace::pid_allocated" title='pid_namespace::pid_allocated' data-ref="pid_namespace::pid_allocated" data-ref-filename="pid_namespace..pid_allocated">pid_allocated</a> == <a class="local col4 ref" href="#34init_pids" title='init_pids' data-ref="34init_pids" data-ref-filename="34init_pids">init_pids</a>)</td></tr>
<tr><th id="254">254</th><td>			<b>break</b>;</td></tr>
<tr><th id="255">255</th><td>		<a class="ref fn" href="../include/linux/sched.h.html#schedule" title='schedule' data-ref="schedule" data-ref-filename="schedule">schedule</a>();</td></tr>
<tr><th id="256">256</th><td>	}</td></tr>
<tr><th id="257">257</th><td>	<a class="macro" href="../include/linux/sched.h.html#188" title="get_current()-&gt;state = (0x0000)" data-ref="_M/__set_current_state">__set_current_state</a>(<a class="macro" href="../include/linux/sched.h.html#74" title="0x0000" data-ref="_M/TASK_RUNNING">TASK_RUNNING</a>);</td></tr>
<tr><th id="258">258</th><td></td></tr>
<tr><th id="259">259</th><td>	<b>if</b> (<a class="local col9 ref" href="#29pid_ns" title='pid_ns' data-ref="29pid_ns" data-ref-filename="29pid_ns">pid_ns</a>-&gt;<a class="ref field" href="../include/linux/pid_namespace.h.html#pid_namespace::reboot" title='pid_namespace::reboot' data-ref="pid_namespace::reboot" data-ref-filename="pid_namespace..reboot">reboot</a>)</td></tr>
<tr><th id="260">260</th><td>		<a class="macro" href="../arch/x86/include/asm/current.h.html#18" title="get_current()" data-ref="_M/current">current</a>-&gt;<a class="ref field" href="../include/linux/sched.h.html#task_struct::signal" title='task_struct::signal' data-ref="task_struct::signal" data-ref-filename="task_struct..signal">signal</a>-&gt;<a class="ref field" href="../include/linux/sched/signal.h.html#signal_struct::group_exit_code" title='signal_struct::group_exit_code' data-ref="signal_struct::group_exit_code" data-ref-filename="signal_struct..group_exit_code">group_exit_code</a> = <a class="local col9 ref" href="#29pid_ns" title='pid_ns' data-ref="29pid_ns" data-ref-filename="29pid_ns">pid_ns</a>-&gt;<a class="ref field" href="../include/linux/pid_namespace.h.html#pid_namespace::reboot" title='pid_namespace::reboot' data-ref="pid_namespace::reboot" data-ref-filename="pid_namespace..reboot">reboot</a>;</td></tr>
<tr><th id="261">261</th><td></td></tr>
<tr><th id="262">262</th><td>	<a class="ref fn" href="../include/linux/acct.h.html#acct_exit_ns" title='acct_exit_ns' data-ref="acct_exit_ns" data-ref-filename="acct_exit_ns">acct_exit_ns</a>(<a class="local col9 ref" href="#29pid_ns" title='pid_ns' data-ref="29pid_ns" data-ref-filename="29pid_ns">pid_ns</a>);</td></tr>
<tr><th id="263">263</th><td>	<b>return</b>;</td></tr>
<tr><th id="264">264</th><td>}</td></tr>
<tr><th id="265">265</th><td></td></tr>
<tr><th id="266">266</th><td><u>#<span data-ppcond="266">ifdef</span> <span class="macro" data-ref="_M/CONFIG_CHECKPOINT_RESTORE">CONFIG_CHECKPOINT_RESTORE</span></u></td></tr>
<tr><th id="267">267</th><td><em>static</em> <em>int</em> pid_ns_ctl_handler(<b>struct</b> ctl_table *table, <em>int</em> write,</td></tr>
<tr><th id="268">268</th><td>		<em>void</em> __user *buffer, size_t *lenp, loff_t *ppos)</td></tr>
<tr><th id="269">269</th><td>{</td></tr>
<tr><th id="270">270</th><td>	<b>struct</b> pid_namespace *pid_ns = task_active_pid_ns(current);</td></tr>
<tr><th id="271">271</th><td>	<b>struct</b> ctl_table tmp = *table;</td></tr>
<tr><th id="272">272</th><td>	<em>int</em> ret, next;</td></tr>
<tr><th id="273">273</th><td></td></tr>
<tr><th id="274">274</th><td>	<b>if</b> (write &amp;&amp; !ns_capable(pid_ns-&gt;user_ns, CAP_SYS_ADMIN))</td></tr>
<tr><th id="275">275</th><td>		<b>return</b> -EPERM;</td></tr>
<tr><th id="276">276</th><td></td></tr>
<tr><th id="277">277</th><td>	<i>/*</i></td></tr>
<tr><th id="278">278</th><td><i>	 * Writing directly to ns' last_pid field is OK, since this field</i></td></tr>
<tr><th id="279">279</th><td><i>	 * is volatile in a living namespace anyway and a code writing to</i></td></tr>
<tr><th id="280">280</th><td><i>	 * it should synchronize its usage with external means.</i></td></tr>
<tr><th id="281">281</th><td><i>	 */</i></td></tr>
<tr><th id="282">282</th><td></td></tr>
<tr><th id="283">283</th><td>	next = idr_get_cursor(&amp;pid_ns-&gt;idr) - <var>1</var>;</td></tr>
<tr><th id="284">284</th><td></td></tr>
<tr><th id="285">285</th><td>	tmp.data = &amp;next;</td></tr>
<tr><th id="286">286</th><td>	ret = proc_dointvec_minmax(&amp;tmp, write, buffer, lenp, ppos);</td></tr>
<tr><th id="287">287</th><td>	<b>if</b> (!ret &amp;&amp; write)</td></tr>
<tr><th id="288">288</th><td>		idr_set_cursor(&amp;pid_ns-&gt;idr, next + <var>1</var>);</td></tr>
<tr><th id="289">289</th><td></td></tr>
<tr><th id="290">290</th><td>	<b>return</b> ret;</td></tr>
<tr><th id="291">291</th><td>}</td></tr>
<tr><th id="292">292</th><td></td></tr>
<tr><th id="293">293</th><td><b>extern</b> <em>int</em> pid_max;</td></tr>
<tr><th id="294">294</th><td><em>static</em> <b>struct</b> ctl_table pid_ns_ctl_table[] = {</td></tr>
<tr><th id="295">295</th><td>	{</td></tr>
<tr><th id="296">296</th><td>		.procname = <q>"ns_last_pid"</q>,</td></tr>
<tr><th id="297">297</th><td>		.maxlen = <b>sizeof</b>(<em>int</em>),</td></tr>
<tr><th id="298">298</th><td>		.mode = <var>0666</var>, <i>/* permissions are checked in the handler */</i></td></tr>
<tr><th id="299">299</th><td>		.proc_handler = pid_ns_ctl_handler,</td></tr>
<tr><th id="300">300</th><td>		.extra1 = SYSCTL_ZERO,</td></tr>
<tr><th id="301">301</th><td>		.extra2 = &amp;pid_max,</td></tr>
<tr><th id="302">302</th><td>	},</td></tr>
<tr><th id="303">303</th><td>	{ }</td></tr>
<tr><th id="304">304</th><td>};</td></tr>
<tr><th id="305">305</th><td><em>static</em> <b>struct</b> ctl_path kern_path[] = { { .procname = <q>"kernel"</q>, }, { } };</td></tr>
<tr><th id="306">306</th><td><u>#<span data-ppcond="266">endif</span>	/* CONFIG_CHECKPOINT_RESTORE */</u></td></tr>
<tr><th id="307">307</th><td></td></tr>
<tr><th id="308">308</th><td><em>int</em> <dfn class="decl def fn" id="reboot_pid_ns" title='reboot_pid_ns' data-ref="reboot_pid_ns" data-ref-filename="reboot_pid_ns">reboot_pid_ns</dfn>(<b>struct</b> <a class="type" href="../include/linux/pid_namespace.h.html#pid_namespace" title='pid_namespace' data-ref="pid_namespace" data-ref-filename="pid_namespace">pid_namespace</a> *<dfn class="local col6 decl" id="36pid_ns" title='pid_ns' data-type='struct pid_namespace *' data-ref="36pid_ns" data-ref-filename="36pid_ns">pid_ns</dfn>, <em>int</em> <dfn class="local col7 decl" id="37cmd" title='cmd' data-type='int' data-ref="37cmd" data-ref-filename="37cmd">cmd</dfn>)</td></tr>
<tr><th id="309">309</th><td>{</td></tr>
<tr><th id="310">310</th><td>	<b>if</b> (<a class="local col6 ref" href="#36pid_ns" title='pid_ns' data-ref="36pid_ns" data-ref-filename="36pid_ns">pid_ns</a> == &amp;<a class="ref" href="../include/linux/pid.h.html#init_pid_ns" title='init_pid_ns' data-ref="init_pid_ns" data-ref-filename="init_pid_ns">init_pid_ns</a>)</td></tr>
<tr><th id="311">311</th><td>		<b>return</b> <var>0</var>;</td></tr>
<tr><th id="312">312</th><td></td></tr>
<tr><th id="313">313</th><td>	<b>switch</b> (<a class="local col7 ref" href="#37cmd" title='cmd' data-ref="37cmd" data-ref-filename="37cmd">cmd</a>) {</td></tr>
<tr><th id="314">314</th><td>	<b>case</b> <a class="macro" href="../include/uapi/linux/reboot.h.html#34" title="0xA1B2C3D4" data-ref="_M/LINUX_REBOOT_CMD_RESTART2">LINUX_REBOOT_CMD_RESTART2</a>:</td></tr>
<tr><th id="315">315</th><td>	<b>case</b> <a class="macro" href="../include/uapi/linux/reboot.h.html#29" title="0x01234567" data-ref="_M/LINUX_REBOOT_CMD_RESTART">LINUX_REBOOT_CMD_RESTART</a>:</td></tr>
<tr><th id="316">316</th><td>		<a class="local col6 ref" href="#36pid_ns" title='pid_ns' data-ref="36pid_ns" data-ref-filename="36pid_ns">pid_ns</a>-&gt;<a class="ref field" href="../include/linux/pid_namespace.h.html#pid_namespace::reboot" title='pid_namespace::reboot' data-ref="pid_namespace::reboot" data-ref-filename="pid_namespace..reboot">reboot</a> = <a class="macro" href="../arch/x86/include/uapi/asm/signal.h.html#23" title="1" data-ref="_M/SIGHUP">SIGHUP</a>;</td></tr>
<tr><th id="317">317</th><td>		<b>break</b>;</td></tr>
<tr><th id="318">318</th><td></td></tr>
<tr><th id="319">319</th><td>	<b>case</b> <a class="macro" href="../include/uapi/linux/reboot.h.html#33" title="0x4321FEDC" data-ref="_M/LINUX_REBOOT_CMD_POWER_OFF">LINUX_REBOOT_CMD_POWER_OFF</a>:</td></tr>
<tr><th id="320">320</th><td>	<b>case</b> <a class="macro" href="../include/uapi/linux/reboot.h.html#30" title="0xCDEF0123" data-ref="_M/LINUX_REBOOT_CMD_HALT">LINUX_REBOOT_CMD_HALT</a>:</td></tr>
<tr><th id="321">321</th><td>		<a class="local col6 ref" href="#36pid_ns" title='pid_ns' data-ref="36pid_ns" data-ref-filename="36pid_ns">pid_ns</a>-&gt;<a class="ref field" href="../include/linux/pid_namespace.h.html#pid_namespace::reboot" title='pid_namespace::reboot' data-ref="pid_namespace::reboot" data-ref-filename="pid_namespace..reboot">reboot</a> = <a class="macro" href="../arch/x86/include/uapi/asm/signal.h.html#24" title="2" data-ref="_M/SIGINT">SIGINT</a>;</td></tr>
<tr><th id="322">322</th><td>		<b>break</b>;</td></tr>
<tr><th id="323">323</th><td>	<b>default</b>:</td></tr>
<tr><th id="324">324</th><td>		<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="325">325</th><td>	}</td></tr>
<tr><th id="326">326</th><td></td></tr>
<tr><th id="327">327</th><td>	<a class="macro" href="../include/linux/rwlock.h.html#71" title="_raw_read_lock(&amp;tasklist_lock)" data-ref="_M/read_lock">read_lock</a>(&amp;<a class="ref" href="../include/linux/sched/task.h.html#tasklist_lock" title='tasklist_lock' data-ref="tasklist_lock" data-ref-filename="tasklist_lock">tasklist_lock</a>);</td></tr>
<tr><th id="328">328</th><td>	<a class="ref fn" href="../include/linux/sched/signal.h.html#send_sig" title='send_sig' data-ref="send_sig" data-ref-filename="send_sig">send_sig</a>(<a class="macro" href="../arch/x86/include/uapi/asm/signal.h.html#32" title="9" data-ref="_M/SIGKILL">SIGKILL</a>, <a class="local col6 ref" href="#36pid_ns" title='pid_ns' data-ref="36pid_ns" data-ref-filename="36pid_ns">pid_ns</a>-&gt;<a class="ref field" href="../include/linux/pid_namespace.h.html#pid_namespace::child_reaper" title='pid_namespace::child_reaper' data-ref="pid_namespace::child_reaper" data-ref-filename="pid_namespace..child_reaper">child_reaper</a>, <var>1</var>);</td></tr>
<tr><th id="329">329</th><td>	<a class="macro" href="../include/linux/rwlock.h.html#105" title="__raw_read_unlock(&amp;tasklist_lock)" data-ref="_M/read_unlock">read_unlock</a>(&amp;<a class="ref" href="../include/linux/sched/task.h.html#tasklist_lock" title='tasklist_lock' data-ref="tasklist_lock" data-ref-filename="tasklist_lock">tasklist_lock</a>);</td></tr>
<tr><th id="330">330</th><td></td></tr>
<tr><th id="331">331</th><td>	<a class="ref fn" href="../include/linux/kernel.h.html#do_exit" title='do_exit' data-ref="do_exit" data-ref-filename="do_exit">do_exit</a>(<var>0</var>);</td></tr>
<tr><th id="332">332</th><td></td></tr>
<tr><th id="333">333</th><td>	<i>/* Not reached */</i></td></tr>
<tr><th id="334">334</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="335">335</th><td>}</td></tr>
<tr><th id="336">336</th><td></td></tr>
<tr><th id="337">337</th><td><em>static</em> <a class="macro" href="../include/linux/compiler_types.h.html#149" title="inline __attribute__((__gnu_inline__)) __attribute__((__unused__)) __attribute__((no_instrument_function))" data-ref="_M/inline"><b>inline</b></a> <b>struct</b> <a class="type" href="../include/linux/pid_namespace.h.html#pid_namespace" title='pid_namespace' data-ref="pid_namespace" data-ref-filename="pid_namespace">pid_namespace</a> *<dfn class="tu decl def fn" id="to_pid_ns" title='to_pid_ns' data-type='struct pid_namespace * to_pid_ns(struct ns_common * ns)' data-ref="to_pid_ns" data-ref-filename="to_pid_ns">to_pid_ns</dfn>(<b>struct</b> <a class="type" href="../include/linux/ns_common.h.html#ns_common" title='ns_common' data-ref="ns_common" data-ref-filename="ns_common">ns_common</a> *<dfn class="local col8 decl" id="38ns" title='ns' data-type='struct ns_common *' data-ref="38ns" data-ref-filename="38ns">ns</dfn>)</td></tr>
<tr><th id="338">338</th><td>{</td></tr>
<tr><th id="339">339</th><td>	<b>return</b> <a class="macro" href="../include/linux/kernel.h.html#971" title="({ void *__mptr = (void *)(ns); do { extern void __compiletime_assert_339(void) ; if (!(!(!__builtin_types_compatible_p(typeof(*(ns)), typeof(((struct pid_namespace *)0)-&gt;ns)) &amp;&amp; !__builtin_types_compatible_p(typeof(*(ns)), typeof(void))))) __compiletime_assert_339(); } while (0); ((struct pid_namespace *)(__mptr - __builtin_offsetof(struct pid_namespace, ns))); })" data-ref="_M/container_of">container_of</a>(<a class="local col8 ref" href="#38ns" title='ns' data-ref="38ns" data-ref-filename="38ns">ns</a>, <b>struct</b> <a class="type" href="../include/linux/pid_namespace.h.html#pid_namespace" title='pid_namespace' data-ref="pid_namespace" data-ref-filename="pid_namespace">pid_namespace</a>, <a class="ref field" href="../include/linux/pid_namespace.h.html#pid_namespace::ns" title='pid_namespace::ns' data-ref="pid_namespace::ns" data-ref-filename="pid_namespace..ns">ns</a>);</td></tr>
<tr><th id="340">340</th><td>}</td></tr>
<tr><th id="341">341</th><td></td></tr>
<tr><th id="342">342</th><td><em>static</em> <b>struct</b> <a class="type" href="../include/linux/ns_common.h.html#ns_common" title='ns_common' data-ref="ns_common" data-ref-filename="ns_common">ns_common</a> *<dfn class="tu decl def fn" id="pidns_get" title='pidns_get' data-type='struct ns_common * pidns_get(struct task_struct * task)' data-ref="pidns_get" data-ref-filename="pidns_get">pidns_get</dfn>(<b>struct</b> <a class="type" href="../include/linux/sched.h.html#task_struct" title='task_struct' data-ref="task_struct" data-ref-filename="task_struct">task_struct</a> *<dfn class="local col9 decl" id="39task" title='task' data-type='struct task_struct *' data-ref="39task" data-ref-filename="39task">task</dfn>)</td></tr>
<tr><th id="343">343</th><td>{</td></tr>
<tr><th id="344">344</th><td>	<b>struct</b> <a class="type" href="../include/linux/pid_namespace.h.html#pid_namespace" title='pid_namespace' data-ref="pid_namespace" data-ref-filename="pid_namespace">pid_namespace</a> *<dfn class="local col0 decl" id="40ns" title='ns' data-type='struct pid_namespace *' data-ref="40ns" data-ref-filename="40ns">ns</dfn>;</td></tr>
<tr><th id="345">345</th><td></td></tr>
<tr><th id="346">346</th><td>	<a class="ref fn" href="../include/linux/rcupdate.h.html#rcu_read_lock" title='rcu_read_lock' data-ref="rcu_read_lock" data-ref-filename="rcu_read_lock">rcu_read_lock</a>();</td></tr>
<tr><th id="347">347</th><td>	<a class="local col0 ref" href="#40ns" title='ns' data-ref="40ns" data-ref-filename="40ns">ns</a> = <a class="ref fn" href="../include/linux/pid_namespace.h.html#task_active_pid_ns" title='task_active_pid_ns' data-ref="task_active_pid_ns" data-ref-filename="task_active_pid_ns">task_active_pid_ns</a>(<a class="local col9 ref" href="#39task" title='task' data-ref="39task" data-ref-filename="39task">task</a>);</td></tr>
<tr><th id="348">348</th><td>	<b>if</b> (<a class="local col0 ref" href="#40ns" title='ns' data-ref="40ns" data-ref-filename="40ns">ns</a>)</td></tr>
<tr><th id="349">349</th><td>		<a class="ref fn" href="../include/linux/pid_namespace.h.html#get_pid_ns" title='get_pid_ns' data-ref="get_pid_ns" data-ref-filename="get_pid_ns">get_pid_ns</a>(<a class="local col0 ref" href="#40ns" title='ns' data-ref="40ns" data-ref-filename="40ns">ns</a>);</td></tr>
<tr><th id="350">350</th><td>	<a class="ref fn" href="../include/linux/rcupdate.h.html#rcu_read_unlock" title='rcu_read_unlock' data-ref="rcu_read_unlock" data-ref-filename="rcu_read_unlock">rcu_read_unlock</a>();</td></tr>
<tr><th id="351">351</th><td></td></tr>
<tr><th id="352">352</th><td>	<b>return</b> <a class="local col0 ref" href="#40ns" title='ns' data-ref="40ns" data-ref-filename="40ns">ns</a> ? &amp;<a class="local col0 ref" href="#40ns" title='ns' data-ref="40ns" data-ref-filename="40ns">ns</a>-&gt;<a class="ref field" href="../include/linux/pid_namespace.h.html#pid_namespace::ns" title='pid_namespace::ns' data-ref="pid_namespace::ns" data-ref-filename="pid_namespace..ns">ns</a> : <a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="353">353</th><td>}</td></tr>
<tr><th id="354">354</th><td></td></tr>
<tr><th id="355">355</th><td><em>static</em> <b>struct</b> <a class="type" href="../include/linux/ns_common.h.html#ns_common" title='ns_common' data-ref="ns_common" data-ref-filename="ns_common">ns_common</a> *<dfn class="tu decl def fn" id="pidns_for_children_get" title='pidns_for_children_get' data-type='struct ns_common * pidns_for_children_get(struct task_struct * task)' data-ref="pidns_for_children_get" data-ref-filename="pidns_for_children_get">pidns_for_children_get</dfn>(<b>struct</b> <a class="type" href="../include/linux/sched.h.html#task_struct" title='task_struct' data-ref="task_struct" data-ref-filename="task_struct">task_struct</a> *<dfn class="local col1 decl" id="41task" title='task' data-type='struct task_struct *' data-ref="41task" data-ref-filename="41task">task</dfn>)</td></tr>
<tr><th id="356">356</th><td>{</td></tr>
<tr><th id="357">357</th><td>	<b>struct</b> <a class="type" href="../include/linux/pid_namespace.h.html#pid_namespace" title='pid_namespace' data-ref="pid_namespace" data-ref-filename="pid_namespace">pid_namespace</a> *<dfn class="local col2 decl" id="42ns" title='ns' data-type='struct pid_namespace *' data-ref="42ns" data-ref-filename="42ns">ns</dfn> = <a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="358">358</th><td></td></tr>
<tr><th id="359">359</th><td>	<a class="ref fn" href="../include/linux/sched/task.h.html#task_lock" title='task_lock' data-ref="task_lock" data-ref-filename="task_lock">task_lock</a>(<a class="local col1 ref" href="#41task" title='task' data-ref="41task" data-ref-filename="41task">task</a>);</td></tr>
<tr><th id="360">360</th><td>	<b>if</b> (<a class="local col1 ref" href="#41task" title='task' data-ref="41task" data-ref-filename="41task">task</a>-&gt;<a class="ref field" href="../include/linux/sched.h.html#task_struct::nsproxy" title='task_struct::nsproxy' data-ref="task_struct::nsproxy" data-ref-filename="task_struct..nsproxy">nsproxy</a>) {</td></tr>
<tr><th id="361">361</th><td>		<a class="local col2 ref" href="#42ns" title='ns' data-ref="42ns" data-ref-filename="42ns">ns</a> = <a class="local col1 ref" href="#41task" title='task' data-ref="41task" data-ref-filename="41task">task</a>-&gt;<a class="ref field" href="../include/linux/sched.h.html#task_struct::nsproxy" title='task_struct::nsproxy' data-ref="task_struct::nsproxy" data-ref-filename="task_struct..nsproxy">nsproxy</a>-&gt;<a class="ref field" href="../include/linux/nsproxy.h.html#nsproxy::pid_ns_for_children" title='nsproxy::pid_ns_for_children' data-ref="nsproxy::pid_ns_for_children" data-ref-filename="nsproxy..pid_ns_for_children">pid_ns_for_children</a>;</td></tr>
<tr><th id="362">362</th><td>		<a class="ref fn" href="../include/linux/pid_namespace.h.html#get_pid_ns" title='get_pid_ns' data-ref="get_pid_ns" data-ref-filename="get_pid_ns">get_pid_ns</a>(<a class="local col2 ref" href="#42ns" title='ns' data-ref="42ns" data-ref-filename="42ns">ns</a>);</td></tr>
<tr><th id="363">363</th><td>	}</td></tr>
<tr><th id="364">364</th><td>	<a class="ref fn" href="../include/linux/sched/task.h.html#task_unlock" title='task_unlock' data-ref="task_unlock" data-ref-filename="task_unlock">task_unlock</a>(<a class="local col1 ref" href="#41task" title='task' data-ref="41task" data-ref-filename="41task">task</a>);</td></tr>
<tr><th id="365">365</th><td></td></tr>
<tr><th id="366">366</th><td>	<b>if</b> (<a class="local col2 ref" href="#42ns" title='ns' data-ref="42ns" data-ref-filename="42ns">ns</a>) {</td></tr>
<tr><th id="367">367</th><td>		<a class="macro" href="../include/linux/rwlock.h.html#71" title="_raw_read_lock(&amp;tasklist_lock)" data-ref="_M/read_lock">read_lock</a>(&amp;<a class="ref" href="../include/linux/sched/task.h.html#tasklist_lock" title='tasklist_lock' data-ref="tasklist_lock" data-ref-filename="tasklist_lock">tasklist_lock</a>);</td></tr>
<tr><th id="368">368</th><td>		<b>if</b> (!<a class="local col2 ref" href="#42ns" title='ns' data-ref="42ns" data-ref-filename="42ns">ns</a>-&gt;<a class="ref field" href="../include/linux/pid_namespace.h.html#pid_namespace::child_reaper" title='pid_namespace::child_reaper' data-ref="pid_namespace::child_reaper" data-ref-filename="pid_namespace..child_reaper">child_reaper</a>) {</td></tr>
<tr><th id="369">369</th><td>			<a class="ref fn" href="#put_pid_ns" title='put_pid_ns' data-ref="put_pid_ns" data-ref-filename="put_pid_ns">put_pid_ns</a>(<a class="local col2 ref" href="#42ns" title='ns' data-ref="42ns" data-ref-filename="42ns">ns</a>);</td></tr>
<tr><th id="370">370</th><td>			<a class="local col2 ref" href="#42ns" title='ns' data-ref="42ns" data-ref-filename="42ns">ns</a> = <a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="371">371</th><td>		}</td></tr>
<tr><th id="372">372</th><td>		<a class="macro" href="../include/linux/rwlock.h.html#105" title="__raw_read_unlock(&amp;tasklist_lock)" data-ref="_M/read_unlock">read_unlock</a>(&amp;<a class="ref" href="../include/linux/sched/task.h.html#tasklist_lock" title='tasklist_lock' data-ref="tasklist_lock" data-ref-filename="tasklist_lock">tasklist_lock</a>);</td></tr>
<tr><th id="373">373</th><td>	}</td></tr>
<tr><th id="374">374</th><td></td></tr>
<tr><th id="375">375</th><td>	<b>return</b> <a class="local col2 ref" href="#42ns" title='ns' data-ref="42ns" data-ref-filename="42ns">ns</a> ? &amp;<a class="local col2 ref" href="#42ns" title='ns' data-ref="42ns" data-ref-filename="42ns">ns</a>-&gt;<a class="ref field" href="../include/linux/pid_namespace.h.html#pid_namespace::ns" title='pid_namespace::ns' data-ref="pid_namespace::ns" data-ref-filename="pid_namespace..ns">ns</a> : <a class="macro" href="../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="376">376</th><td>}</td></tr>
<tr><th id="377">377</th><td></td></tr>
<tr><th id="378">378</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="pidns_put" title='pidns_put' data-type='void pidns_put(struct ns_common * ns)' data-ref="pidns_put" data-ref-filename="pidns_put">pidns_put</dfn>(<b>struct</b> <a class="type" href="../include/linux/ns_common.h.html#ns_common" title='ns_common' data-ref="ns_common" data-ref-filename="ns_common">ns_common</a> *<dfn class="local col3 decl" id="43ns" title='ns' data-type='struct ns_common *' data-ref="43ns" data-ref-filename="43ns">ns</dfn>)</td></tr>
<tr><th id="379">379</th><td>{</td></tr>
<tr><th id="380">380</th><td>	<a class="ref fn" href="#put_pid_ns" title='put_pid_ns' data-ref="put_pid_ns" data-ref-filename="put_pid_ns">put_pid_ns</a>(<a class="tu ref fn" href="#to_pid_ns" title='to_pid_ns' data-use='c' data-ref="to_pid_ns" data-ref-filename="to_pid_ns">to_pid_ns</a>(<a class="local col3 ref" href="#43ns" title='ns' data-ref="43ns" data-ref-filename="43ns">ns</a>));</td></tr>
<tr><th id="381">381</th><td>}</td></tr>
<tr><th id="382">382</th><td></td></tr>
<tr><th id="383">383</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="pidns_install" title='pidns_install' data-type='int pidns_install(struct nsproxy * nsproxy, struct ns_common * ns)' data-ref="pidns_install" data-ref-filename="pidns_install">pidns_install</dfn>(<b>struct</b> <a class="type" href="../include/linux/nsproxy.h.html#nsproxy" title='nsproxy' data-ref="nsproxy" data-ref-filename="nsproxy">nsproxy</a> *<dfn class="local col4 decl" id="44nsproxy" title='nsproxy' data-type='struct nsproxy *' data-ref="44nsproxy" data-ref-filename="44nsproxy">nsproxy</dfn>, <b>struct</b> <a class="type" href="../include/linux/ns_common.h.html#ns_common" title='ns_common' data-ref="ns_common" data-ref-filename="ns_common">ns_common</a> *<dfn class="local col5 decl" id="45ns" title='ns' data-type='struct ns_common *' data-ref="45ns" data-ref-filename="45ns">ns</dfn>)</td></tr>
<tr><th id="384">384</th><td>{</td></tr>
<tr><th id="385">385</th><td>	<b>struct</b> <a class="type" href="../include/linux/pid_namespace.h.html#pid_namespace" title='pid_namespace' data-ref="pid_namespace" data-ref-filename="pid_namespace">pid_namespace</a> *<dfn class="local col6 decl" id="46active" title='active' data-type='struct pid_namespace *' data-ref="46active" data-ref-filename="46active">active</dfn> = <a class="ref fn" href="../include/linux/pid_namespace.h.html#task_active_pid_ns" title='task_active_pid_ns' data-ref="task_active_pid_ns" data-ref-filename="task_active_pid_ns">task_active_pid_ns</a>(<a class="macro" href="../arch/x86/include/asm/current.h.html#18" title="get_current()" data-ref="_M/current">current</a>);</td></tr>
<tr><th id="386">386</th><td>	<b>struct</b> <a class="type" href="../include/linux/pid_namespace.h.html#pid_namespace" title='pid_namespace' data-ref="pid_namespace" data-ref-filename="pid_namespace">pid_namespace</a> *<dfn class="local col7 decl" id="47ancestor" title='ancestor' data-type='struct pid_namespace *' data-ref="47ancestor" data-ref-filename="47ancestor">ancestor</dfn>, *<dfn class="local col8 decl" id="48new" title='new' data-type='struct pid_namespace *' data-ref="48new" data-ref-filename="48new">new</dfn> = <a class="tu ref fn" href="#to_pid_ns" title='to_pid_ns' data-use='c' data-ref="to_pid_ns" data-ref-filename="to_pid_ns">to_pid_ns</a>(<a class="local col5 ref" href="#45ns" title='ns' data-ref="45ns" data-ref-filename="45ns">ns</a>);</td></tr>
<tr><th id="387">387</th><td></td></tr>
<tr><th id="388">388</th><td>	<b>if</b> (!<a class="ref fn" href="../include/linux/capability.h.html#ns_capable" title='ns_capable' data-ref="ns_capable" data-ref-filename="ns_capable">ns_capable</a>(<a class="local col8 ref" href="#48new" title='new' data-ref="48new" data-ref-filename="48new">new</a>-&gt;<a class="ref field" href="../include/linux/pid_namespace.h.html#pid_namespace::user_ns" title='pid_namespace::user_ns' data-ref="pid_namespace::user_ns" data-ref-filename="pid_namespace..user_ns">user_ns</a>, <a class="macro" href="../include/uapi/linux/capability.h.html#278" title="21" data-ref="_M/CAP_SYS_ADMIN">CAP_SYS_ADMIN</a>) ||</td></tr>
<tr><th id="389">389</th><td>	    !<a class="ref fn" href="../include/linux/capability.h.html#ns_capable" title='ns_capable' data-ref="ns_capable" data-ref-filename="ns_capable">ns_capable</a>(<a class="ref fn" href="../include/linux/cred.h.html#current_user_ns" title='current_user_ns' data-ref="current_user_ns" data-ref-filename="current_user_ns">current_user_ns</a>(), <a class="macro" href="../include/uapi/linux/capability.h.html#278" title="21" data-ref="_M/CAP_SYS_ADMIN">CAP_SYS_ADMIN</a>))</td></tr>
<tr><th id="390">390</th><td>		<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#5" title="1" data-ref="_M/EPERM">EPERM</a>;</td></tr>
<tr><th id="391">391</th><td></td></tr>
<tr><th id="392">392</th><td>	<i>/*</i></td></tr>
<tr><th id="393">393</th><td><i>	 * Only allow entering the current active pid namespace</i></td></tr>
<tr><th id="394">394</th><td><i>	 * or a child of the current active pid namespace.</i></td></tr>
<tr><th id="395">395</th><td><i>	 *</i></td></tr>
<tr><th id="396">396</th><td><i>	 * This is required for fork to return a usable pid value and</i></td></tr>
<tr><th id="397">397</th><td><i>	 * this maintains the property that processes and their</i></td></tr>
<tr><th id="398">398</th><td><i>	 * children can not escape their current pid namespace.</i></td></tr>
<tr><th id="399">399</th><td><i>	 */</i></td></tr>
<tr><th id="400">400</th><td>	<b>if</b> (<a class="local col8 ref" href="#48new" title='new' data-ref="48new" data-ref-filename="48new">new</a>-&gt;<a class="ref field" href="../include/linux/pid_namespace.h.html#pid_namespace::level" title='pid_namespace::level' data-ref="pid_namespace::level" data-ref-filename="pid_namespace..level">level</a> &lt; <a class="local col6 ref" href="#46active" title='active' data-ref="46active" data-ref-filename="46active">active</a>-&gt;<a class="ref field" href="../include/linux/pid_namespace.h.html#pid_namespace::level" title='pid_namespace::level' data-ref="pid_namespace::level" data-ref-filename="pid_namespace..level">level</a>)</td></tr>
<tr><th id="401">401</th><td>		<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="402">402</th><td></td></tr>
<tr><th id="403">403</th><td>	<a class="local col7 ref" href="#47ancestor" title='ancestor' data-ref="47ancestor" data-ref-filename="47ancestor">ancestor</a> = <a class="local col8 ref" href="#48new" title='new' data-ref="48new" data-ref-filename="48new">new</a>;</td></tr>
<tr><th id="404">404</th><td>	<b>while</b> (<a class="local col7 ref" href="#47ancestor" title='ancestor' data-ref="47ancestor" data-ref-filename="47ancestor">ancestor</a>-&gt;<a class="ref field" href="../include/linux/pid_namespace.h.html#pid_namespace::level" title='pid_namespace::level' data-ref="pid_namespace::level" data-ref-filename="pid_namespace..level">level</a> &gt; <a class="local col6 ref" href="#46active" title='active' data-ref="46active" data-ref-filename="46active">active</a>-&gt;<a class="ref field" href="../include/linux/pid_namespace.h.html#pid_namespace::level" title='pid_namespace::level' data-ref="pid_namespace::level" data-ref-filename="pid_namespace..level">level</a>)</td></tr>
<tr><th id="405">405</th><td>		<a class="local col7 ref" href="#47ancestor" title='ancestor' data-ref="47ancestor" data-ref-filename="47ancestor">ancestor</a> = <a class="local col7 ref" href="#47ancestor" title='ancestor' data-ref="47ancestor" data-ref-filename="47ancestor">ancestor</a>-&gt;<a class="ref field" href="../include/linux/pid_namespace.h.html#pid_namespace::parent" title='pid_namespace::parent' data-ref="pid_namespace::parent" data-ref-filename="pid_namespace..parent">parent</a>;</td></tr>
<tr><th id="406">406</th><td>	<b>if</b> (<a class="local col7 ref" href="#47ancestor" title='ancestor' data-ref="47ancestor" data-ref-filename="47ancestor">ancestor</a> != <a class="local col6 ref" href="#46active" title='active' data-ref="46active" data-ref-filename="46active">active</a>)</td></tr>
<tr><th id="407">407</th><td>		<b>return</b> -<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#26" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="408">408</th><td></td></tr>
<tr><th id="409">409</th><td>	<a class="ref fn" href="#put_pid_ns" title='put_pid_ns' data-ref="put_pid_ns" data-ref-filename="put_pid_ns">put_pid_ns</a>(<a class="local col4 ref" href="#44nsproxy" title='nsproxy' data-ref="44nsproxy" data-ref-filename="44nsproxy">nsproxy</a>-&gt;<a class="ref field" href="../include/linux/nsproxy.h.html#nsproxy::pid_ns_for_children" title='nsproxy::pid_ns_for_children' data-ref="nsproxy::pid_ns_for_children" data-ref-filename="nsproxy..pid_ns_for_children">pid_ns_for_children</a>);</td></tr>
<tr><th id="410">410</th><td>	<a class="local col4 ref" href="#44nsproxy" title='nsproxy' data-ref="44nsproxy" data-ref-filename="44nsproxy">nsproxy</a>-&gt;<a class="ref field" href="../include/linux/nsproxy.h.html#nsproxy::pid_ns_for_children" title='nsproxy::pid_ns_for_children' data-ref="nsproxy::pid_ns_for_children" data-ref-filename="nsproxy..pid_ns_for_children">pid_ns_for_children</a> = <a class="ref fn" href="../include/linux/pid_namespace.h.html#get_pid_ns" title='get_pid_ns' data-ref="get_pid_ns" data-ref-filename="get_pid_ns">get_pid_ns</a>(<a class="local col8 ref" href="#48new" title='new' data-ref="48new" data-ref-filename="48new">new</a>);</td></tr>
<tr><th id="411">411</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="412">412</th><td>}</td></tr>
<tr><th id="413">413</th><td></td></tr>
<tr><th id="414">414</th><td><em>static</em> <b>struct</b> <a class="type" href="../include/linux/ns_common.h.html#ns_common" title='ns_common' data-ref="ns_common" data-ref-filename="ns_common">ns_common</a> *<dfn class="tu decl def fn" id="pidns_get_parent" title='pidns_get_parent' data-type='struct ns_common * pidns_get_parent(struct ns_common * ns)' data-ref="pidns_get_parent" data-ref-filename="pidns_get_parent">pidns_get_parent</dfn>(<b>struct</b> <a class="type" href="../include/linux/ns_common.h.html#ns_common" title='ns_common' data-ref="ns_common" data-ref-filename="ns_common">ns_common</a> *<dfn class="local col9 decl" id="49ns" title='ns' data-type='struct ns_common *' data-ref="49ns" data-ref-filename="49ns">ns</dfn>)</td></tr>
<tr><th id="415">415</th><td>{</td></tr>
<tr><th id="416">416</th><td>	<b>struct</b> <a class="type" href="../include/linux/pid_namespace.h.html#pid_namespace" title='pid_namespace' data-ref="pid_namespace" data-ref-filename="pid_namespace">pid_namespace</a> *<dfn class="local col0 decl" id="50active" title='active' data-type='struct pid_namespace *' data-ref="50active" data-ref-filename="50active">active</dfn> = <a class="ref fn" href="../include/linux/pid_namespace.h.html#task_active_pid_ns" title='task_active_pid_ns' data-ref="task_active_pid_ns" data-ref-filename="task_active_pid_ns">task_active_pid_ns</a>(<a class="macro" href="../arch/x86/include/asm/current.h.html#18" title="get_current()" data-ref="_M/current">current</a>);</td></tr>
<tr><th id="417">417</th><td>	<b>struct</b> <a class="type" href="../include/linux/pid_namespace.h.html#pid_namespace" title='pid_namespace' data-ref="pid_namespace" data-ref-filename="pid_namespace">pid_namespace</a> *<dfn class="local col1 decl" id="51pid_ns" title='pid_ns' data-type='struct pid_namespace *' data-ref="51pid_ns" data-ref-filename="51pid_ns">pid_ns</dfn>, *<dfn class="local col2 decl" id="52p" title='p' data-type='struct pid_namespace *' data-ref="52p" data-ref-filename="52p">p</dfn>;</td></tr>
<tr><th id="418">418</th><td></td></tr>
<tr><th id="419">419</th><td>	<i>/* See if the parent is in the current namespace */</i></td></tr>
<tr><th id="420">420</th><td>	<a class="local col1 ref" href="#51pid_ns" title='pid_ns' data-ref="51pid_ns" data-ref-filename="51pid_ns">pid_ns</a> = <a class="local col2 ref" href="#52p" title='p' data-ref="52p" data-ref-filename="52p">p</a> = <a class="tu ref fn" href="#to_pid_ns" title='to_pid_ns' data-use='c' data-ref="to_pid_ns" data-ref-filename="to_pid_ns">to_pid_ns</a>(<a class="local col9 ref" href="#49ns" title='ns' data-ref="49ns" data-ref-filename="49ns">ns</a>)-&gt;<a class="ref field" href="../include/linux/pid_namespace.h.html#pid_namespace::parent" title='pid_namespace::parent' data-ref="pid_namespace::parent" data-ref-filename="pid_namespace..parent">parent</a>;</td></tr>
<tr><th id="421">421</th><td>	<b>for</b> (;;) {</td></tr>
<tr><th id="422">422</th><td>		<b>if</b> (!<a class="local col2 ref" href="#52p" title='p' data-ref="52p" data-ref-filename="52p">p</a>)</td></tr>
<tr><th id="423">423</th><td>			<b>return</b> <a class="ref fn" href="../include/linux/err.h.html#ERR_PTR" title='ERR_PTR' data-ref="ERR_PTR" data-ref-filename="ERR_PTR">ERR_PTR</a>(-<a class="macro" href="../include/uapi/asm-generic/errno-base.h.html#5" title="1" data-ref="_M/EPERM">EPERM</a>);</td></tr>
<tr><th id="424">424</th><td>		<b>if</b> (<a class="local col2 ref" href="#52p" title='p' data-ref="52p" data-ref-filename="52p">p</a> == <a class="local col0 ref" href="#50active" title='active' data-ref="50active" data-ref-filename="50active">active</a>)</td></tr>
<tr><th id="425">425</th><td>			<b>break</b>;</td></tr>
<tr><th id="426">426</th><td>		<a class="local col2 ref" href="#52p" title='p' data-ref="52p" data-ref-filename="52p">p</a> = <a class="local col2 ref" href="#52p" title='p' data-ref="52p" data-ref-filename="52p">p</a>-&gt;<a class="ref field" href="../include/linux/pid_namespace.h.html#pid_namespace::parent" title='pid_namespace::parent' data-ref="pid_namespace::parent" data-ref-filename="pid_namespace..parent">parent</a>;</td></tr>
<tr><th id="427">427</th><td>	}</td></tr>
<tr><th id="428">428</th><td></td></tr>
<tr><th id="429">429</th><td>	<b>return</b> &amp;<a class="ref fn" href="../include/linux/pid_namespace.h.html#get_pid_ns" title='get_pid_ns' data-ref="get_pid_ns" data-ref-filename="get_pid_ns">get_pid_ns</a>(<a class="local col1 ref" href="#51pid_ns" title='pid_ns' data-ref="51pid_ns" data-ref-filename="51pid_ns">pid_ns</a>)-&gt;<a class="ref field" href="../include/linux/pid_namespace.h.html#pid_namespace::ns" title='pid_namespace::ns' data-ref="pid_namespace::ns" data-ref-filename="pid_namespace..ns">ns</a>;</td></tr>
<tr><th id="430">430</th><td>}</td></tr>
<tr><th id="431">431</th><td></td></tr>
<tr><th id="432">432</th><td><em>static</em> <b>struct</b> <a class="type" href="../include/linux/user_namespace.h.html#user_namespace" title='user_namespace' data-ref="user_namespace" data-ref-filename="user_namespace">user_namespace</a> *<dfn class="tu decl def fn" id="pidns_owner" title='pidns_owner' data-type='struct user_namespace * pidns_owner(struct ns_common * ns)' data-ref="pidns_owner" data-ref-filename="pidns_owner">pidns_owner</dfn>(<b>struct</b> <a class="type" href="../include/linux/ns_common.h.html#ns_common" title='ns_common' data-ref="ns_common" data-ref-filename="ns_common">ns_common</a> *<dfn class="local col3 decl" id="53ns" title='ns' data-type='struct ns_common *' data-ref="53ns" data-ref-filename="53ns">ns</dfn>)</td></tr>
<tr><th id="433">433</th><td>{</td></tr>
<tr><th id="434">434</th><td>	<b>return</b> <a class="tu ref fn" href="#to_pid_ns" title='to_pid_ns' data-use='c' data-ref="to_pid_ns" data-ref-filename="to_pid_ns">to_pid_ns</a>(<a class="local col3 ref" href="#53ns" title='ns' data-ref="53ns" data-ref-filename="53ns">ns</a>)-&gt;<a class="ref field" href="../include/linux/pid_namespace.h.html#pid_namespace::user_ns" title='pid_namespace::user_ns' data-ref="pid_namespace::user_ns" data-ref-filename="pid_namespace..user_ns">user_ns</a>;</td></tr>
<tr><th id="435">435</th><td>}</td></tr>
<tr><th id="436">436</th><td></td></tr>
<tr><th id="437">437</th><td><em>const</em> <b>struct</b> <a class="type" href="../include/linux/proc_ns.h.html#proc_ns_operations" title='proc_ns_operations' data-ref="proc_ns_operations" data-ref-filename="proc_ns_operations">proc_ns_operations</a> <dfn class="decl def" id="pidns_operations" title='pidns_operations' data-ref="pidns_operations" data-ref-filename="pidns_operations">pidns_operations</dfn> = {</td></tr>
<tr><th id="438">438</th><td>	.<a class="ref field" href="../include/linux/proc_ns.h.html#proc_ns_operations::name" title='proc_ns_operations::name' data-ref="proc_ns_operations::name" data-ref-filename="proc_ns_operations..name">name</a>		= <q>"pid"</q>,</td></tr>
<tr><th id="439">439</th><td>	.<a class="ref field" href="../include/linux/proc_ns.h.html#proc_ns_operations::type" title='proc_ns_operations::type' data-ref="proc_ns_operations::type" data-ref-filename="proc_ns_operations..type">type</a>		= <a class="macro" href="../include/uapi/linux/sched.h.html#32" title="0x20000000" data-ref="_M/CLONE_NEWPID">CLONE_NEWPID</a>,</td></tr>
<tr><th id="440">440</th><td>	.<a class="ref field" href="../include/linux/proc_ns.h.html#proc_ns_operations::get" title='proc_ns_operations::get' data-ref="proc_ns_operations::get" data-ref-filename="proc_ns_operations..get">get</a>		= <a class="tu ref fn" href="#pidns_get" title='pidns_get' data-ref="pidns_get" data-ref-filename="pidns_get">pidns_get</a>,</td></tr>
<tr><th id="441">441</th><td>	.<a class="ref field" href="../include/linux/proc_ns.h.html#proc_ns_operations::put" title='proc_ns_operations::put' data-ref="proc_ns_operations::put" data-ref-filename="proc_ns_operations..put">put</a>		= <a class="tu ref fn" href="#pidns_put" title='pidns_put' data-ref="pidns_put" data-ref-filename="pidns_put">pidns_put</a>,</td></tr>
<tr><th id="442">442</th><td>	.<a class="ref field" href="../include/linux/proc_ns.h.html#proc_ns_operations::install" title='proc_ns_operations::install' data-ref="proc_ns_operations::install" data-ref-filename="proc_ns_operations..install">install</a>	= <a class="tu ref fn" href="#pidns_install" title='pidns_install' data-ref="pidns_install" data-ref-filename="pidns_install">pidns_install</a>,</td></tr>
<tr><th id="443">443</th><td>	.<a class="ref field" href="../include/linux/proc_ns.h.html#proc_ns_operations::owner" title='proc_ns_operations::owner' data-ref="proc_ns_operations::owner" data-ref-filename="proc_ns_operations..owner">owner</a>		= <a class="tu ref fn" href="#pidns_owner" title='pidns_owner' data-ref="pidns_owner" data-ref-filename="pidns_owner">pidns_owner</a>,</td></tr>
<tr><th id="444">444</th><td>	.<a class="ref field" href="../include/linux/proc_ns.h.html#proc_ns_operations::get_parent" title='proc_ns_operations::get_parent' data-ref="proc_ns_operations::get_parent" data-ref-filename="proc_ns_operations..get_parent">get_parent</a>	= <a class="tu ref fn" href="#pidns_get_parent" title='pidns_get_parent' data-ref="pidns_get_parent" data-ref-filename="pidns_get_parent">pidns_get_parent</a>,</td></tr>
<tr><th id="445">445</th><td>};</td></tr>
<tr><th id="446">446</th><td></td></tr>
<tr><th id="447">447</th><td><em>const</em> <b>struct</b> <a class="type" href="../include/linux/proc_ns.h.html#proc_ns_operations" title='proc_ns_operations' data-ref="proc_ns_operations" data-ref-filename="proc_ns_operations">proc_ns_operations</a> <dfn class="decl def" id="pidns_for_children_operations" title='pidns_for_children_operations' data-ref="pidns_for_children_operations" data-ref-filename="pidns_for_children_operations">pidns_for_children_operations</dfn> = {</td></tr>
<tr><th id="448">448</th><td>	.<a class="ref field" href="../include/linux/proc_ns.h.html#proc_ns_operations::name" title='proc_ns_operations::name' data-ref="proc_ns_operations::name" data-ref-filename="proc_ns_operations..name">name</a>		= <q>"pid_for_children"</q>,</td></tr>
<tr><th id="449">449</th><td>	.<a class="ref field" href="../include/linux/proc_ns.h.html#proc_ns_operations::real_ns_name" title='proc_ns_operations::real_ns_name' data-ref="proc_ns_operations::real_ns_name" data-ref-filename="proc_ns_operations..real_ns_name">real_ns_name</a>	= <q>"pid"</q>,</td></tr>
<tr><th id="450">450</th><td>	.<a class="ref field" href="../include/linux/proc_ns.h.html#proc_ns_operations::type" title='proc_ns_operations::type' data-ref="proc_ns_operations::type" data-ref-filename="proc_ns_operations..type">type</a>		= <a class="macro" href="../include/uapi/linux/sched.h.html#32" title="0x20000000" data-ref="_M/CLONE_NEWPID">CLONE_NEWPID</a>,</td></tr>
<tr><th id="451">451</th><td>	.<a class="ref field" href="../include/linux/proc_ns.h.html#proc_ns_operations::get" title='proc_ns_operations::get' data-ref="proc_ns_operations::get" data-ref-filename="proc_ns_operations..get">get</a>		= <a class="tu ref fn" href="#pidns_for_children_get" title='pidns_for_children_get' data-ref="pidns_for_children_get" data-ref-filename="pidns_for_children_get">pidns_for_children_get</a>,</td></tr>
<tr><th id="452">452</th><td>	.<a class="ref field" href="../include/linux/proc_ns.h.html#proc_ns_operations::put" title='proc_ns_operations::put' data-ref="proc_ns_operations::put" data-ref-filename="proc_ns_operations..put">put</a>		= <a class="tu ref fn" href="#pidns_put" title='pidns_put' data-ref="pidns_put" data-ref-filename="pidns_put">pidns_put</a>,</td></tr>
<tr><th id="453">453</th><td>	.<a class="ref field" href="../include/linux/proc_ns.h.html#proc_ns_operations::install" title='proc_ns_operations::install' data-ref="proc_ns_operations::install" data-ref-filename="proc_ns_operations..install">install</a>	= <a class="tu ref fn" href="#pidns_install" title='pidns_install' data-ref="pidns_install" data-ref-filename="pidns_install">pidns_install</a>,</td></tr>
<tr><th id="454">454</th><td>	.<a class="ref field" href="../include/linux/proc_ns.h.html#proc_ns_operations::owner" title='proc_ns_operations::owner' data-ref="proc_ns_operations::owner" data-ref-filename="proc_ns_operations..owner">owner</a>		= <a class="tu ref fn" href="#pidns_owner" title='pidns_owner' data-ref="pidns_owner" data-ref-filename="pidns_owner">pidns_owner</a>,</td></tr>
<tr><th id="455">455</th><td>	.<a class="ref field" href="../include/linux/proc_ns.h.html#proc_ns_operations::get_parent" title='proc_ns_operations::get_parent' data-ref="proc_ns_operations::get_parent" data-ref-filename="proc_ns_operations..get_parent">get_parent</a>	= <a class="tu ref fn" href="#pidns_get_parent" title='pidns_get_parent' data-ref="pidns_get_parent" data-ref-filename="pidns_get_parent">pidns_get_parent</a>,</td></tr>
<tr><th id="456">456</th><td>};</td></tr>
<tr><th id="457">457</th><td></td></tr>
<tr><th id="458">458</th><td><em>static</em> <a class="macro" href="../include/linux/init.h.html#50" title="__attribute__((__section__(&quot;.init.text&quot;))) __attribute__((__cold__))" data-ref="_M/__init">__init</a> <em>int</em> <dfn class="tu decl def fn" id="pid_namespaces_init" title='pid_namespaces_init' data-type='int pid_namespaces_init()' data-ref="pid_namespaces_init" data-ref-filename="pid_namespaces_init">pid_namespaces_init</dfn>(<em>void</em>)</td></tr>
<tr><th id="459">459</th><td>{</td></tr>
<tr><th id="460">460</th><td>	<a class="tu ref" href="#pid_ns_cachep" title='pid_ns_cachep' data-use='w' data-ref="pid_ns_cachep" data-ref-filename="pid_ns_cachep">pid_ns_cachep</a> = <a class="macro" href="../include/linux/slab.h.html#169" title="kmem_cache_create(&quot;pid_namespace&quot;, sizeof(struct pid_namespace), __alignof__(struct pid_namespace), (((slab_flags_t )0x00040000U)), ((void *)0))" data-ref="_M/KMEM_CACHE">KMEM_CACHE</a>(<a class="type" href="../include/linux/pid_namespace.h.html#pid_namespace" title='pid_namespace' data-ref="pid_namespace" data-ref-filename="pid_namespace">pid_namespace</a>, <a class="macro" href="../include/linux/slab.h.html#41" title="((slab_flags_t )0x00040000U)" data-ref="_M/SLAB_PANIC">SLAB_PANIC</a>);</td></tr>
<tr><th id="461">461</th><td></td></tr>
<tr><th id="462">462</th><td><u>#<span data-ppcond="462">ifdef</span> <span class="macro" data-ref="_M/CONFIG_CHECKPOINT_RESTORE">CONFIG_CHECKPOINT_RESTORE</span></u></td></tr>
<tr><th id="463">463</th><td>	register_sysctl_paths(kern_path, pid_ns_ctl_table);</td></tr>
<tr><th id="464">464</th><td><u>#<span data-ppcond="462">endif</span></u></td></tr>
<tr><th id="465">465</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="466">466</th><td>}</td></tr>
<tr><th id="467">467</th><td></td></tr>
<tr><th id="468">468</th><td><a class="macro" href="../include/linux/init.h.html#234" title="static void * __attribute__((__section__(&quot;.discard.addressable&quot;))) __attribute__((__used__)) __addressable_pid_namespaces_init468 = (void *)&amp;pid_namespaces_init; asm(&quot;.section	\&quot;&quot; &quot;.initcall6&quot; &quot;.init\&quot;, \&quot;a\&quot;	\n&quot; &quot;__initcall_&quot; &quot;pid_namespaces_init&quot; &quot;6&quot; &quot;:			\n&quot; &quot;.long	&quot; &quot;pid_namespaces_init&quot; &quot; - .			\n&quot; &quot;.previous					\n&quot;);" data-ref="_M/__initcall">__initcall</a>(<a class="tu ref fn" href="#pid_namespaces_init" title='pid_namespaces_init' data-use='a' data-ref="pid_namespaces_init" data-ref-filename="pid_namespaces_init">pid_namespaces_init</a>);</td></tr>
<tr><th id="469">469</th><td></td></tr>
</table><hr/><p id='footer'>
Generated on <em>2020-Jun-10</em> from project linux-5.3.1 revision <em>5.3.1</em><br />Powered by <a href='https://woboq.com'><img alt='Woboq' src='https://code.woboq.org/woboq-16.png' width='41' height='16' /></a> <a href='https://code.woboq.org'>Code Browser</a> 2.1
<br/>Generator usage only permitted with license.</p>
</div></body></html>
