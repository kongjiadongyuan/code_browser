<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"><title>i915_gem_pm.c source code [linux-5.3.1/drivers/gpu/drm/i915/gem/i915_gem_pm.c] - Woboq Code Browser</title>
<link rel="stylesheet" href="../../../../../../../data/qtcreator.css" title="QtCreator"/>
<link rel="alternate stylesheet" href="../../../../../../../data/kdevelop.css" title="KDevelop"/>
<script type="text/javascript" src="../../../../../../../data/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../../../../../../../data/jquery/jquery-ui.min.js"></script>
<script>var file = 'linux-5.3.1/drivers/gpu/drm/i915/gem/i915_gem_pm.c'; var root_path = '../../../../../..'; var data_path = '../../../../../../../data'; var ecma_script_api_version = 2;</script>
<script src='../../../../../../../data/codebrowser.js'></script>
</head>
<body><div id='header'><h1 id='breadcrumb'><span>Browse the source code of </span><a href='../../../../..'>linux-5.3.1</a>/<a href='../../../..'>drivers</a>/<a href='../../..'>gpu</a>/<a href='../..'>drm</a>/<a href='..'>i915</a>/<a href='./'>gem</a>/<a href='i915_gem_pm.c.html'>i915_gem_pm.c</a></h1></div>
<hr/><div id='content'><table class="code">
<tr><th id="1">1</th><td><i>/*</i></td></tr>
<tr><th id="2">2</th><td><i> * SPDX-License-Identifier: MIT</i></td></tr>
<tr><th id="3">3</th><td><i> *</i></td></tr>
<tr><th id="4">4</th><td><i> * Copyright Â© 2019 Intel Corporation</i></td></tr>
<tr><th id="5">5</th><td><i> */</i></td></tr>
<tr><th id="6">6</th><td></td></tr>
<tr><th id="7">7</th><td><u>#include <a href="i915_gem_pm.h.html">"gem/i915_gem_pm.h"</a></u></td></tr>
<tr><th id="8">8</th><td><u>#include <a href="../gt/intel_gt_pm.h.html">"gt/intel_gt_pm.h"</a></u></td></tr>
<tr><th id="9">9</th><td></td></tr>
<tr><th id="10">10</th><td><u>#include <a href="../i915_drv.h.html">"i915_drv.h"</a></u></td></tr>
<tr><th id="11">11</th><td><u>#include <a href="../i915_globals.h.html">"i915_globals.h"</a></u></td></tr>
<tr><th id="12">12</th><td></td></tr>
<tr><th id="13">13</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="call_idle_barriers" title='call_idle_barriers' data-type='void call_idle_barriers(struct intel_engine_cs * engine)' data-ref="call_idle_barriers" data-ref-filename="call_idle_barriers">call_idle_barriers</dfn>(<b>struct</b> <a class="type" href="../gt/intel_engine_types.h.html#intel_engine_cs" title='intel_engine_cs' data-ref="intel_engine_cs" data-ref-filename="intel_engine_cs">intel_engine_cs</a> *<dfn class="local col1 decl" id="1engine" title='engine' data-type='struct intel_engine_cs *' data-ref="1engine" data-ref-filename="1engine">engine</dfn>)</td></tr>
<tr><th id="14">14</th><td>{</td></tr>
<tr><th id="15">15</th><td>	<b>struct</b> <a class="type" href="../../../../../include/linux/llist.h.html#llist_node" title='llist_node' data-ref="llist_node" data-ref-filename="llist_node">llist_node</a> *<dfn class="local col2 decl" id="2node" title='node' data-type='struct llist_node *' data-ref="2node" data-ref-filename="2node">node</dfn>, *<dfn class="local col3 decl" id="3next" title='next' data-type='struct llist_node *' data-ref="3next" data-ref-filename="3next">next</dfn>;</td></tr>
<tr><th id="16">16</th><td></td></tr>
<tr><th id="17">17</th><td>	<a class="macro" href="../../../../../include/linux/llist.h.html#133" title="for ((node) = (llist_del_all(&amp;engine-&gt;barrier_tasks)); (node) &amp;&amp; ((next) = (node)-&gt;next, true); (node) = (next))" data-ref="_M/llist_for_each_safe">llist_for_each_safe</a>(<a class="local col2 ref" href="#2node" title='node' data-ref="2node" data-ref-filename="2node">node</a>, <a class="local col3 ref" href="#3next" title='next' data-ref="3next" data-ref-filename="3next">next</a>, <a class="ref fn" href="../../../../../include/linux/llist.h.html#llist_del_all" title='llist_del_all' data-ref="llist_del_all" data-ref-filename="llist_del_all">llist_del_all</a>(&amp;<a class="local col1 ref" href="#1engine" title='engine' data-ref="1engine" data-ref-filename="1engine">engine</a>-&gt;<a class="ref field" href="../gt/intel_engine_types.h.html#intel_engine_cs::barrier_tasks" title='intel_engine_cs::barrier_tasks' data-ref="intel_engine_cs::barrier_tasks" data-ref-filename="intel_engine_cs..barrier_tasks">barrier_tasks</a>)) {</td></tr>
<tr><th id="18">18</th><td>		<b>struct</b> <a class="type" href="../i915_active_types.h.html#i915_active_request" title='i915_active_request' data-ref="i915_active_request" data-ref-filename="i915_active_request">i915_active_request</a> *<dfn class="local col4 decl" id="4active" title='active' data-type='struct i915_active_request *' data-ref="4active" data-ref-filename="4active">active</dfn> =</td></tr>
<tr><th id="19">19</th><td>			<a class="macro" href="../../../../../include/linux/kernel.h.html#971" title="({ void *__mptr = (void *)((struct list_head *)node); do { extern void __compiletime_assert_20(void) ; if (!(!(!__builtin_types_compatible_p(typeof(*((struct list_head *)node)), typeof(((typeof(*active) *)0)-&gt;link)) &amp;&amp; !__builtin_types_compatible_p(typeof(*((struct list_head *)node)), typeof(void))))) __compiletime_assert_20(); } while (0); ((typeof(*active) *)(__mptr - __builtin_offsetof(typeof(*active), link))); })" data-ref="_M/container_of">container_of</a>((<b>struct</b> <a class="type" href="../../../../../include/linux/types.h.html#list_head" title='list_head' data-ref="list_head" data-ref-filename="list_head">list_head</a> *)<a class="local col2 ref" href="#2node" title='node' data-ref="2node" data-ref-filename="2node">node</a>,</td></tr>
<tr><th id="20">20</th><td>				     <b>typeof</b>(*<a class="local col4 ref" href="#4active" title='active' data-ref="4active" data-ref-filename="4active">active</a>), <a class="ref field" href="../i915_active_types.h.html#i915_active_request::link" title='i915_active_request::link' data-ref="i915_active_request::link" data-ref-filename="i915_active_request..link">link</a>);</td></tr>
<tr><th id="21">21</th><td></td></tr>
<tr><th id="22">22</th><td>		<a class="ref fn" href="../../../../../include/linux/list.h.html#INIT_LIST_HEAD" title='INIT_LIST_HEAD' data-ref="INIT_LIST_HEAD" data-ref-filename="INIT_LIST_HEAD">INIT_LIST_HEAD</a>(&amp;<a class="local col4 ref" href="#4active" title='active' data-ref="4active" data-ref-filename="4active">active</a>-&gt;<a class="ref field" href="../i915_active_types.h.html#i915_active_request::link" title='i915_active_request::link' data-ref="i915_active_request::link" data-ref-filename="i915_active_request..link">link</a>);</td></tr>
<tr><th id="23">23</th><td>		<a class="macro" href="../../../../../include/linux/rcupdate.h.html#771" title="do { ; ({ union { typeof(active-&gt;request) __val; char __c[1]; } __u = { .__val = ( typeof(active-&gt;request)) ((typeof(*(((void *)0))) *)(((void *)0))) }; __write_once_size(&amp;(active-&gt;request), __u.__c, sizeof(active-&gt;request)); __u.__val; }); } while (0)" data-ref="_M/RCU_INIT_POINTER">RCU_INIT_POINTER</a>(<a class="local col4 ref" href="#4active" title='active' data-ref="4active" data-ref-filename="4active">active</a>-&gt;<a class="ref field" href="../i915_active_types.h.html#i915_active_request::request" title='i915_active_request::request' data-ref="i915_active_request::request" data-ref-filename="i915_active_request..request">request</a>, <a class="macro" href="../../../../../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>);</td></tr>
<tr><th id="24">24</th><td></td></tr>
<tr><th id="25">25</th><td>		<a class="local col4 ref" href="#4active" title='active' data-ref="4active" data-ref-filename="4active">active</a>-&gt;<a class="ref field" href="../i915_active_types.h.html#i915_active_request::retire" title='i915_active_request::retire' data-ref="i915_active_request::retire" data-ref-filename="i915_active_request..retire">retire</a>(<a class="local col4 ref" href="#4active" title='active' data-ref="4active" data-ref-filename="4active">active</a>, <a class="macro" href="../../../../../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a>);</td></tr>
<tr><th id="26">26</th><td>	}</td></tr>
<tr><th id="27">27</th><td>}</td></tr>
<tr><th id="28">28</th><td></td></tr>
<tr><th id="29">29</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="i915_gem_park" title='i915_gem_park' data-type='void i915_gem_park(struct drm_i915_private * i915)' data-ref="i915_gem_park" data-ref-filename="i915_gem_park">i915_gem_park</dfn>(<b>struct</b> <a class="type" href="../i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col5 decl" id="5i915" title='i915' data-type='struct drm_i915_private *' data-ref="5i915" data-ref-filename="5i915">i915</dfn>)</td></tr>
<tr><th id="30">30</th><td>{</td></tr>
<tr><th id="31">31</th><td>	<b>struct</b> <a class="type" href="../gt/intel_engine_types.h.html#intel_engine_cs" title='intel_engine_cs' data-ref="intel_engine_cs" data-ref-filename="intel_engine_cs">intel_engine_cs</a> *<dfn class="local col6 decl" id="6engine" title='engine' data-type='struct intel_engine_cs *' data-ref="6engine" data-ref-filename="6engine">engine</dfn>;</td></tr>
<tr><th id="32">32</th><td>	<b>enum</b> <a class="type" href="../gt/intel_engine_types.h.html#intel_engine_id" title='intel_engine_id' data-ref="intel_engine_id" data-ref-filename="intel_engine_id">intel_engine_id</a> <dfn class="local col7 decl" id="7id" title='id' data-type='enum intel_engine_id' data-ref="7id" data-ref-filename="7id">id</dfn>;</td></tr>
<tr><th id="33">33</th><td></td></tr>
<tr><th id="34">34</th><td>	<a class="macro" href="../../../../../include/linux/lockdep.h.html#481" title="do { (void)(&amp;i915-&gt;drm.struct_mutex); } while (0)" data-ref="_M/lockdep_assert_held">lockdep_assert_held</a>(&amp;<a class="local col5 ref" href="#5i915" title='i915' data-ref="5i915" data-ref-filename="5i915">i915</a>-&gt;<a class="ref field" href="../i915_drv.h.html#drm_i915_private::drm" title='drm_i915_private::drm' data-ref="drm_i915_private::drm" data-ref-filename="drm_i915_private..drm">drm</a>.<a class="ref field" href="../../../../../include/drm/drm_device.h.html#drm_device::struct_mutex" title='drm_device::struct_mutex' data-ref="drm_device::struct_mutex" data-ref-filename="drm_device..struct_mutex">struct_mutex</a>);</td></tr>
<tr><th id="35">35</th><td></td></tr>
<tr><th id="36">36</th><td>	<a class="macro" href="../i915_drv.h.html#1960" title="for ((id) = 0; (id) &lt; I915_NUM_ENGINES; (id)++) if (!((engine) = (i915)-&gt;engine[(id)])) {} else" data-ref="_M/for_each_engine">for_each_engine</a>(<a class="local col6 ref" href="#6engine" title='engine' data-ref="6engine" data-ref-filename="6engine">engine</a>, <a class="local col5 ref" href="#5i915" title='i915' data-ref="5i915" data-ref-filename="5i915">i915</a>, <a class="local col7 ref" href="#7id" title='id' data-ref="7id" data-ref-filename="7id">id</a>) {</td></tr>
<tr><th id="37">37</th><td>		<a class="tu ref fn" href="#call_idle_barriers" title='call_idle_barriers' data-use='c' data-ref="call_idle_barriers" data-ref-filename="call_idle_barriers">call_idle_barriers</a>(<a class="local col6 ref" href="#6engine" title='engine' data-ref="6engine" data-ref-filename="6engine">engine</a>); <i>/* cleanup after wedging */</i></td></tr>
<tr><th id="38">38</th><td>		<a class="ref fn" href="../i915_gem_batch_pool.h.html#i915_gem_batch_pool_fini" title='i915_gem_batch_pool_fini' data-ref="i915_gem_batch_pool_fini" data-ref-filename="i915_gem_batch_pool_fini">i915_gem_batch_pool_fini</a>(&amp;<a class="local col6 ref" href="#6engine" title='engine' data-ref="6engine" data-ref-filename="6engine">engine</a>-&gt;<a class="ref field" href="../gt/intel_engine_types.h.html#intel_engine_cs::batch_pool" title='intel_engine_cs::batch_pool' data-ref="intel_engine_cs::batch_pool" data-ref-filename="intel_engine_cs..batch_pool">batch_pool</a>);</td></tr>
<tr><th id="39">39</th><td>	}</td></tr>
<tr><th id="40">40</th><td></td></tr>
<tr><th id="41">41</th><td>	<a class="ref fn" href="../i915_timeline.h.html#i915_timelines_park" title='i915_timelines_park' data-ref="i915_timelines_park" data-ref-filename="i915_timelines_park">i915_timelines_park</a>(<a class="local col5 ref" href="#5i915" title='i915' data-ref="5i915" data-ref-filename="5i915">i915</a>);</td></tr>
<tr><th id="42">42</th><td>	<a class="ref fn" href="../i915_vma.h.html#i915_vma_parked" title='i915_vma_parked' data-ref="i915_vma_parked" data-ref-filename="i915_vma_parked">i915_vma_parked</a>(<a class="local col5 ref" href="#5i915" title='i915' data-ref="5i915" data-ref-filename="5i915">i915</a>);</td></tr>
<tr><th id="43">43</th><td></td></tr>
<tr><th id="44">44</th><td>	<a class="ref fn" href="../i915_globals.h.html#i915_globals_park" title='i915_globals_park' data-ref="i915_globals_park" data-ref-filename="i915_globals_park">i915_globals_park</a>();</td></tr>
<tr><th id="45">45</th><td>}</td></tr>
<tr><th id="46">46</th><td></td></tr>
<tr><th id="47">47</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="idle_work_handler" title='idle_work_handler' data-type='void idle_work_handler(struct work_struct * work)' data-ref="idle_work_handler" data-ref-filename="idle_work_handler">idle_work_handler</dfn>(<b>struct</b> <a class="type" href="../../../../../include/linux/workqueue.h.html#work_struct" title='work_struct' data-ref="work_struct" data-ref-filename="work_struct">work_struct</a> *<dfn class="local col8 decl" id="8work" title='work' data-type='struct work_struct *' data-ref="8work" data-ref-filename="8work">work</dfn>)</td></tr>
<tr><th id="48">48</th><td>{</td></tr>
<tr><th id="49">49</th><td>	<b>struct</b> <a class="type" href="../i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col9 decl" id="9i915" title='i915' data-type='struct drm_i915_private *' data-ref="9i915" data-ref-filename="9i915">i915</dfn> =</td></tr>
<tr><th id="50">50</th><td>		<a class="macro" href="../../../../../include/linux/kernel.h.html#971" title="({ void *__mptr = (void *)(work); do { extern void __compiletime_assert_50(void) ; if (!(!(!__builtin_types_compatible_p(typeof(*(work)), typeof(((typeof(*i915) *)0)-&gt;gem.idle_work)) &amp;&amp; !__builtin_types_compatible_p(typeof(*(work)), typeof(void))))) __compiletime_assert_50(); } while (0); ((typeof(*i915) *)(__mptr - __builtin_offsetof(typeof(*i915), gem.idle_work))); })" data-ref="_M/container_of">container_of</a>(<a class="local col8 ref" href="#8work" title='work' data-ref="8work" data-ref-filename="8work">work</a>, <b>typeof</b>(*<a class="local col9 ref" href="#9i915" title='i915' data-ref="9i915" data-ref-filename="9i915">i915</a>), <a class="ref field" href="../i915_drv.h.html#drm_i915_private::gem" title='drm_i915_private::gem' data-ref="drm_i915_private::gem" data-ref-filename="drm_i915_private..gem">gem</a>.<a class="ref field" href="../i915_drv.h.html#drm_i915_private::(anonymous)::idle_work" title='drm_i915_private::(anonymous struct)::idle_work' data-ref="drm_i915_private::(anonymous)::idle_work" data-ref-filename="drm_i915_private..(anonymous)..idle_work">idle_work</a>);</td></tr>
<tr><th id="51">51</th><td>	<a class="typedef" href="../../../../../include/linux/types.h.html#bool" title='bool' data-type='_Bool' data-ref="bool" data-ref-filename="bool">bool</a> <dfn class="local col0 decl" id="10park" title='park' data-type='bool' data-ref="10park" data-ref-filename="10park">park</dfn>;</td></tr>
<tr><th id="52">52</th><td></td></tr>
<tr><th id="53">53</th><td>	<a class="ref fn" href="../../../../../include/linux/workqueue.h.html#cancel_delayed_work_sync" title='cancel_delayed_work_sync' data-ref="cancel_delayed_work_sync" data-ref-filename="cancel_delayed_work_sync">cancel_delayed_work_sync</a>(&amp;<a class="local col9 ref" href="#9i915" title='i915' data-ref="9i915" data-ref-filename="9i915">i915</a>-&gt;<a class="ref field" href="../i915_drv.h.html#drm_i915_private::gem" title='drm_i915_private::gem' data-ref="drm_i915_private::gem" data-ref-filename="drm_i915_private..gem">gem</a>.<a class="ref field" href="../i915_drv.h.html#drm_i915_private::(anonymous)::retire_work" title='drm_i915_private::(anonymous struct)::retire_work' data-ref="drm_i915_private::(anonymous)::retire_work" data-ref-filename="drm_i915_private..(anonymous)..retire_work">retire_work</a>);</td></tr>
<tr><th id="54">54</th><td>	<a class="ref fn" href="../../../../../include/linux/mutex.h.html#mutex_lock" title='mutex_lock' data-ref="mutex_lock" data-ref-filename="mutex_lock">mutex_lock</a>(&amp;<a class="local col9 ref" href="#9i915" title='i915' data-ref="9i915" data-ref-filename="9i915">i915</a>-&gt;<a class="ref field" href="../i915_drv.h.html#drm_i915_private::drm" title='drm_i915_private::drm' data-ref="drm_i915_private::drm" data-ref-filename="drm_i915_private..drm">drm</a>.<a class="ref field" href="../../../../../include/drm/drm_device.h.html#drm_device::struct_mutex" title='drm_device::struct_mutex' data-ref="drm_device::struct_mutex" data-ref-filename="drm_device..struct_mutex">struct_mutex</a>);</td></tr>
<tr><th id="55">55</th><td></td></tr>
<tr><th id="56">56</th><td>	<a class="ref fn" href="../intel_wakeref.h.html#intel_wakeref_lock" title='intel_wakeref_lock' data-ref="intel_wakeref_lock" data-ref-filename="intel_wakeref_lock">intel_wakeref_lock</a>(&amp;<a class="local col9 ref" href="#9i915" title='i915' data-ref="9i915" data-ref-filename="9i915">i915</a>-&gt;<a class="ref field" href="../i915_drv.h.html#drm_i915_private::gt" title='drm_i915_private::gt' data-ref="drm_i915_private::gt" data-ref-filename="drm_i915_private..gt">gt</a>.<a class="ref field" href="../i915_drv.h.html#drm_i915_private::(anonymous)::wakeref" title='drm_i915_private::(anonymous struct)::wakeref' data-ref="drm_i915_private::(anonymous)::wakeref" data-ref-filename="drm_i915_private..(anonymous)..wakeref">wakeref</a>);</td></tr>
<tr><th id="57">57</th><td>	<a class="local col0 ref" href="#10park" title='park' data-ref="10park" data-ref-filename="10park">park</a> = !<a class="ref fn" href="../intel_wakeref.h.html#intel_wakeref_active" title='intel_wakeref_active' data-ref="intel_wakeref_active" data-ref-filename="intel_wakeref_active">intel_wakeref_active</a>(&amp;<a class="local col9 ref" href="#9i915" title='i915' data-ref="9i915" data-ref-filename="9i915">i915</a>-&gt;<a class="ref field" href="../i915_drv.h.html#drm_i915_private::gt" title='drm_i915_private::gt' data-ref="drm_i915_private::gt" data-ref-filename="drm_i915_private..gt">gt</a>.<a class="ref field" href="../i915_drv.h.html#drm_i915_private::(anonymous)::wakeref" title='drm_i915_private::(anonymous struct)::wakeref' data-ref="drm_i915_private::(anonymous)::wakeref" data-ref-filename="drm_i915_private..(anonymous)..wakeref">wakeref</a>) &amp;&amp; !<a class="macro" href="../../../../../include/linux/workqueue.h.html#293" title="test_bit(WORK_STRUCT_PENDING_BIT, ((unsigned long *)(&amp;(work)-&gt;data)))" data-ref="_M/work_pending">work_pending</a>(<a class="local col8 ref" href="#8work" title='work' data-ref="8work" data-ref-filename="8work">work</a>);</td></tr>
<tr><th id="58">58</th><td>	<a class="ref fn" href="../intel_wakeref.h.html#intel_wakeref_unlock" title='intel_wakeref_unlock' data-ref="intel_wakeref_unlock" data-ref-filename="intel_wakeref_unlock">intel_wakeref_unlock</a>(&amp;<a class="local col9 ref" href="#9i915" title='i915' data-ref="9i915" data-ref-filename="9i915">i915</a>-&gt;<a class="ref field" href="../i915_drv.h.html#drm_i915_private::gt" title='drm_i915_private::gt' data-ref="drm_i915_private::gt" data-ref-filename="drm_i915_private..gt">gt</a>.<a class="ref field" href="../i915_drv.h.html#drm_i915_private::(anonymous)::wakeref" title='drm_i915_private::(anonymous struct)::wakeref' data-ref="drm_i915_private::(anonymous)::wakeref" data-ref-filename="drm_i915_private..(anonymous)..wakeref">wakeref</a>);</td></tr>
<tr><th id="59">59</th><td>	<b>if</b> (<a class="local col0 ref" href="#10park" title='park' data-ref="10park" data-ref-filename="10park">park</a>)</td></tr>
<tr><th id="60">60</th><td>		<a class="tu ref fn" href="#i915_gem_park" title='i915_gem_park' data-use='c' data-ref="i915_gem_park" data-ref-filename="i915_gem_park">i915_gem_park</a>(<a class="local col9 ref" href="#9i915" title='i915' data-ref="9i915" data-ref-filename="9i915">i915</a>);</td></tr>
<tr><th id="61">61</th><td>	<b>else</b></td></tr>
<tr><th id="62">62</th><td>		<a class="ref fn" href="../../../../../include/linux/workqueue.h.html#queue_delayed_work" title='queue_delayed_work' data-ref="queue_delayed_work" data-ref-filename="queue_delayed_work">queue_delayed_work</a>(<a class="local col9 ref" href="#9i915" title='i915' data-ref="9i915" data-ref-filename="9i915">i915</a>-&gt;<a class="ref field" href="../i915_drv.h.html#drm_i915_private::wq" title='drm_i915_private::wq' data-ref="drm_i915_private::wq" data-ref-filename="drm_i915_private..wq">wq</a>,</td></tr>
<tr><th id="63">63</th><td>				   &amp;<a class="local col9 ref" href="#9i915" title='i915' data-ref="9i915" data-ref-filename="9i915">i915</a>-&gt;<a class="ref field" href="../i915_drv.h.html#drm_i915_private::gem" title='drm_i915_private::gem' data-ref="drm_i915_private::gem" data-ref-filename="drm_i915_private..gem">gem</a>.<a class="ref field" href="../i915_drv.h.html#drm_i915_private::(anonymous)::retire_work" title='drm_i915_private::(anonymous struct)::retire_work' data-ref="drm_i915_private::(anonymous)::retire_work" data-ref-filename="drm_i915_private..(anonymous)..retire_work">retire_work</a>,</td></tr>
<tr><th id="64">64</th><td>				   <a class="ref fn" href="../../../../../include/linux/timer.h.html#round_jiffies_up_relative" title='round_jiffies_up_relative' data-ref="round_jiffies_up_relative" data-ref-filename="round_jiffies_up_relative">round_jiffies_up_relative</a>(<a class="macro" href="../../../../../include/asm-generic/param.h.html#8" title="1000" data-ref="_M/HZ">HZ</a>));</td></tr>
<tr><th id="65">65</th><td></td></tr>
<tr><th id="66">66</th><td>	<a class="ref fn" href="../../../../../include/linux/mutex.h.html#mutex_unlock" title='mutex_unlock' data-ref="mutex_unlock" data-ref-filename="mutex_unlock">mutex_unlock</a>(&amp;<a class="local col9 ref" href="#9i915" title='i915' data-ref="9i915" data-ref-filename="9i915">i915</a>-&gt;<a class="ref field" href="../i915_drv.h.html#drm_i915_private::drm" title='drm_i915_private::drm' data-ref="drm_i915_private::drm" data-ref-filename="drm_i915_private..drm">drm</a>.<a class="ref field" href="../../../../../include/drm/drm_device.h.html#drm_device::struct_mutex" title='drm_device::struct_mutex' data-ref="drm_device::struct_mutex" data-ref-filename="drm_device..struct_mutex">struct_mutex</a>);</td></tr>
<tr><th id="67">67</th><td>}</td></tr>
<tr><th id="68">68</th><td></td></tr>
<tr><th id="69">69</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="retire_work_handler" title='retire_work_handler' data-type='void retire_work_handler(struct work_struct * work)' data-ref="retire_work_handler" data-ref-filename="retire_work_handler">retire_work_handler</dfn>(<b>struct</b> <a class="type" href="../../../../../include/linux/workqueue.h.html#work_struct" title='work_struct' data-ref="work_struct" data-ref-filename="work_struct">work_struct</a> *<dfn class="local col1 decl" id="11work" title='work' data-type='struct work_struct *' data-ref="11work" data-ref-filename="11work">work</dfn>)</td></tr>
<tr><th id="70">70</th><td>{</td></tr>
<tr><th id="71">71</th><td>	<b>struct</b> <a class="type" href="../i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col2 decl" id="12i915" title='i915' data-type='struct drm_i915_private *' data-ref="12i915" data-ref-filename="12i915">i915</dfn> =</td></tr>
<tr><th id="72">72</th><td>		<a class="macro" href="../../../../../include/linux/kernel.h.html#971" title="({ void *__mptr = (void *)(work); do { extern void __compiletime_assert_72(void) ; if (!(!(!__builtin_types_compatible_p(typeof(*(work)), typeof(((typeof(*i915) *)0)-&gt;gem.retire_work.work)) &amp;&amp; !__builtin_types_compatible_p(typeof(*(work)), typeof(void))))) __compiletime_assert_72(); } while (0); ((typeof(*i915) *)(__mptr - __builtin_offsetof(typeof(*i915), gem.retire_work.work))); })" data-ref="_M/container_of">container_of</a>(<a class="local col1 ref" href="#11work" title='work' data-ref="11work" data-ref-filename="11work">work</a>, <b>typeof</b>(*<a class="local col2 ref" href="#12i915" title='i915' data-ref="12i915" data-ref-filename="12i915">i915</a>), <a class="ref field" href="../i915_drv.h.html#drm_i915_private::gem" title='drm_i915_private::gem' data-ref="drm_i915_private::gem" data-ref-filename="drm_i915_private..gem">gem</a>.<a class="ref field" href="../i915_drv.h.html#drm_i915_private::(anonymous)::retire_work" title='drm_i915_private::(anonymous struct)::retire_work' data-ref="drm_i915_private::(anonymous)::retire_work" data-ref-filename="drm_i915_private..(anonymous)..retire_work">retire_work</a>.<a class="ref field" href="../../../../../include/linux/workqueue.h.html#delayed_work::work" title='delayed_work::work' data-ref="delayed_work::work" data-ref-filename="delayed_work..work">work</a>);</td></tr>
<tr><th id="73">73</th><td></td></tr>
<tr><th id="74">74</th><td>	<i>/* Come back later if the device is busy... */</i></td></tr>
<tr><th id="75">75</th><td>	<b>if</b> (<a class="ref fn" href="../../../../../include/linux/mutex.h.html#mutex_trylock" title='mutex_trylock' data-ref="mutex_trylock" data-ref-filename="mutex_trylock">mutex_trylock</a>(&amp;<a class="local col2 ref" href="#12i915" title='i915' data-ref="12i915" data-ref-filename="12i915">i915</a>-&gt;<a class="ref field" href="../i915_drv.h.html#drm_i915_private::drm" title='drm_i915_private::drm' data-ref="drm_i915_private::drm" data-ref-filename="drm_i915_private..drm">drm</a>.<a class="ref field" href="../../../../../include/drm/drm_device.h.html#drm_device::struct_mutex" title='drm_device::struct_mutex' data-ref="drm_device::struct_mutex" data-ref-filename="drm_device..struct_mutex">struct_mutex</a>)) {</td></tr>
<tr><th id="76">76</th><td>		<a class="ref fn" href="../i915_request.h.html#i915_retire_requests" title='i915_retire_requests' data-ref="i915_retire_requests" data-ref-filename="i915_retire_requests">i915_retire_requests</a>(<a class="local col2 ref" href="#12i915" title='i915' data-ref="12i915" data-ref-filename="12i915">i915</a>);</td></tr>
<tr><th id="77">77</th><td>		<a class="ref fn" href="../../../../../include/linux/mutex.h.html#mutex_unlock" title='mutex_unlock' data-ref="mutex_unlock" data-ref-filename="mutex_unlock">mutex_unlock</a>(&amp;<a class="local col2 ref" href="#12i915" title='i915' data-ref="12i915" data-ref-filename="12i915">i915</a>-&gt;<a class="ref field" href="../i915_drv.h.html#drm_i915_private::drm" title='drm_i915_private::drm' data-ref="drm_i915_private::drm" data-ref-filename="drm_i915_private..drm">drm</a>.<a class="ref field" href="../../../../../include/drm/drm_device.h.html#drm_device::struct_mutex" title='drm_device::struct_mutex' data-ref="drm_device::struct_mutex" data-ref-filename="drm_device..struct_mutex">struct_mutex</a>);</td></tr>
<tr><th id="78">78</th><td>	}</td></tr>
<tr><th id="79">79</th><td></td></tr>
<tr><th id="80">80</th><td>	<a class="ref fn" href="../../../../../include/linux/workqueue.h.html#queue_delayed_work" title='queue_delayed_work' data-ref="queue_delayed_work" data-ref-filename="queue_delayed_work">queue_delayed_work</a>(<a class="local col2 ref" href="#12i915" title='i915' data-ref="12i915" data-ref-filename="12i915">i915</a>-&gt;<a class="ref field" href="../i915_drv.h.html#drm_i915_private::wq" title='drm_i915_private::wq' data-ref="drm_i915_private::wq" data-ref-filename="drm_i915_private..wq">wq</a>,</td></tr>
<tr><th id="81">81</th><td>			   &amp;<a class="local col2 ref" href="#12i915" title='i915' data-ref="12i915" data-ref-filename="12i915">i915</a>-&gt;<a class="ref field" href="../i915_drv.h.html#drm_i915_private::gem" title='drm_i915_private::gem' data-ref="drm_i915_private::gem" data-ref-filename="drm_i915_private..gem">gem</a>.<a class="ref field" href="../i915_drv.h.html#drm_i915_private::(anonymous)::retire_work" title='drm_i915_private::(anonymous struct)::retire_work' data-ref="drm_i915_private::(anonymous)::retire_work" data-ref-filename="drm_i915_private..(anonymous)..retire_work">retire_work</a>,</td></tr>
<tr><th id="82">82</th><td>			   <a class="ref fn" href="../../../../../include/linux/timer.h.html#round_jiffies_up_relative" title='round_jiffies_up_relative' data-ref="round_jiffies_up_relative" data-ref-filename="round_jiffies_up_relative">round_jiffies_up_relative</a>(<a class="macro" href="../../../../../include/asm-generic/param.h.html#8" title="1000" data-ref="_M/HZ">HZ</a>));</td></tr>
<tr><th id="83">83</th><td>}</td></tr>
<tr><th id="84">84</th><td></td></tr>
<tr><th id="85">85</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="pm_notifier" title='pm_notifier' data-type='int pm_notifier(struct notifier_block * nb, unsigned long action, void * data)' data-ref="pm_notifier" data-ref-filename="pm_notifier">pm_notifier</dfn>(<b>struct</b> <a class="type" href="../../../../../include/linux/notifier.h.html#notifier_block" title='notifier_block' data-ref="notifier_block" data-ref-filename="notifier_block">notifier_block</a> *<dfn class="local col3 decl" id="13nb" title='nb' data-type='struct notifier_block *' data-ref="13nb" data-ref-filename="13nb">nb</dfn>,</td></tr>
<tr><th id="86">86</th><td>		       <em>unsigned</em> <em>long</em> <dfn class="local col4 decl" id="14action" title='action' data-type='unsigned long' data-ref="14action" data-ref-filename="14action">action</dfn>,</td></tr>
<tr><th id="87">87</th><td>		       <em>void</em> *<dfn class="local col5 decl" id="15data" title='data' data-type='void *' data-ref="15data" data-ref-filename="15data">data</dfn>)</td></tr>
<tr><th id="88">88</th><td>{</td></tr>
<tr><th id="89">89</th><td>	<b>struct</b> <a class="type" href="../i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col6 decl" id="16i915" title='i915' data-type='struct drm_i915_private *' data-ref="16i915" data-ref-filename="16i915">i915</dfn> =</td></tr>
<tr><th id="90">90</th><td>		<a class="macro" href="../../../../../include/linux/kernel.h.html#971" title="({ void *__mptr = (void *)(nb); do { extern void __compiletime_assert_90(void) ; if (!(!(!__builtin_types_compatible_p(typeof(*(nb)), typeof(((typeof(*i915) *)0)-&gt;gem.pm_notifier)) &amp;&amp; !__builtin_types_compatible_p(typeof(*(nb)), typeof(void))))) __compiletime_assert_90(); } while (0); ((typeof(*i915) *)(__mptr - __builtin_offsetof(typeof(*i915), gem.pm_notifier))); })" data-ref="_M/container_of">container_of</a>(<a class="local col3 ref" href="#13nb" title='nb' data-ref="13nb" data-ref-filename="13nb">nb</a>, <b>typeof</b>(*<a class="local col6 ref" href="#16i915" title='i915' data-ref="16i915" data-ref-filename="16i915">i915</a>), <a class="ref field" href="../i915_drv.h.html#drm_i915_private::gem" title='drm_i915_private::gem' data-ref="drm_i915_private::gem" data-ref-filename="drm_i915_private..gem">gem</a>.<a class="ref field" href="../i915_drv.h.html#drm_i915_private::(anonymous)::pm_notifier" title='drm_i915_private::(anonymous struct)::pm_notifier' data-ref="drm_i915_private::(anonymous)::pm_notifier" data-ref-filename="drm_i915_private..(anonymous)..pm_notifier">pm_notifier</a>);</td></tr>
<tr><th id="91">91</th><td></td></tr>
<tr><th id="92">92</th><td>	<b>switch</b> (<a class="local col4 ref" href="#14action" title='action' data-ref="14action" data-ref-filename="14action">action</a>) {</td></tr>
<tr><th id="93">93</th><td>	<b>case</b> <a class="enum" href="../gt/intel_gt_pm.h.html#INTEL_GT_UNPARK" title='INTEL_GT_UNPARK' data-ref="INTEL_GT_UNPARK" data-ref-filename="INTEL_GT_UNPARK">INTEL_GT_UNPARK</a>:</td></tr>
<tr><th id="94">94</th><td>		<a class="ref fn" href="../i915_globals.h.html#i915_globals_unpark" title='i915_globals_unpark' data-ref="i915_globals_unpark" data-ref-filename="i915_globals_unpark">i915_globals_unpark</a>();</td></tr>
<tr><th id="95">95</th><td>		<a class="ref fn" href="../../../../../include/linux/workqueue.h.html#queue_delayed_work" title='queue_delayed_work' data-ref="queue_delayed_work" data-ref-filename="queue_delayed_work">queue_delayed_work</a>(<a class="local col6 ref" href="#16i915" title='i915' data-ref="16i915" data-ref-filename="16i915">i915</a>-&gt;<a class="ref field" href="../i915_drv.h.html#drm_i915_private::wq" title='drm_i915_private::wq' data-ref="drm_i915_private::wq" data-ref-filename="drm_i915_private..wq">wq</a>,</td></tr>
<tr><th id="96">96</th><td>				   &amp;<a class="local col6 ref" href="#16i915" title='i915' data-ref="16i915" data-ref-filename="16i915">i915</a>-&gt;<a class="ref field" href="../i915_drv.h.html#drm_i915_private::gem" title='drm_i915_private::gem' data-ref="drm_i915_private::gem" data-ref-filename="drm_i915_private..gem">gem</a>.<a class="ref field" href="../i915_drv.h.html#drm_i915_private::(anonymous)::retire_work" title='drm_i915_private::(anonymous struct)::retire_work' data-ref="drm_i915_private::(anonymous)::retire_work" data-ref-filename="drm_i915_private..(anonymous)..retire_work">retire_work</a>,</td></tr>
<tr><th id="97">97</th><td>				   <a class="ref fn" href="../../../../../include/linux/timer.h.html#round_jiffies_up_relative" title='round_jiffies_up_relative' data-ref="round_jiffies_up_relative" data-ref-filename="round_jiffies_up_relative">round_jiffies_up_relative</a>(<a class="macro" href="../../../../../include/asm-generic/param.h.html#8" title="1000" data-ref="_M/HZ">HZ</a>));</td></tr>
<tr><th id="98">98</th><td>		<b>break</b>;</td></tr>
<tr><th id="99">99</th><td></td></tr>
<tr><th id="100">100</th><td>	<b>case</b> <a class="enum" href="../gt/intel_gt_pm.h.html#INTEL_GT_PARK" title='INTEL_GT_PARK' data-ref="INTEL_GT_PARK" data-ref-filename="INTEL_GT_PARK">INTEL_GT_PARK</a>:</td></tr>
<tr><th id="101">101</th><td>		<a class="ref fn" href="../../../../../include/linux/workqueue.h.html#queue_work" title='queue_work' data-ref="queue_work" data-ref-filename="queue_work">queue_work</a>(<a class="local col6 ref" href="#16i915" title='i915' data-ref="16i915" data-ref-filename="16i915">i915</a>-&gt;<a class="ref field" href="../i915_drv.h.html#drm_i915_private::wq" title='drm_i915_private::wq' data-ref="drm_i915_private::wq" data-ref-filename="drm_i915_private..wq">wq</a>, &amp;<a class="local col6 ref" href="#16i915" title='i915' data-ref="16i915" data-ref-filename="16i915">i915</a>-&gt;<a class="ref field" href="../i915_drv.h.html#drm_i915_private::gem" title='drm_i915_private::gem' data-ref="drm_i915_private::gem" data-ref-filename="drm_i915_private..gem">gem</a>.<a class="ref field" href="../i915_drv.h.html#drm_i915_private::(anonymous)::idle_work" title='drm_i915_private::(anonymous struct)::idle_work' data-ref="drm_i915_private::(anonymous)::idle_work" data-ref-filename="drm_i915_private..(anonymous)..idle_work">idle_work</a>);</td></tr>
<tr><th id="102">102</th><td>		<b>break</b>;</td></tr>
<tr><th id="103">103</th><td>	}</td></tr>
<tr><th id="104">104</th><td></td></tr>
<tr><th id="105">105</th><td>	<b>return</b> <a class="macro" href="../../../../../include/linux/notifier.h.html#184" title="0x0001" data-ref="_M/NOTIFY_OK">NOTIFY_OK</a>;</td></tr>
<tr><th id="106">106</th><td>}</td></tr>
<tr><th id="107">107</th><td></td></tr>
<tr><th id="108">108</th><td><em>static</em> <a class="typedef" href="../../../../../include/linux/types.h.html#bool" title='bool' data-type='_Bool' data-ref="bool" data-ref-filename="bool">bool</a> <dfn class="tu decl def fn" id="switch_to_kernel_context_sync" title='switch_to_kernel_context_sync' data-type='bool switch_to_kernel_context_sync(struct drm_i915_private * i915)' data-ref="switch_to_kernel_context_sync" data-ref-filename="switch_to_kernel_context_sync">switch_to_kernel_context_sync</dfn>(<b>struct</b> <a class="type" href="../i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col7 decl" id="17i915" title='i915' data-type='struct drm_i915_private *' data-ref="17i915" data-ref-filename="17i915">i915</dfn>)</td></tr>
<tr><th id="109">109</th><td>{</td></tr>
<tr><th id="110">110</th><td>	<a class="typedef" href="../../../../../include/linux/types.h.html#bool" title='bool' data-type='_Bool' data-ref="bool" data-ref-filename="bool">bool</a> <dfn class="local col8 decl" id="18result" title='result' data-type='bool' data-ref="18result" data-ref-filename="18result">result</dfn> = !<a class="ref fn" href="../gt/intel_reset.h.html#i915_terminally_wedged" title='i915_terminally_wedged' data-ref="i915_terminally_wedged" data-ref-filename="i915_terminally_wedged">i915_terminally_wedged</a>(<a class="local col7 ref" href="#17i915" title='i915' data-ref="17i915" data-ref-filename="17i915">i915</a>);</td></tr>
<tr><th id="111">111</th><td></td></tr>
<tr><th id="112">112</th><td>	<b>do</b> {</td></tr>
<tr><th id="113">113</th><td>		<b>if</b> (<a class="ref fn" href="../i915_drv.h.html#i915_gem_wait_for_idle" title='i915_gem_wait_for_idle' data-ref="i915_gem_wait_for_idle" data-ref-filename="i915_gem_wait_for_idle">i915_gem_wait_for_idle</a>(<a class="local col7 ref" href="#17i915" title='i915' data-ref="17i915" data-ref-filename="17i915">i915</a>,</td></tr>
<tr><th id="114">114</th><td>					   <a class="macro" href="../i915_request.h.html#310" title="((((1UL))) &lt;&lt; (1))" data-ref="_M/I915_WAIT_LOCKED">I915_WAIT_LOCKED</a> |</td></tr>
<tr><th id="115">115</th><td>					   <a class="macro" href="../i915_request.h.html#313" title="((((1UL))) &lt;&lt; (4))" data-ref="_M/I915_WAIT_FOR_IDLE_BOOST">I915_WAIT_FOR_IDLE_BOOST</a>,</td></tr>
<tr><th id="116">116</th><td>					   <a class="macro" href="../i915_gem.h.html#76" title="(1000 / 5)" data-ref="_M/I915_GEM_IDLE_TIMEOUT">I915_GEM_IDLE_TIMEOUT</a>) == -<a class="macro" href="../../../../../include/uapi/asm-generic/errno.h.html#45" title="62" data-ref="_M/ETIME">ETIME</a>) {</td></tr>
<tr><th id="117">117</th><td>			<i>/* XXX hide warning from gem_eio */</i></td></tr>
<tr><th id="118">118</th><td>			<b>if</b> (<a class="ref" href="../i915_params.h.html#i915_modparams" title='i915_modparams' data-ref="i915_modparams" data-ref-filename="i915_modparams">i915_modparams</a>.<a class="ref field" href="../i915_params.h.html#84" title='i915_params::reset' data-ref="i915_params::reset" data-ref-filename="i915_params..reset">reset</a>) {</td></tr>
<tr><th id="119">119</th><td>				<a class="macro" href="../../../../../include/linux/device.h.html#1498" title="_dev_err(i915-&gt;drm.dev, &quot;Failed to idle engines, declaring wedged!\n&quot;)" data-ref="_M/dev_err">dev_err</a>(<a class="local col7 ref" href="#17i915" title='i915' data-ref="17i915" data-ref-filename="17i915">i915</a>-&gt;<a class="ref field" href="../i915_drv.h.html#drm_i915_private::drm" title='drm_i915_private::drm' data-ref="drm_i915_private::drm" data-ref-filename="drm_i915_private..drm">drm</a>.<a class="ref field" href="../../../../../include/drm/drm_device.h.html#drm_device::dev" title='drm_device::dev' data-ref="drm_device::dev" data-ref-filename="drm_device..dev">dev</a>,</td></tr>
<tr><th id="120">120</th><td>					<q>"Failed to idle engines, declaring wedged!\n"</q>);</td></tr>
<tr><th id="121">121</th><td>				<a class="macro" href="../i915_gem.h.html#72" title="do { } while (0)" data-ref="_M/GEM_TRACE_DUMP">GEM_TRACE_DUMP</a>();</td></tr>
<tr><th id="122">122</th><td>			}</td></tr>
<tr><th id="123">123</th><td></td></tr>
<tr><th id="124">124</th><td>			<i>/*</i></td></tr>
<tr><th id="125">125</th><td><i>			 * Forcibly cancel outstanding work and leave</i></td></tr>
<tr><th id="126">126</th><td><i>			 * the gpu quiet.</i></td></tr>
<tr><th id="127">127</th><td><i>			 */</i></td></tr>
<tr><th id="128">128</th><td>			<a class="ref fn" href="../i915_drv.h.html#i915_gem_set_wedged" title='i915_gem_set_wedged' data-ref="i915_gem_set_wedged" data-ref-filename="i915_gem_set_wedged">i915_gem_set_wedged</a>(<a class="local col7 ref" href="#17i915" title='i915' data-ref="17i915" data-ref-filename="17i915">i915</a>);</td></tr>
<tr><th id="129">129</th><td>			<a class="local col8 ref" href="#18result" title='result' data-ref="18result" data-ref-filename="18result">result</a> = <a class="enum" href="../../../../../include/linux/stddef.h.html#false" title='false' data-ref="false" data-ref-filename="false">false</a>;</td></tr>
<tr><th id="130">130</th><td>		}</td></tr>
<tr><th id="131">131</th><td>	} <b>while</b> (<a class="ref fn" href="../i915_request.h.html#i915_retire_requests" title='i915_retire_requests' data-ref="i915_retire_requests" data-ref-filename="i915_retire_requests">i915_retire_requests</a>(<a class="local col7 ref" href="#17i915" title='i915' data-ref="17i915" data-ref-filename="17i915">i915</a>) &amp;&amp; <a class="local col8 ref" href="#18result" title='result' data-ref="18result" data-ref-filename="18result">result</a>);</td></tr>
<tr><th id="132">132</th><td></td></tr>
<tr><th id="133">133</th><td>	<a class="macro" href="../i915_gem.h.html#56" title="((void)(sizeof(( long)(i915-&gt;gt.awake))))" data-ref="_M/GEM_BUG_ON">GEM_BUG_ON</a>(<a class="local col7 ref" href="#17i915" title='i915' data-ref="17i915" data-ref-filename="17i915">i915</a>-&gt;<a class="ref field" href="../i915_drv.h.html#drm_i915_private::gt" title='drm_i915_private::gt' data-ref="drm_i915_private::gt" data-ref-filename="drm_i915_private..gt">gt</a>.<a class="ref field" href="../i915_drv.h.html#drm_i915_private::(anonymous)::awake" title='drm_i915_private::(anonymous struct)::awake' data-ref="drm_i915_private::(anonymous)::awake" data-ref-filename="drm_i915_private..(anonymous)..awake">awake</a>);</td></tr>
<tr><th id="134">134</th><td>	<b>return</b> <a class="local col8 ref" href="#18result" title='result' data-ref="18result" data-ref-filename="18result">result</a>;</td></tr>
<tr><th id="135">135</th><td>}</td></tr>
<tr><th id="136">136</th><td></td></tr>
<tr><th id="137">137</th><td><a class="typedef" href="../../../../../include/linux/types.h.html#bool" title='bool' data-type='_Bool' data-ref="bool" data-ref-filename="bool">bool</a> <dfn class="decl def fn" id="i915_gem_load_power_context" title='i915_gem_load_power_context' data-ref="i915_gem_load_power_context" data-ref-filename="i915_gem_load_power_context">i915_gem_load_power_context</dfn>(<b>struct</b> <a class="type" href="../i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col9 decl" id="19i915" title='i915' data-type='struct drm_i915_private *' data-ref="19i915" data-ref-filename="19i915">i915</dfn>)</td></tr>
<tr><th id="138">138</th><td>{</td></tr>
<tr><th id="139">139</th><td>	<b>return</b> <a class="tu ref fn" href="#switch_to_kernel_context_sync" title='switch_to_kernel_context_sync' data-use='c' data-ref="switch_to_kernel_context_sync" data-ref-filename="switch_to_kernel_context_sync">switch_to_kernel_context_sync</a>(<a class="local col9 ref" href="#19i915" title='i915' data-ref="19i915" data-ref-filename="19i915">i915</a>);</td></tr>
<tr><th id="140">140</th><td>}</td></tr>
<tr><th id="141">141</th><td></td></tr>
<tr><th id="142">142</th><td><em>void</em> <dfn class="decl def fn" id="i915_gem_suspend" title='i915_gem_suspend' data-ref="i915_gem_suspend" data-ref-filename="i915_gem_suspend">i915_gem_suspend</dfn>(<b>struct</b> <a class="type" href="../i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col0 decl" id="20i915" title='i915' data-type='struct drm_i915_private *' data-ref="20i915" data-ref-filename="20i915">i915</dfn>)</td></tr>
<tr><th id="143">143</th><td>{</td></tr>
<tr><th id="144">144</th><td>	<a class="macro" href="../i915_gem.h.html#71" title="do { } while (0)" data-ref="_M/GEM_TRACE">GEM_TRACE</a>(<q>"\n"</q>);</td></tr>
<tr><th id="145">145</th><td></td></tr>
<tr><th id="146">146</th><td>	<a class="ref fn" href="../intel_wakeref.h.html#intel_wakeref_auto" title='intel_wakeref_auto' data-ref="intel_wakeref_auto" data-ref-filename="intel_wakeref_auto">intel_wakeref_auto</a>(&amp;<a class="local col0 ref" href="#20i915" title='i915' data-ref="20i915" data-ref-filename="20i915">i915</a>-&gt;<a class="ref field" href="../i915_drv.h.html#drm_i915_private::ggtt" title='drm_i915_private::ggtt' data-ref="drm_i915_private::ggtt" data-ref-filename="drm_i915_private..ggtt">ggtt</a>.<a class="ref field" href="../i915_gem_gtt.h.html#i915_ggtt::userfault_wakeref" title='i915_ggtt::userfault_wakeref' data-ref="i915_ggtt::userfault_wakeref" data-ref-filename="i915_ggtt..userfault_wakeref">userfault_wakeref</a>, <var>0</var>);</td></tr>
<tr><th id="147">147</th><td>	<a class="ref fn" href="../../../../../include/linux/workqueue.h.html#flush_workqueue" title='flush_workqueue' data-ref="flush_workqueue" data-ref-filename="flush_workqueue">flush_workqueue</a>(<a class="local col0 ref" href="#20i915" title='i915' data-ref="20i915" data-ref-filename="20i915">i915</a>-&gt;<a class="ref field" href="../i915_drv.h.html#drm_i915_private::wq" title='drm_i915_private::wq' data-ref="drm_i915_private::wq" data-ref-filename="drm_i915_private..wq">wq</a>);</td></tr>
<tr><th id="148">148</th><td></td></tr>
<tr><th id="149">149</th><td>	<a class="ref fn" href="../../../../../include/linux/mutex.h.html#mutex_lock" title='mutex_lock' data-ref="mutex_lock" data-ref-filename="mutex_lock">mutex_lock</a>(&amp;<a class="local col0 ref" href="#20i915" title='i915' data-ref="20i915" data-ref-filename="20i915">i915</a>-&gt;<a class="ref field" href="../i915_drv.h.html#drm_i915_private::drm" title='drm_i915_private::drm' data-ref="drm_i915_private::drm" data-ref-filename="drm_i915_private..drm">drm</a>.<a class="ref field" href="../../../../../include/drm/drm_device.h.html#drm_device::struct_mutex" title='drm_device::struct_mutex' data-ref="drm_device::struct_mutex" data-ref-filename="drm_device..struct_mutex">struct_mutex</a>);</td></tr>
<tr><th id="150">150</th><td></td></tr>
<tr><th id="151">151</th><td>	<i>/*</i></td></tr>
<tr><th id="152">152</th><td><i>	 * We have to flush all the executing contexts to main memory so</i></td></tr>
<tr><th id="153">153</th><td><i>	 * that they can saved in the hibernation image. To ensure the last</i></td></tr>
<tr><th id="154">154</th><td><i>	 * context image is coherent, we have to switch away from it. That</i></td></tr>
<tr><th id="155">155</th><td><i>	 * leaves the i915-&gt;kernel_context still active when</i></td></tr>
<tr><th id="156">156</th><td><i>	 * we actually suspend, and its image in memory may not match the GPU</i></td></tr>
<tr><th id="157">157</th><td><i>	 * state. Fortunately, the kernel_context is disposable and we do</i></td></tr>
<tr><th id="158">158</th><td><i>	 * not rely on its state.</i></td></tr>
<tr><th id="159">159</th><td><i>	 */</i></td></tr>
<tr><th id="160">160</th><td>	<a class="tu ref fn" href="#switch_to_kernel_context_sync" title='switch_to_kernel_context_sync' data-use='c' data-ref="switch_to_kernel_context_sync" data-ref-filename="switch_to_kernel_context_sync">switch_to_kernel_context_sync</a>(<a class="local col0 ref" href="#20i915" title='i915' data-ref="20i915" data-ref-filename="20i915">i915</a>);</td></tr>
<tr><th id="161">161</th><td></td></tr>
<tr><th id="162">162</th><td>	<a class="ref fn" href="../../../../../include/linux/mutex.h.html#mutex_unlock" title='mutex_unlock' data-ref="mutex_unlock" data-ref-filename="mutex_unlock">mutex_unlock</a>(&amp;<a class="local col0 ref" href="#20i915" title='i915' data-ref="20i915" data-ref-filename="20i915">i915</a>-&gt;<a class="ref field" href="../i915_drv.h.html#drm_i915_private::drm" title='drm_i915_private::drm' data-ref="drm_i915_private::drm" data-ref-filename="drm_i915_private..drm">drm</a>.<a class="ref field" href="../../../../../include/drm/drm_device.h.html#drm_device::struct_mutex" title='drm_device::struct_mutex' data-ref="drm_device::struct_mutex" data-ref-filename="drm_device..struct_mutex">struct_mutex</a>);</td></tr>
<tr><th id="163">163</th><td></td></tr>
<tr><th id="164">164</th><td>	<i>/*</i></td></tr>
<tr><th id="165">165</th><td><i>	 * Assert that we successfully flushed all the work and</i></td></tr>
<tr><th id="166">166</th><td><i>	 * reset the GPU back to its idle, low power state.</i></td></tr>
<tr><th id="167">167</th><td><i>	 */</i></td></tr>
<tr><th id="168">168</th><td>	<a class="macro" href="../i915_gem.h.html#56" title="((void)(sizeof(( long)(i915-&gt;gt.awake))))" data-ref="_M/GEM_BUG_ON">GEM_BUG_ON</a>(<a class="local col0 ref" href="#20i915" title='i915' data-ref="20i915" data-ref-filename="20i915">i915</a>-&gt;<a class="ref field" href="../i915_drv.h.html#drm_i915_private::gt" title='drm_i915_private::gt' data-ref="drm_i915_private::gt" data-ref-filename="drm_i915_private..gt">gt</a>.<a class="ref field" href="../i915_drv.h.html#drm_i915_private::(anonymous)::awake" title='drm_i915_private::(anonymous struct)::awake' data-ref="drm_i915_private::(anonymous)::awake" data-ref-filename="drm_i915_private..(anonymous)..awake">awake</a>);</td></tr>
<tr><th id="169">169</th><td>	<a class="ref fn" href="../../../../../include/linux/workqueue.h.html#flush_work" title='flush_work' data-ref="flush_work" data-ref-filename="flush_work">flush_work</a>(&amp;<a class="local col0 ref" href="#20i915" title='i915' data-ref="20i915" data-ref-filename="20i915">i915</a>-&gt;<a class="ref field" href="../i915_drv.h.html#drm_i915_private::gem" title='drm_i915_private::gem' data-ref="drm_i915_private::gem" data-ref-filename="drm_i915_private..gem">gem</a>.<a class="ref field" href="../i915_drv.h.html#drm_i915_private::(anonymous)::idle_work" title='drm_i915_private::(anonymous struct)::idle_work' data-ref="drm_i915_private::(anonymous)::idle_work" data-ref-filename="drm_i915_private..(anonymous)..idle_work">idle_work</a>);</td></tr>
<tr><th id="170">170</th><td></td></tr>
<tr><th id="171">171</th><td>	<a class="ref fn" href="../../../../../include/linux/workqueue.h.html#cancel_delayed_work_sync" title='cancel_delayed_work_sync' data-ref="cancel_delayed_work_sync" data-ref-filename="cancel_delayed_work_sync">cancel_delayed_work_sync</a>(&amp;<a class="local col0 ref" href="#20i915" title='i915' data-ref="20i915" data-ref-filename="20i915">i915</a>-&gt;<a class="ref field" href="../i915_drv.h.html#drm_i915_private::gpu_error" title='drm_i915_private::gpu_error' data-ref="drm_i915_private::gpu_error" data-ref-filename="drm_i915_private..gpu_error">gpu_error</a>.<a class="ref field" href="../i915_gpu_error.h.html#i915_gpu_error::hangcheck_work" title='i915_gpu_error::hangcheck_work' data-ref="i915_gpu_error::hangcheck_work" data-ref-filename="i915_gpu_error..hangcheck_work">hangcheck_work</a>);</td></tr>
<tr><th id="172">172</th><td></td></tr>
<tr><th id="173">173</th><td>	<a class="ref fn" href="../i915_drv.h.html#i915_gem_drain_freed_objects" title='i915_gem_drain_freed_objects' data-ref="i915_gem_drain_freed_objects" data-ref-filename="i915_gem_drain_freed_objects">i915_gem_drain_freed_objects</a>(<a class="local col0 ref" href="#20i915" title='i915' data-ref="20i915" data-ref-filename="20i915">i915</a>);</td></tr>
<tr><th id="174">174</th><td></td></tr>
<tr><th id="175">175</th><td>	<a class="ref fn" href="../intel_uc.h.html#intel_uc_suspend" title='intel_uc_suspend' data-ref="intel_uc_suspend" data-ref-filename="intel_uc_suspend">intel_uc_suspend</a>(<a class="local col0 ref" href="#20i915" title='i915' data-ref="20i915" data-ref-filename="20i915">i915</a>);</td></tr>
<tr><th id="176">176</th><td>}</td></tr>
<tr><th id="177">177</th><td></td></tr>
<tr><th id="178">178</th><td><em>static</em> <b>struct</b> <a class="type" href="i915_gem_object_types.h.html#drm_i915_gem_object" title='drm_i915_gem_object' data-ref="drm_i915_gem_object" data-ref-filename="drm_i915_gem_object">drm_i915_gem_object</a> *<dfn class="tu decl def fn" id="first_mm_object" title='first_mm_object' data-type='struct drm_i915_gem_object * first_mm_object(struct list_head * list)' data-ref="first_mm_object" data-ref-filename="first_mm_object">first_mm_object</dfn>(<b>struct</b> <a class="type" href="../../../../../include/linux/types.h.html#list_head" title='list_head' data-ref="list_head" data-ref-filename="list_head">list_head</a> *<dfn class="local col1 decl" id="21list" title='list' data-type='struct list_head *' data-ref="21list" data-ref-filename="21list">list</dfn>)</td></tr>
<tr><th id="179">179</th><td>{</td></tr>
<tr><th id="180">180</th><td>	<b>return</b> <a class="macro" href="../../../../../include/linux/list.h.html#511" title="({ struct list_head *head__ = (list); struct list_head *pos__ = ({ union { typeof(head__-&gt;next) __val; char __c[1]; } __u; if (1) __read_once_size(&amp;(head__-&gt;next), __u.__c, sizeof(head__-&gt;next)); else __read_once_size_nocheck(&amp;(head__-&gt;next), __u.__c, sizeof(head__-&gt;next)); do { } while (0); __u.__val; }); pos__ != head__ ? ({ void *__mptr = (void *)(pos__); do { extern void __compiletime_assert_182(void) ; if (!(!(!__builtin_types_compatible_p(typeof(*(pos__)), typeof(((struct drm_i915_gem_object *)0)-&gt;mm.link)) &amp;&amp; !__builtin_types_compatible_p(typeof(*(pos__)), typeof(void))))) __compiletime_assert_182(); } while (0); ((struct drm_i915_gem_object *)(__mptr - __builtin_offsetof(struct drm_i915_gem_object, mm.link))); }) : ((void *)0); })" data-ref="_M/list_first_entry_or_null">list_first_entry_or_null</a>(<a class="local col1 ref" href="#21list" title='list' data-ref="21list" data-ref-filename="21list">list</a>,</td></tr>
<tr><th id="181">181</th><td>					<b>struct</b> <a class="type" href="i915_gem_object_types.h.html#drm_i915_gem_object" title='drm_i915_gem_object' data-ref="drm_i915_gem_object" data-ref-filename="drm_i915_gem_object">drm_i915_gem_object</a>,</td></tr>
<tr><th id="182">182</th><td>					<a class="ref field" href="i915_gem_object_types.h.html#drm_i915_gem_object::mm" title='drm_i915_gem_object::mm' data-ref="drm_i915_gem_object::mm" data-ref-filename="drm_i915_gem_object..mm">mm</a>.<a class="ref field" href="i915_gem_object_types.h.html#drm_i915_gem_object::(anonymous)::link" title='drm_i915_gem_object::(anonymous struct)::link' data-ref="drm_i915_gem_object::(anonymous)::link" data-ref-filename="drm_i915_gem_object..(anonymous)..link">link</a>);</td></tr>
<tr><th id="183">183</th><td>}</td></tr>
<tr><th id="184">184</th><td></td></tr>
<tr><th id="185">185</th><td><em>void</em> <dfn class="decl def fn" id="i915_gem_suspend_late" title='i915_gem_suspend_late' data-ref="i915_gem_suspend_late" data-ref-filename="i915_gem_suspend_late">i915_gem_suspend_late</dfn>(<b>struct</b> <a class="type" href="../i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col2 decl" id="22i915" title='i915' data-type='struct drm_i915_private *' data-ref="22i915" data-ref-filename="22i915">i915</dfn>)</td></tr>
<tr><th id="186">186</th><td>{</td></tr>
<tr><th id="187">187</th><td>	<b>struct</b> <a class="type" href="i915_gem_object_types.h.html#drm_i915_gem_object" title='drm_i915_gem_object' data-ref="drm_i915_gem_object" data-ref-filename="drm_i915_gem_object">drm_i915_gem_object</a> *<dfn class="local col3 decl" id="23obj" title='obj' data-type='struct drm_i915_gem_object *' data-ref="23obj" data-ref-filename="23obj">obj</dfn>;</td></tr>
<tr><th id="188">188</th><td>	<b>struct</b> <a class="type" href="../../../../../include/linux/types.h.html#list_head" title='list_head' data-ref="list_head" data-ref-filename="list_head">list_head</a> *<dfn class="local col4 decl" id="24phases" title='phases' data-type='struct list_head *[3]' data-ref="24phases" data-ref-filename="24phases">phases</dfn>[] = {</td></tr>
<tr><th id="189">189</th><td>		&amp;<a class="local col2 ref" href="#22i915" title='i915' data-ref="22i915" data-ref-filename="22i915">i915</a>-&gt;<a class="ref field" href="../i915_drv.h.html#drm_i915_private::mm" title='drm_i915_private::mm' data-ref="drm_i915_private::mm" data-ref-filename="drm_i915_private..mm">mm</a>.<a class="ref field" href="../i915_drv.h.html#i915_gem_mm::shrink_list" title='i915_gem_mm::shrink_list' data-ref="i915_gem_mm::shrink_list" data-ref-filename="i915_gem_mm..shrink_list">shrink_list</a>,</td></tr>
<tr><th id="190">190</th><td>		&amp;<a class="local col2 ref" href="#22i915" title='i915' data-ref="22i915" data-ref-filename="22i915">i915</a>-&gt;<a class="ref field" href="../i915_drv.h.html#drm_i915_private::mm" title='drm_i915_private::mm' data-ref="drm_i915_private::mm" data-ref-filename="drm_i915_private..mm">mm</a>.<a class="ref field" href="../i915_drv.h.html#i915_gem_mm::purge_list" title='i915_gem_mm::purge_list' data-ref="i915_gem_mm::purge_list" data-ref-filename="i915_gem_mm..purge_list">purge_list</a>,</td></tr>
<tr><th id="191">191</th><td>		<a class="macro" href="../../../../../include/linux/stddef.h.html#8" title="((void *)0)" data-ref="_M/NULL">NULL</a></td></tr>
<tr><th id="192">192</th><td>	}, **<dfn class="local col5 decl" id="25phase" title='phase' data-type='struct list_head **' data-ref="25phase" data-ref-filename="25phase">phase</dfn>;</td></tr>
<tr><th id="193">193</th><td>	<em>unsigned</em> <em>long</em> <dfn class="local col6 decl" id="26flags" title='flags' data-type='unsigned long' data-ref="26flags" data-ref-filename="26flags">flags</dfn>;</td></tr>
<tr><th id="194">194</th><td></td></tr>
<tr><th id="195">195</th><td>	<i>/*</i></td></tr>
<tr><th id="196">196</th><td><i>	 * Neither the BIOS, ourselves or any other kernel</i></td></tr>
<tr><th id="197">197</th><td><i>	 * expects the system to be in execlists mode on startup,</i></td></tr>
<tr><th id="198">198</th><td><i>	 * so we need to reset the GPU back to legacy mode. And the only</i></td></tr>
<tr><th id="199">199</th><td><i>	 * known way to disable logical contexts is through a GPU reset.</i></td></tr>
<tr><th id="200">200</th><td><i>	 *</i></td></tr>
<tr><th id="201">201</th><td><i>	 * So in order to leave the system in a known default configuration,</i></td></tr>
<tr><th id="202">202</th><td><i>	 * always reset the GPU upon unload and suspend. Afterwards we then</i></td></tr>
<tr><th id="203">203</th><td><i>	 * clean up the GEM state tracking, flushing off the requests and</i></td></tr>
<tr><th id="204">204</th><td><i>	 * leaving the system in a known idle state.</i></td></tr>
<tr><th id="205">205</th><td><i>	 *</i></td></tr>
<tr><th id="206">206</th><td><i>	 * Note that is of the upmost importance that the GPU is idle and</i></td></tr>
<tr><th id="207">207</th><td><i>	 * all stray writes are flushed *before* we dismantle the backing</i></td></tr>
<tr><th id="208">208</th><td><i>	 * storage for the pinned objects.</i></td></tr>
<tr><th id="209">209</th><td><i>	 *</i></td></tr>
<tr><th id="210">210</th><td><i>	 * However, since we are uncertain that resetting the GPU on older</i></td></tr>
<tr><th id="211">211</th><td><i>	 * machines is a good idea, we don't - just in case it leaves the</i></td></tr>
<tr><th id="212">212</th><td><i>	 * machine in an unusable condition.</i></td></tr>
<tr><th id="213">213</th><td><i>	 */</i></td></tr>
<tr><th id="214">214</th><td></td></tr>
<tr><th id="215">215</th><td>	<a class="macro" href="../../../../../include/linux/spinlock.h.html#366" title="do { do { ({ unsigned long __dummy; typeof(flags) __dummy2; (void)(&amp;__dummy == &amp;__dummy2); 1; }); flags = _raw_spin_lock_irqsave(spinlock_check(&amp;i915-&gt;mm.obj_lock)); } while (0); } while (0)" data-ref="_M/spin_lock_irqsave">spin_lock_irqsave</a>(&amp;<a class="local col2 ref" href="#22i915" title='i915' data-ref="22i915" data-ref-filename="22i915">i915</a>-&gt;<a class="ref field" href="../i915_drv.h.html#drm_i915_private::mm" title='drm_i915_private::mm' data-ref="drm_i915_private::mm" data-ref-filename="drm_i915_private..mm">mm</a>.<a class="ref field" href="../i915_drv.h.html#i915_gem_mm::obj_lock" title='i915_gem_mm::obj_lock' data-ref="i915_gem_mm::obj_lock" data-ref-filename="i915_gem_mm..obj_lock">obj_lock</a>, <a class="local col6 ref" href="#26flags" title='flags' data-ref="26flags" data-ref-filename="26flags">flags</a>);</td></tr>
<tr><th id="216">216</th><td>	<b>for</b> (<a class="local col5 ref" href="#25phase" title='phase' data-ref="25phase" data-ref-filename="25phase">phase</a> = <a class="local col4 ref" href="#24phases" title='phases' data-ref="24phases" data-ref-filename="24phases">phases</a>; *<a class="local col5 ref" href="#25phase" title='phase' data-ref="25phase" data-ref-filename="25phase">phase</a>; <a class="local col5 ref" href="#25phase" title='phase' data-ref="25phase" data-ref-filename="25phase">phase</a>++) {</td></tr>
<tr><th id="217">217</th><td>		<a class="macro" href="../../../../../include/linux/list.h.html#23" title="struct list_head keep = { &amp;(keep), &amp;(keep) }" data-ref="_M/LIST_HEAD">LIST_HEAD</a>(<dfn class="local col7 decl" id="27keep" title='keep' data-type='struct list_head' data-ref="27keep" data-ref-filename="27keep"><a class="local col7 ref" href="#217" title='keep' data-ref="27keep" data-ref-filename="27keep"><a class="local col7 ref" href="#217" title='keep' data-ref="27keep" data-ref-filename="27keep"><a class="local col7 ref" href="#217" title='keep' data-ref="27keep" data-ref-filename="27keep"><a class="local col7 ref" href="#217" title='keep' data-ref="27keep" data-ref-filename="27keep">keep</a></a></a></a></dfn>);</td></tr>
<tr><th id="218">218</th><td></td></tr>
<tr><th id="219">219</th><td>		<b>while</b> ((<a class="local col3 ref" href="#23obj" title='obj' data-ref="23obj" data-ref-filename="23obj">obj</a> = <a class="tu ref fn" href="#first_mm_object" title='first_mm_object' data-use='c' data-ref="first_mm_object" data-ref-filename="first_mm_object">first_mm_object</a>(*<a class="local col5 ref" href="#25phase" title='phase' data-ref="25phase" data-ref-filename="25phase">phase</a>))) {</td></tr>
<tr><th id="220">220</th><td>			<a class="ref fn" href="../../../../../include/linux/list.h.html#list_move_tail" title='list_move_tail' data-ref="list_move_tail" data-ref-filename="list_move_tail">list_move_tail</a>(&amp;<a class="local col3 ref" href="#23obj" title='obj' data-ref="23obj" data-ref-filename="23obj">obj</a>-&gt;<a class="ref field" href="i915_gem_object_types.h.html#drm_i915_gem_object::mm" title='drm_i915_gem_object::mm' data-ref="drm_i915_gem_object::mm" data-ref-filename="drm_i915_gem_object..mm">mm</a>.<a class="ref field" href="i915_gem_object_types.h.html#drm_i915_gem_object::(anonymous)::link" title='drm_i915_gem_object::(anonymous struct)::link' data-ref="drm_i915_gem_object::(anonymous)::link" data-ref-filename="drm_i915_gem_object..(anonymous)..link">link</a>, &amp;<a class="local col7 ref" href="#217" title='keep' data-ref="27keep" data-ref-filename="27keep">keep</a>);</td></tr>
<tr><th id="221">221</th><td></td></tr>
<tr><th id="222">222</th><td>			<i>/* Beware the background _i915_gem_free_objects */</i></td></tr>
<tr><th id="223">223</th><td>			<b>if</b> (!<a class="ref fn" href="../../../../../include/linux/kref.h.html#kref_get_unless_zero" title='kref_get_unless_zero' data-ref="kref_get_unless_zero" data-ref-filename="kref_get_unless_zero">kref_get_unless_zero</a>(&amp;<a class="local col3 ref" href="#23obj" title='obj' data-ref="23obj" data-ref-filename="23obj">obj</a>-&gt;<a class="ref field" href="i915_gem_object_types.h.html#drm_i915_gem_object::base" title='drm_i915_gem_object::base' data-ref="drm_i915_gem_object::base" data-ref-filename="drm_i915_gem_object..base">base</a>.<a class="ref field" href="../../../../../include/drm/drm_gem.h.html#drm_gem_object::refcount" title='drm_gem_object::refcount' data-ref="drm_gem_object::refcount" data-ref-filename="drm_gem_object..refcount">refcount</a>))</td></tr>
<tr><th id="224">224</th><td>				<b>continue</b>;</td></tr>
<tr><th id="225">225</th><td></td></tr>
<tr><th id="226">226</th><td>			<a class="ref fn" href="../../../../../include/linux/spinlock.h.html#spin_unlock_irqrestore" title='spin_unlock_irqrestore' data-ref="spin_unlock_irqrestore" data-ref-filename="spin_unlock_irqrestore">spin_unlock_irqrestore</a>(&amp;<a class="local col2 ref" href="#22i915" title='i915' data-ref="22i915" data-ref-filename="22i915">i915</a>-&gt;<a class="ref field" href="../i915_drv.h.html#drm_i915_private::mm" title='drm_i915_private::mm' data-ref="drm_i915_private::mm" data-ref-filename="drm_i915_private..mm">mm</a>.<a class="ref field" href="../i915_drv.h.html#i915_gem_mm::obj_lock" title='i915_gem_mm::obj_lock' data-ref="i915_gem_mm::obj_lock" data-ref-filename="i915_gem_mm..obj_lock">obj_lock</a>, <a class="local col6 ref" href="#26flags" title='flags' data-ref="26flags" data-ref-filename="26flags">flags</a>);</td></tr>
<tr><th id="227">227</th><td></td></tr>
<tr><th id="228">228</th><td>			<a class="ref fn" href="i915_gem_object.h.html#i915_gem_object_lock" title='i915_gem_object_lock' data-ref="i915_gem_object_lock" data-ref-filename="i915_gem_object_lock">i915_gem_object_lock</a>(<a class="local col3 ref" href="#23obj" title='obj' data-ref="23obj" data-ref-filename="23obj">obj</a>);</td></tr>
<tr><th id="229">229</th><td>			<a class="macro" href="../i915_utils.h.html#43" title="({ int __ret_warn_on = !!((i915_gem_object_set_to_gtt_domain(obj, false))); if (__builtin_expect(!!(__ret_warn_on), 0)) do { __warn_printk(&quot;%s&quot;, &quot;WARN_ON(&quot; &quot;i915_gem_object_set_to_gtt_domain(obj, false)&quot; &quot;)&quot;); do { do { asm volatile(&quot;1:\t&quot; &quot;.byte 0x0f, 0x0b&quot; &quot;\n&quot; &quot;.pushsection __bug_table,\&quot;aw\&quot;\n&quot; &quot;2:\t&quot; &quot;.long &quot; &quot;1b&quot; &quot; - 2b&quot; &quot;\t# bug_entry::bug_addr\n&quot; &quot;\t&quot; &quot;.long &quot; &quot;%c0&quot; &quot; - 2b&quot; &quot;\t# bug_entry::file\n&quot; &quot;\t.word %c1&quot; &quot;\t# bug_entry::line\n&quot; &quot;\t.word %c2&quot; &quot;\t# bug_entry::flags\n&quot; &quot;\t.org 2b+%c3\n&quot; &quot;.popsection&quot; : : &quot;i&quot; (&quot;/home/woboq/linux-5.3.1/drivers/gpu/drm/i915/gem/i915_gem_pm.c&quot;), &quot;i&quot; (229), &quot;i&quot; ((1 &lt;&lt; 0)|(((9) &lt;&lt; 8))), &quot;i&quot; (sizeof(struct bug_entry))); } while (0); ({ asm volatile(&quot;%c0:\n\t&quot; &quot;.pushsection .discard.reachable\n\t&quot; &quot;.long %c0b - .\n\t&quot; &quot;.popsection\n\t&quot; : : &quot;i&quot; (198)); }); } while (0); } while (0); __builtin_expect(!!(__ret_warn_on), 0); })" data-ref="_M/WARN_ON">WARN_ON</a>(<a class="ref fn" href="i915_gem_object.h.html#i915_gem_object_set_to_gtt_domain" title='i915_gem_object_set_to_gtt_domain' data-ref="i915_gem_object_set_to_gtt_domain" data-ref-filename="i915_gem_object_set_to_gtt_domain">i915_gem_object_set_to_gtt_domain</a>(<a class="local col3 ref" href="#23obj" title='obj' data-ref="23obj" data-ref-filename="23obj">obj</a>, <a class="enum" href="../../../../../include/linux/stddef.h.html#false" title='false' data-ref="false" data-ref-filename="false">false</a>));</td></tr>
<tr><th id="230">230</th><td>			<a class="ref fn" href="i915_gem_object.h.html#i915_gem_object_unlock" title='i915_gem_object_unlock' data-ref="i915_gem_object_unlock" data-ref-filename="i915_gem_object_unlock">i915_gem_object_unlock</a>(<a class="local col3 ref" href="#23obj" title='obj' data-ref="23obj" data-ref-filename="23obj">obj</a>);</td></tr>
<tr><th id="231">231</th><td>			<a class="ref fn" href="i915_gem_object.h.html#i915_gem_object_put" title='i915_gem_object_put' data-ref="i915_gem_object_put" data-ref-filename="i915_gem_object_put">i915_gem_object_put</a>(<a class="local col3 ref" href="#23obj" title='obj' data-ref="23obj" data-ref-filename="23obj">obj</a>);</td></tr>
<tr><th id="232">232</th><td></td></tr>
<tr><th id="233">233</th><td>			<a class="macro" href="../../../../../include/linux/spinlock.h.html#366" title="do { do { ({ unsigned long __dummy; typeof(flags) __dummy2; (void)(&amp;__dummy == &amp;__dummy2); 1; }); flags = _raw_spin_lock_irqsave(spinlock_check(&amp;i915-&gt;mm.obj_lock)); } while (0); } while (0)" data-ref="_M/spin_lock_irqsave">spin_lock_irqsave</a>(&amp;<a class="local col2 ref" href="#22i915" title='i915' data-ref="22i915" data-ref-filename="22i915">i915</a>-&gt;<a class="ref field" href="../i915_drv.h.html#drm_i915_private::mm" title='drm_i915_private::mm' data-ref="drm_i915_private::mm" data-ref-filename="drm_i915_private..mm">mm</a>.<a class="ref field" href="../i915_drv.h.html#i915_gem_mm::obj_lock" title='i915_gem_mm::obj_lock' data-ref="i915_gem_mm::obj_lock" data-ref-filename="i915_gem_mm..obj_lock">obj_lock</a>, <a class="local col6 ref" href="#26flags" title='flags' data-ref="26flags" data-ref-filename="26flags">flags</a>);</td></tr>
<tr><th id="234">234</th><td>		}</td></tr>
<tr><th id="235">235</th><td></td></tr>
<tr><th id="236">236</th><td>		<a class="ref fn" href="../../../../../include/linux/list.h.html#list_splice_tail" title='list_splice_tail' data-ref="list_splice_tail" data-ref-filename="list_splice_tail">list_splice_tail</a>(&amp;<a class="local col7 ref" href="#217" title='keep' data-ref="27keep" data-ref-filename="27keep">keep</a>, *<a class="local col5 ref" href="#25phase" title='phase' data-ref="25phase" data-ref-filename="25phase">phase</a>);</td></tr>
<tr><th id="237">237</th><td>	}</td></tr>
<tr><th id="238">238</th><td>	<a class="ref fn" href="../../../../../include/linux/spinlock.h.html#spin_unlock_irqrestore" title='spin_unlock_irqrestore' data-ref="spin_unlock_irqrestore" data-ref-filename="spin_unlock_irqrestore">spin_unlock_irqrestore</a>(&amp;<a class="local col2 ref" href="#22i915" title='i915' data-ref="22i915" data-ref-filename="22i915">i915</a>-&gt;<a class="ref field" href="../i915_drv.h.html#drm_i915_private::mm" title='drm_i915_private::mm' data-ref="drm_i915_private::mm" data-ref-filename="drm_i915_private..mm">mm</a>.<a class="ref field" href="../i915_drv.h.html#i915_gem_mm::obj_lock" title='i915_gem_mm::obj_lock' data-ref="i915_gem_mm::obj_lock" data-ref-filename="i915_gem_mm..obj_lock">obj_lock</a>, <a class="local col6 ref" href="#26flags" title='flags' data-ref="26flags" data-ref-filename="26flags">flags</a>);</td></tr>
<tr><th id="239">239</th><td></td></tr>
<tr><th id="240">240</th><td>	<a class="ref fn" href="../intel_uc.h.html#intel_uc_sanitize" title='intel_uc_sanitize' data-ref="intel_uc_sanitize" data-ref-filename="intel_uc_sanitize">intel_uc_sanitize</a>(<a class="local col2 ref" href="#22i915" title='i915' data-ref="22i915" data-ref-filename="22i915">i915</a>);</td></tr>
<tr><th id="241">241</th><td>	<a class="ref fn" href="../i915_drv.h.html#i915_gem_sanitize" title='i915_gem_sanitize' data-ref="i915_gem_sanitize" data-ref-filename="i915_gem_sanitize">i915_gem_sanitize</a>(<a class="local col2 ref" href="#22i915" title='i915' data-ref="22i915" data-ref-filename="22i915">i915</a>);</td></tr>
<tr><th id="242">242</th><td>}</td></tr>
<tr><th id="243">243</th><td></td></tr>
<tr><th id="244">244</th><td><em>void</em> <dfn class="decl def fn" id="i915_gem_resume" title='i915_gem_resume' data-ref="i915_gem_resume" data-ref-filename="i915_gem_resume">i915_gem_resume</dfn>(<b>struct</b> <a class="type" href="../i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col8 decl" id="28i915" title='i915' data-type='struct drm_i915_private *' data-ref="28i915" data-ref-filename="28i915">i915</dfn>)</td></tr>
<tr><th id="245">245</th><td>{</td></tr>
<tr><th id="246">246</th><td>	<a class="macro" href="../i915_gem.h.html#71" title="do { } while (0)" data-ref="_M/GEM_TRACE">GEM_TRACE</a>(<q>"\n"</q>);</td></tr>
<tr><th id="247">247</th><td></td></tr>
<tr><th id="248">248</th><td>	<a class="macro" href="../i915_utils.h.html#43" title="({ int __ret_warn_on = !!((i915-&gt;gt.awake)); if (__builtin_expect(!!(__ret_warn_on), 0)) do { __warn_printk(&quot;%s&quot;, &quot;WARN_ON(&quot; &quot;i915-&gt;gt.awake&quot; &quot;)&quot;); do { do { asm volatile(&quot;1:\t&quot; &quot;.byte 0x0f, 0x0b&quot; &quot;\n&quot; &quot;.pushsection __bug_table,\&quot;aw\&quot;\n&quot; &quot;2:\t&quot; &quot;.long &quot; &quot;1b&quot; &quot; - 2b&quot; &quot;\t# bug_entry::bug_addr\n&quot; &quot;\t&quot; &quot;.long &quot; &quot;%c0&quot; &quot; - 2b&quot; &quot;\t# bug_entry::file\n&quot; &quot;\t.word %c1&quot; &quot;\t# bug_entry::line\n&quot; &quot;\t.word %c2&quot; &quot;\t# bug_entry::flags\n&quot; &quot;\t.org 2b+%c3\n&quot; &quot;.popsection&quot; : : &quot;i&quot; (&quot;/home/woboq/linux-5.3.1/drivers/gpu/drm/i915/gem/i915_gem_pm.c&quot;), &quot;i&quot; (248), &quot;i&quot; ((1 &lt;&lt; 0)|(((9) &lt;&lt; 8))), &quot;i&quot; (sizeof(struct bug_entry))); } while (0); ({ asm volatile(&quot;%c0:\n\t&quot; &quot;.pushsection .discard.reachable\n\t&quot; &quot;.long %c0b - .\n\t&quot; &quot;.popsection\n\t&quot; : : &quot;i&quot; (200)); }); } while (0); } while (0); __builtin_expect(!!(__ret_warn_on), 0); })" data-ref="_M/WARN_ON">WARN_ON</a>(<a class="local col8 ref" href="#28i915" title='i915' data-ref="28i915" data-ref-filename="28i915">i915</a>-&gt;<a class="ref field" href="../i915_drv.h.html#drm_i915_private::gt" title='drm_i915_private::gt' data-ref="drm_i915_private::gt" data-ref-filename="drm_i915_private..gt">gt</a>.<a class="ref field" href="../i915_drv.h.html#drm_i915_private::(anonymous)::awake" title='drm_i915_private::(anonymous struct)::awake' data-ref="drm_i915_private::(anonymous)::awake" data-ref-filename="drm_i915_private..(anonymous)..awake">awake</a>);</td></tr>
<tr><th id="249">249</th><td></td></tr>
<tr><th id="250">250</th><td>	<a class="ref fn" href="../../../../../include/linux/mutex.h.html#mutex_lock" title='mutex_lock' data-ref="mutex_lock" data-ref-filename="mutex_lock">mutex_lock</a>(&amp;<a class="local col8 ref" href="#28i915" title='i915' data-ref="28i915" data-ref-filename="28i915">i915</a>-&gt;<a class="ref field" href="../i915_drv.h.html#drm_i915_private::drm" title='drm_i915_private::drm' data-ref="drm_i915_private::drm" data-ref-filename="drm_i915_private..drm">drm</a>.<a class="ref field" href="../../../../../include/drm/drm_device.h.html#drm_device::struct_mutex" title='drm_device::struct_mutex' data-ref="drm_device::struct_mutex" data-ref-filename="drm_device..struct_mutex">struct_mutex</a>);</td></tr>
<tr><th id="251">251</th><td>	<a class="ref fn" href="../intel_uncore.h.html#intel_uncore_forcewake_get" title='intel_uncore_forcewake_get' data-ref="intel_uncore_forcewake_get" data-ref-filename="intel_uncore_forcewake_get">intel_uncore_forcewake_get</a>(&amp;<a class="local col8 ref" href="#28i915" title='i915' data-ref="28i915" data-ref-filename="28i915">i915</a>-&gt;<a class="ref field" href="../i915_drv.h.html#drm_i915_private::uncore" title='drm_i915_private::uncore' data-ref="drm_i915_private::uncore" data-ref-filename="drm_i915_private..uncore">uncore</a>, <a class="enum" href="../intel_uncore.h.html#FORCEWAKE_ALL" title='FORCEWAKE_ALL' data-ref="FORCEWAKE_ALL" data-ref-filename="FORCEWAKE_ALL">FORCEWAKE_ALL</a>);</td></tr>
<tr><th id="252">252</th><td></td></tr>
<tr><th id="253">253</th><td>	<a class="ref fn" href="../i915_gem_gtt.h.html#i915_gem_restore_gtt_mappings" title='i915_gem_restore_gtt_mappings' data-ref="i915_gem_restore_gtt_mappings" data-ref-filename="i915_gem_restore_gtt_mappings">i915_gem_restore_gtt_mappings</a>(<a class="local col8 ref" href="#28i915" title='i915' data-ref="28i915" data-ref-filename="28i915">i915</a>);</td></tr>
<tr><th id="254">254</th><td>	<a class="ref fn" href="../i915_gem_fence_reg.h.html#i915_gem_restore_fences" title='i915_gem_restore_fences' data-ref="i915_gem_restore_fences" data-ref-filename="i915_gem_restore_fences">i915_gem_restore_fences</a>(<a class="local col8 ref" href="#28i915" title='i915' data-ref="28i915" data-ref-filename="28i915">i915</a>);</td></tr>
<tr><th id="255">255</th><td></td></tr>
<tr><th id="256">256</th><td>	<b>if</b> (<a class="ref fn" href="../i915_drv.h.html#i915_gem_init_hw" title='i915_gem_init_hw' data-ref="i915_gem_init_hw" data-ref-filename="i915_gem_init_hw">i915_gem_init_hw</a>(<a class="local col8 ref" href="#28i915" title='i915' data-ref="28i915" data-ref-filename="28i915">i915</a>))</td></tr>
<tr><th id="257">257</th><td>		<b>goto</b> <a class="lbl" href="#29err_wedged" data-ref="29err_wedged" data-ref-filename="29err_wedged">err_wedged</a>;</td></tr>
<tr><th id="258">258</th><td></td></tr>
<tr><th id="259">259</th><td>	<i>/*</i></td></tr>
<tr><th id="260">260</th><td><i>	 * As we didn't flush the kernel context before suspend, we cannot</i></td></tr>
<tr><th id="261">261</th><td><i>	 * guarantee that the context image is complete. So let's just reset</i></td></tr>
<tr><th id="262">262</th><td><i>	 * it and start again.</i></td></tr>
<tr><th id="263">263</th><td><i>	 */</i></td></tr>
<tr><th id="264">264</th><td>	<b>if</b> (<a class="ref fn" href="../gt/intel_gt_pm.h.html#intel_gt_resume" title='intel_gt_resume' data-ref="intel_gt_resume" data-ref-filename="intel_gt_resume">intel_gt_resume</a>(<a class="local col8 ref" href="#28i915" title='i915' data-ref="28i915" data-ref-filename="28i915">i915</a>))</td></tr>
<tr><th id="265">265</th><td>		<b>goto</b> <a class="lbl" href="#29err_wedged" data-ref="29err_wedged" data-ref-filename="29err_wedged">err_wedged</a>;</td></tr>
<tr><th id="266">266</th><td></td></tr>
<tr><th id="267">267</th><td>	<a class="ref fn" href="../intel_uc.h.html#intel_uc_resume" title='intel_uc_resume' data-ref="intel_uc_resume" data-ref-filename="intel_uc_resume">intel_uc_resume</a>(<a class="local col8 ref" href="#28i915" title='i915' data-ref="28i915" data-ref-filename="28i915">i915</a>);</td></tr>
<tr><th id="268">268</th><td></td></tr>
<tr><th id="269">269</th><td>	<i>/* Always reload a context for powersaving. */</i></td></tr>
<tr><th id="270">270</th><td>	<b>if</b> (!<a class="ref fn" href="#i915_gem_load_power_context" title='i915_gem_load_power_context' data-ref="i915_gem_load_power_context" data-ref-filename="i915_gem_load_power_context">i915_gem_load_power_context</a>(<a class="local col8 ref" href="#28i915" title='i915' data-ref="28i915" data-ref-filename="28i915">i915</a>))</td></tr>
<tr><th id="271">271</th><td>		<b>goto</b> <a class="lbl" href="#29err_wedged" data-ref="29err_wedged" data-ref-filename="29err_wedged">err_wedged</a>;</td></tr>
<tr><th id="272">272</th><td></td></tr>
<tr><th id="273">273</th><td><dfn class="lbl" id="30out_unlock" data-ref="30out_unlock" data-ref-filename="30out_unlock">out_unlock</dfn>:</td></tr>
<tr><th id="274">274</th><td>	<a class="ref fn" href="../intel_uncore.h.html#intel_uncore_forcewake_put" title='intel_uncore_forcewake_put' data-ref="intel_uncore_forcewake_put" data-ref-filename="intel_uncore_forcewake_put">intel_uncore_forcewake_put</a>(&amp;<a class="local col8 ref" href="#28i915" title='i915' data-ref="28i915" data-ref-filename="28i915">i915</a>-&gt;<a class="ref field" href="../i915_drv.h.html#drm_i915_private::uncore" title='drm_i915_private::uncore' data-ref="drm_i915_private::uncore" data-ref-filename="drm_i915_private..uncore">uncore</a>, <a class="enum" href="../intel_uncore.h.html#FORCEWAKE_ALL" title='FORCEWAKE_ALL' data-ref="FORCEWAKE_ALL" data-ref-filename="FORCEWAKE_ALL">FORCEWAKE_ALL</a>);</td></tr>
<tr><th id="275">275</th><td>	<a class="ref fn" href="../../../../../include/linux/mutex.h.html#mutex_unlock" title='mutex_unlock' data-ref="mutex_unlock" data-ref-filename="mutex_unlock">mutex_unlock</a>(&amp;<a class="local col8 ref" href="#28i915" title='i915' data-ref="28i915" data-ref-filename="28i915">i915</a>-&gt;<a class="ref field" href="../i915_drv.h.html#drm_i915_private::drm" title='drm_i915_private::drm' data-ref="drm_i915_private::drm" data-ref-filename="drm_i915_private..drm">drm</a>.<a class="ref field" href="../../../../../include/drm/drm_device.h.html#drm_device::struct_mutex" title='drm_device::struct_mutex' data-ref="drm_device::struct_mutex" data-ref-filename="drm_device..struct_mutex">struct_mutex</a>);</td></tr>
<tr><th id="276">276</th><td>	<b>return</b>;</td></tr>
<tr><th id="277">277</th><td></td></tr>
<tr><th id="278">278</th><td><dfn class="lbl" id="29err_wedged" data-ref="29err_wedged" data-ref-filename="29err_wedged">err_wedged</dfn>:</td></tr>
<tr><th id="279">279</th><td>	<b>if</b> (!<a class="ref fn" href="../i915_drv.h.html#i915_reset_failed" title='i915_reset_failed' data-ref="i915_reset_failed" data-ref-filename="i915_reset_failed">i915_reset_failed</a>(<a class="local col8 ref" href="#28i915" title='i915' data-ref="28i915" data-ref-filename="28i915">i915</a>)) {</td></tr>
<tr><th id="280">280</th><td>		<a class="macro" href="../../../../../include/linux/device.h.html#1498" title="_dev_err(i915-&gt;drm.dev, &quot;Failed to re-initialize GPU, declaring it wedged!\n&quot;)" data-ref="_M/dev_err">dev_err</a>(<a class="local col8 ref" href="#28i915" title='i915' data-ref="28i915" data-ref-filename="28i915">i915</a>-&gt;<a class="ref field" href="../i915_drv.h.html#drm_i915_private::drm" title='drm_i915_private::drm' data-ref="drm_i915_private::drm" data-ref-filename="drm_i915_private..drm">drm</a>.<a class="ref field" href="../../../../../include/drm/drm_device.h.html#drm_device::dev" title='drm_device::dev' data-ref="drm_device::dev" data-ref-filename="drm_device..dev">dev</a>,</td></tr>
<tr><th id="281">281</th><td>			<q>"Failed to re-initialize GPU, declaring it wedged!\n"</q>);</td></tr>
<tr><th id="282">282</th><td>		<a class="ref fn" href="../i915_drv.h.html#i915_gem_set_wedged" title='i915_gem_set_wedged' data-ref="i915_gem_set_wedged" data-ref-filename="i915_gem_set_wedged">i915_gem_set_wedged</a>(<a class="local col8 ref" href="#28i915" title='i915' data-ref="28i915" data-ref-filename="28i915">i915</a>);</td></tr>
<tr><th id="283">283</th><td>	}</td></tr>
<tr><th id="284">284</th><td>	<b>goto</b> <a class="lbl" href="#30out_unlock" data-ref="30out_unlock" data-ref-filename="30out_unlock">out_unlock</a>;</td></tr>
<tr><th id="285">285</th><td>}</td></tr>
<tr><th id="286">286</th><td></td></tr>
<tr><th id="287">287</th><td><em>void</em> <dfn class="decl def fn" id="i915_gem_init__pm" title='i915_gem_init__pm' data-ref="i915_gem_init__pm" data-ref-filename="i915_gem_init__pm">i915_gem_init__pm</dfn>(<b>struct</b> <a class="type" href="../i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col1 decl" id="31i915" title='i915' data-type='struct drm_i915_private *' data-ref="31i915" data-ref-filename="31i915">i915</dfn>)</td></tr>
<tr><th id="288">288</th><td>{</td></tr>
<tr><th id="289">289</th><td>	<a class="macro" href="../../../../../include/linux/workqueue.h.html#249" title="do { __init_work(((&amp;i915-&gt;gem.idle_work)), 0); ((&amp;i915-&gt;gem.idle_work))-&gt;data = (atomic_long_t) { ((unsigned long)WORK_STRUCT_NO_POOL) }; INIT_LIST_HEAD(&amp;((&amp;i915-&gt;gem.idle_work))-&gt;entry); ((&amp;i915-&gt;gem.idle_work))-&gt;func = ((idle_work_handler)); } while (0)" data-ref="_M/INIT_WORK">INIT_WORK</a>(&amp;<a class="local col1 ref" href="#31i915" title='i915' data-ref="31i915" data-ref-filename="31i915">i915</a>-&gt;<a class="ref field" href="../i915_drv.h.html#drm_i915_private::gem" title='drm_i915_private::gem' data-ref="drm_i915_private::gem" data-ref-filename="drm_i915_private..gem">gem</a>.<a class="ref field" href="../i915_drv.h.html#drm_i915_private::(anonymous)::idle_work" title='drm_i915_private::(anonymous struct)::idle_work' data-ref="drm_i915_private::(anonymous)::idle_work" data-ref-filename="drm_i915_private..(anonymous)..idle_work">idle_work</a>, <a class="tu ref fn" href="#idle_work_handler" title='idle_work_handler' data-use='r' data-ref="idle_work_handler" data-ref-filename="idle_work_handler">idle_work_handler</a>);</td></tr>
<tr><th id="290">290</th><td>	<a class="macro" href="../../../../../include/linux/workqueue.h.html#271" title="do { do { __init_work(((&amp;(&amp;i915-&gt;gem.retire_work)-&gt;work)), 0); ((&amp;(&amp;i915-&gt;gem.retire_work)-&gt;work))-&gt;data = (atomic_long_t) { ((unsigned long)WORK_STRUCT_NO_POOL) }; INIT_LIST_HEAD(&amp;((&amp;(&amp;i915-&gt;gem.retire_work)-&gt;work))-&gt;entry); ((&amp;(&amp;i915-&gt;gem.retire_work)-&gt;work))-&gt;func = (((retire_work_handler))); } while (0); init_timer_key((&amp;(&amp;i915-&gt;gem.retire_work)-&gt;timer), (delayed_work_timer_fn), ((0) | 0x00200000), ((void *)0), ((void *)0)); } while (0)" data-ref="_M/INIT_DELAYED_WORK">INIT_DELAYED_WORK</a>(&amp;<a class="local col1 ref" href="#31i915" title='i915' data-ref="31i915" data-ref-filename="31i915">i915</a>-&gt;<a class="ref field" href="../i915_drv.h.html#drm_i915_private::gem" title='drm_i915_private::gem' data-ref="drm_i915_private::gem" data-ref-filename="drm_i915_private..gem">gem</a>.<a class="ref field" href="../i915_drv.h.html#drm_i915_private::(anonymous)::retire_work" title='drm_i915_private::(anonymous struct)::retire_work' data-ref="drm_i915_private::(anonymous)::retire_work" data-ref-filename="drm_i915_private..(anonymous)..retire_work">retire_work</a>, <a class="tu ref fn" href="#retire_work_handler" title='retire_work_handler' data-use='r' data-ref="retire_work_handler" data-ref-filename="retire_work_handler">retire_work_handler</a>);</td></tr>
<tr><th id="291">291</th><td></td></tr>
<tr><th id="292">292</th><td>	<a class="local col1 ref" href="#31i915" title='i915' data-ref="31i915" data-ref-filename="31i915">i915</a>-&gt;<a class="ref field" href="../i915_drv.h.html#drm_i915_private::gem" title='drm_i915_private::gem' data-ref="drm_i915_private::gem" data-ref-filename="drm_i915_private..gem">gem</a>.<a class="ref field" href="../i915_drv.h.html#drm_i915_private::(anonymous)::pm_notifier" title='drm_i915_private::(anonymous struct)::pm_notifier' data-ref="drm_i915_private::(anonymous)::pm_notifier" data-ref-filename="drm_i915_private..(anonymous)..pm_notifier">pm_notifier</a>.<a class="ref field" href="../../../../../include/linux/notifier.h.html#notifier_block::notifier_call" title='notifier_block::notifier_call' data-ref="notifier_block::notifier_call" data-ref-filename="notifier_block..notifier_call">notifier_call</a> = <a class="tu ref fn" href="#pm_notifier" title='pm_notifier' data-use='r' data-ref="pm_notifier" data-ref-filename="pm_notifier">pm_notifier</a>;</td></tr>
<tr><th id="293">293</th><td>	<a class="ref fn" href="../../../../../include/linux/notifier.h.html#blocking_notifier_chain_register" title='blocking_notifier_chain_register' data-ref="blocking_notifier_chain_register" data-ref-filename="blocking_notifier_chain_register">blocking_notifier_chain_register</a>(&amp;<a class="local col1 ref" href="#31i915" title='i915' data-ref="31i915" data-ref-filename="31i915">i915</a>-&gt;<a class="ref field" href="../i915_drv.h.html#drm_i915_private::gt" title='drm_i915_private::gt' data-ref="drm_i915_private::gt" data-ref-filename="drm_i915_private..gt">gt</a>.<a class="ref field" href="../i915_drv.h.html#drm_i915_private::(anonymous)::pm_notifications" title='drm_i915_private::(anonymous struct)::pm_notifications' data-ref="drm_i915_private::(anonymous)::pm_notifications" data-ref-filename="drm_i915_private..(anonymous)..pm_notifications">pm_notifications</a>,</td></tr>
<tr><th id="294">294</th><td>					 &amp;<a class="local col1 ref" href="#31i915" title='i915' data-ref="31i915" data-ref-filename="31i915">i915</a>-&gt;<a class="ref field" href="../i915_drv.h.html#drm_i915_private::gem" title='drm_i915_private::gem' data-ref="drm_i915_private::gem" data-ref-filename="drm_i915_private..gem">gem</a>.<a class="ref field" href="../i915_drv.h.html#drm_i915_private::(anonymous)::pm_notifier" title='drm_i915_private::(anonymous struct)::pm_notifier' data-ref="drm_i915_private::(anonymous)::pm_notifier" data-ref-filename="drm_i915_private..(anonymous)..pm_notifier">pm_notifier</a>);</td></tr>
<tr><th id="295">295</th><td>}</td></tr>
<tr><th id="296">296</th><td></td></tr>
</table><hr/><p id='footer'>
Generated on <em>2020-Jun-10</em> from project linux-5.3.1 revision <em>5.3.1</em><br />Powered by <a href='https://woboq.com'><img alt='Woboq' src='https://code.woboq.org/woboq-16.png' width='41' height='16' /></a> <a href='https://code.woboq.org'>Code Browser</a> 2.1
<br/>Generator usage only permitted with license.</p>
</div></body></html>
